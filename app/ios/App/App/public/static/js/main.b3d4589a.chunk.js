(this["webpackJsonpinvasivesbci-app"]=this["webpackJsonpinvasivesbci-app"]||[]).push([[1],{520:function(e,t,a){e.exports=a.p+"static/media/Plan Page.ad765c00.gif"},558:function(e,t,a){e.exports=a(888)},559:function(e,t,a){var n={"./pwa-action-sheet.entry.js":[908,59],"./pwa-camera-modal-instance.entry.js":[909,60],"./pwa-camera-modal.entry.js":[910,61],"./pwa-camera.entry.js":[911,62],"./pwa-toast.entry.js":[912,63]};function r(e){if(!a.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],r=t[0];return a.e(t[1]).then((function(){return a(r)}))}r.keys=function(){return Object.keys(n)},r.id=559,e.exports=r},564:function(e,t,a){var n={"./ion-action-sheet.entry.js":[914,7],"./ion-alert.entry.js":[915,8],"./ion-app_8.entry.js":[916,9],"./ion-avatar_3.entry.js":[917,19],"./ion-back-button.entry.js":[918,20],"./ion-backdrop.entry.js":[919,45],"./ion-button_2.entry.js":[920,21],"./ion-card_5.entry.js":[921,22],"./ion-checkbox.entry.js":[922,23],"./ion-chip.entry.js":[923,24],"./ion-col_3.entry.js":[924,46],"./ion-datetime_3.entry.js":[925,12],"./ion-fab_3.entry.js":[926,25],"./ion-img.entry.js":[927,47],"./ion-infinite-scroll_2.entry.js":[928,48],"./ion-input.entry.js":[929,26],"./ion-item-option_3.entry.js":[930,27],"./ion-item_8.entry.js":[931,28],"./ion-loading.entry.js":[932,29],"./ion-menu_3.entry.js":[933,30],"./ion-modal.entry.js":[934,10],"./ion-nav_2.entry.js":[935,16],"./ion-popover.entry.js":[936,11],"./ion-progress-bar.entry.js":[937,31],"./ion-radio_2.entry.js":[938,32],"./ion-range.entry.js":[939,33],"./ion-refresher_2.entry.js":[940,13],"./ion-reorder_2.entry.js":[941,18],"./ion-ripple-effect.entry.js":[942,49],"./ion-route_4.entry.js":[943,34],"./ion-searchbar.entry.js":[944,35],"./ion-segment_2.entry.js":[945,36],"./ion-select_3.entry.js":[946,37],"./ion-slide_2.entry.js":[947,50],"./ion-spinner.entry.js":[948,15],"./ion-split-pane.entry.js":[949,51],"./ion-tab-bar_2.entry.js":[950,38],"./ion-tab_2.entry.js":[951,17],"./ion-text.entry.js":[952,39],"./ion-textarea.entry.js":[953,40],"./ion-toast.entry.js":[954,41],"./ion-toggle.entry.js":[955,14],"./ion-virtual-scroll.entry.js":[956,52]};function r(e){if(!a.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],r=t[0];return a.e(t[1]).then((function(){return a(r)}))}r.keys=function(){return Object.keys(n)},r.id=564,e.exports=r},566:function(e,t,a){var n={"./ion-icon.entry.js":[957,67]};function r(e){if(!a.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],r=t[0];return a.e(t[1]).then((function(){return a(r)}))}r.keys=function(){return Object.keys(n)},r.id=566,e.exports=r},574:function(e,t){},589:function(e,t,a){},609:function(e,t,a){},850:function(e,t,a){},851:function(e,t,a){},858:function(e,t,a){e.exports=a.p+"static/media/InvasivesBC_Icon.26be79d8.svg"},888:function(e,t,a){"use strict";a.r(t);var n,r=a(3),i=a.n(r),c=a(9),o=a(56),l=a(527),s=a(0),u=a.n(s),d=a(33),m=a.n(d),p=a(454),v=a(1069),f=a(1025),b=a(1024),y=a(12),_=a(8),g=a(143),h=a(521),O=a(455),E=a.n(O),j=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_DB_SCHEMA||"invasivesbc",x=u.a.createContext({database:null,resetDatabase:function(){}}),w=function(e){var t=Object(s.useState)({database:null,resetDatabase:function(){}}),n=Object(_.a)(t,2),r=n[0],o=n[1],l=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=r.database)){e.next=3;break}return e.abrupt("return");case 3:g.a.plugin(h.a),g.a.plugin(E.a),window.cordova?(g.a.plugin(a(582)),t=new g.a(j,{adapter:"cordova-sqlite",iosDatabaseLocation:"default",androidDatabaseProvider:"system"})):(g.a.plugin(a(889).default),t=new g.a(j,{adapter:"idb"})),t.createIndex({index:{ddoc:"notificationsIndex",fields:["docType","acknowledged"]}}),t.createIndex({index:{ddoc:"activitiesIndex",fields:["docType","activityType"]}}),t.createIndex({index:{ddoc:"formStatusIndex",fields:["docType","formStatus","sync.ready"]}}),t.createIndex({index:{ddoc:"docTypeIndex",fields:["docType","trip_ID"]}}),t.createIndex({index:{ddoc:"tripDocTypeIndex",fields:["trip_ID","docType"]}}),t.createIndex({index:{ddoc:"tripIDIndex",fields:["docType","trip_IDs"]}}),n=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.destroy();case 4:return e.next=6,l();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o({database:t,resetDatabase:function(){return n(t)}});case 14:case"end":return e.stop()}}),e)}))),[r.database]),d=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.database){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,t.close();case 5:case"end":return e.stop()}}),e)}))),[]);return Object(s.useEffect)((function(){l(),function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[l,d]),u.a.createElement(x.Provider,{value:r},e.children)},S=a(55),C=a.n(S),k=u.a.createContext(null),T=function(e){var t=Object(s.useContext)(x),a=Object(s.useState)(null),n=Object(_.a)(a,2),r=n[0],o=n[1],l=Object(s.useState)(null),d=Object(_.a)(l,2),m=d[0],p=d[1],v=Object(s.useState)(null),f=Object(_.a)(v,2),b=f[0],g=f[1],h=Object(s.useState)([]),O=Object(_.a)(h,2),E=O[0],j=O[1],w=Object(s.useState)(null),S=Object(_.a)(w,2),T=S[0],I=S[1],A=Object(s.useCallback)(function(){var e=Object(c.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=C()().valueOf(),g(a),!b||a>b+1e3?(o([].concat(Object(y.a)(E),[t])),j([]),I(null),clearTimeout(T)):(j([].concat(Object(y.a)(E),[t])),I(setTimeout((function(){return o([].concat(Object(y.a)(E),[t]))}),a-b+1e3)));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,b,T,I,o]),D=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m&&!m.isCancelled||(a=t.database.changes({live:!0,since:"now"}).on("change",(function(e){return A(e)})).on("complete",(function(e){return function(){return A(e)}})).on("error",(function(e){return function(){return A(e)}})),p(a));case 1:case"end":return e.stop()}}),e)}))),[m,t.database,A]),P=Object(s.useCallback)((function(){m&&m.cancel()}),[m]);return Object(s.useEffect)((function(){return D(),function(){P()}}),[t,D,P]),u.a.createElement(k.Provider,{value:r},e.children)},I=u.a.createContext(null),A=function(e){var t=Object(s.useState)(null),a=Object(_.a)(t,2),n=a[0],r=a[1];return Object(s.useEffect)((function(){return o.d.removeAllListeners(),o.d.getStatus().then((function(e){r(e)})),o.d.addListener("networkStatusChange",(function(e){r(e)})),function(){o.d.removeAllListeners()}}),[]),u.a.createElement(I.Provider,{value:n},e.children)},D=a(459),P=a.n(D),N=a(522),F=(a(589),Object(N.a)({palette:{primary:{light:"#5469a4",main:"#223f75",dark:"#001949",contrastText:"#ffffff"},secondary:{light:"#ffd95e",main:"#e3a82b",dark:"#ad7900",contrastText:"#000000"}},typography:{fontFamily:["BCSans",'"Noto Sans"','"Helvetica Neue"',"Arial","sans-serif"].join(",")},overrides:{MuiTypography:{h1:{fontSize:"3rem"},h2:{fontSize:"2.5rem"},h3:{fontSize:"2rem"},h4:{fontSize:"1.5rem"},h5:{fontSize:"1.25rem"},h6:{fontSize:"1rem"}},MuiCircularProgress:{root:{position:"absolute",top:"50%",left:"50%",height:"60px !important",width:"60px !important",marginLeft:"-30px",marginTop:"-30px"}},MuiContainer:{root:{maxWidth:"xl",margin:"auto"}},MuiTooltip:{tooltip:{fontSize:"1rem",color:"white",backgroundColor:"#223F75"}}}}));!function(e){e.ADMIN="admin",e.MANAGER="manager",e.DATA_EDITOR="data-editor"}(n||(n={}));var M,R,L,B=[n.ADMIN,n.MANAGER,n.DATA_EDITOR],W=a(1017),z=a(96),G=a(1),U=a(21),q=a(1008),Y=a(1002),V=a(1001),H=a(144),J=a(1074),Q=a(1009),K=a(341),$=a(893),Z=a(1010),X=a(531),ee=a(1011),te=a(532),ae=a(894),ne=a(895),re=a(902),ie=a(1014),ce=a(1007),oe=a(1012),le=a(1015),se=a(1016),ue=a(4),de=a(996),me=a(999),pe=a(1e3);!function(e){e.Observation="Observation",e.AnimalActivity="AnimalActivity",e.Dispersal="Dispersal",e.Transect="Transect",e.Treatment="Treatment",e.Monitoring="Monitoring"}(R||(R={})),function(e){e.Observation_PlantTerrestrial="Activity_Observation_PlantTerrestrial",e.Observation_PlantTerrestrial_BulkEdit="Activity_Observation_PlantTerrestrial_BulkEdit",e.Observation_PlantAquatic="Activity_Observation_PlantAquatic",e.Activity_AnimalTerrestrial="Activity_AnimalActivity_AnimalTerrestrial",e.Activity_AnimalAquatic="Activity_AnimalActivity_AnimalAquatic",e.Activity_BiologicalDispersal="Activity_Dispersal_BiologicalDispersal",e.Transect_FireMonitoring="Activity_Transect_FireMonitoring",e.Transect_Vegetation="Activity_Transect_Vegetation",e.Transect_BiocontrolEfficacy="Activity_Transect_BiocontrolEfficacy",e.Treatment_ChemicalPlant="Activity_Treatment_ChemicalPlant",e.Treatment_ChemicalPlant_BulkEdit="Activity_Treatment_ChemicalPlant_BulkEdit",e.Treatment_MechanicalPlant="Activity_Treatment_MechanicalPlant",e.Treatment_MechanicalPlant_BulkEdit="Activity_Treatment_MechanicalPlant_BulkEdit",e.Treatment_BiologicalPlant="Activity_Treatment_BiologicalPlant",e.Treatment_BiologicalPlant_BulkEdit="Activity_Treatment_BiologicalPlant_BulkEdit",e.Monitoring_ChemicalTerrestrialAquaticPlant="Activity_Monitoring_ChemicalTerrestrialAquaticPlant",e.Monitoring_MechanicalTerrestrialAquaticPlant="Activity_Monitoring_MechanicalTerrestrialAquaticPlant",e.Monitoring_BiologicalTerrestrialPlant="Activity_Monitoring_BiologicalTerrestrialPlant"}(L||(L={}));var ve,fe,be,ye,_e=(M={},Object(U.a)(M,R.Observation,de.a),Object(U.a)(M,R.AnimalActivity,de.a),Object(U.a)(M,R.Transect,de.a),Object(U.a)(M,R.Treatment,me.a),Object(U.a)(M,R.Monitoring,pe.a),Object(U.a)(M,R.Dispersal,pe.a),M);!function(e){e.NEW="New",e.EDITED="Edited"}(ve||(ve={})),function(e){e.NOT_SYNCED="Not Synced",e.SYNC_SUCCESSFUL="Sync Successful",e.SYNC_FAILED="Sync Failed"}(fe||(fe={})),function(e){e.NOT_VALIDATED="Not Validated",e.INVALID="Invalid",e.VALID="Valid"}(be||(be={})),function(e){e.APPSTATE="appstate",e.ACTIVITY="activity",e.TRIP="trip",e.REFERENCE_ACTIVITY="reference_activity",e.REFERENCE_POINT_OF_INTEREST="reference_point_of_interest",e.POINT_OF_INTEREST="point_of_interest",e.NOTIFICATION="notification",e.SPATIAL_UPLOADS="spatial_uploads",e.OFFLINE_EXTENT="offline_extent",e.OFFLINE_DATA="offline_data",e.PLAN_PAGE_EXTENT="plan_page_extent"}(ye||(ye={}));var ge=a(162),he=a(244),Oe=a.n(he),Ee=a(88),je=a.n(Ee),xe=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_API_HOST,we=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_API_PORT,Se=we&&"".concat(xe,":").concat(we)||xe||"https://api-dev-invasivesbci.apps.silver.devops.gov.bc.ca",Ce=function(){var e=function(){var e=Object(ge.b)().keycloak;return Object(s.useMemo)((function(){return Oe.a.create({headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)},baseURL:Se})}),[e])}(),t=Object(s.useContext)(x),a=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.post("/api/activities/",a);case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.delete("/api/activities",{params:{id:a},paramsSerializer:function(e){return je.a.stringify(e)}});case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.post("/api/deleted/activities",{params:{id:a},paramsSerializer:function(e){return je.a.stringify(e)}});case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),o=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.post("/api/points-of-interest/",a);case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),l=function(){var t=Object(c.a)(i.a.mark((function t(n){var r,c,l,s,u,d,m,p,v;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.get("/api/metabase-query/".concat(n.metabaseQueryId));case 3:if(p=t.sent,!(null===(v=p.data)||void 0===v||null===(d=v.activity_ids)||void 0===d?void 0:d.length)){t.next=9;break}return t.next=8,a({activity_ids:v.activity_ids,search_feature:n.search_feature});case 8:s=t.sent;case 9:if(!(null===v||void 0===v||null===(m=v.point_of_interest_ids)||void 0===m?void 0:m.length)){t.next=13;break}return t.next=12,o({point_of_interest_ids:v.point_of_interest_ids,search_feature:n.search_feature});case 12:u=t.sent;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.log("Metabase API call failed.");case 18:return t.abrupt("return",{activities:(null===(r=s)||void 0===r||null===(c=r.rows)||void 0===c?void 0:c.length)?s.rows:[],points_of_interest:(null===(l=u)||void 0===l?void 0:l.length)?u:[]});case 19:case"end":return t.stop()}}),t,null,[[0,15]])})));return function(e){return t.apply(this,arguments)}}(),u=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.post("/api/metabase-query",a);case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),d=function(){var t=Object(c.a)(i.a.mark((function t(){var a,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get("/api/metabase-query");case 2:return a=t.sent,n=a.data,t.abrupt("return",n.options);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),m=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get("/api/activity/".concat(a));case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),p=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get("/api/media/",{params:{key:a},paramsSerializer:function(e){return je.a.stringify(e)}});case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),v=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.post("/api/activity",a);case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),f=function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.put("/api/activity",a);case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),b=function(){var t=Object(c.a)(i.a.mark((function t(){var a,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get("/api/api-docs/");case 2:return a=t.sent,n=a.data,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),y=function(){var e=Object(c.a)(i.a.mark((function e(){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b();case 3:return a=e.sent,e.next=6,t.database.upsert("ApiSpec",(function(){return a}));case 6:return e.abrupt("return",a);case 9:return e.prev=9,e.t0=e.catch(0),e.next=13,t.database.get("ApiSpec");case 13:return n=e.sent,e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();return{getMedia:p,getSpeciesDetails:function(){var t=Object(c.a)(i.a.mark((function t(a){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get("/api/species",{params:{key:a},paramsSerializer:function(e){return je.a.stringify(e)}});case 2:return n=t.sent,r=n.data,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getActivities:a,deleteActivities:n,undeleteActivities:r,getActivityById:m,createActivity:v,updateActivity:f,getApiSpec:b,getCachedApiSpec:y,getPointsOfInterest:o,getMetabaseQueryResults:l,getMetabaseQueryOptions:d,createMetabaseQuery:u}},ke=a(58),Te=(a(609),a(1072)),Ie=function(){var e=Object(c.a)(i.a.mark((function e(t,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.database.put({_id:Object(Te.a)(),docType:ye.NOTIFICATION,notificationType:"error",text:a,acknowledged:!1,dateCreated:new Date});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Ae=function(){var e=Object(c.a)(i.a.mark((function e(t,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.database.put({_id:Object(Te.a)(),docType:ye.NOTIFICATION,notificationType:"success",text:a,acknowledged:!1,dateCreated:new Date});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),De=function(){var e=Object(c.a)(i.a.mark((function e(t,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.database.put({_id:Object(Te.a)(),docType:ye.NOTIFICATION,notificationType:"warning",text:a,acknowledged:!1,dateCreated:new Date});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Pe=function(e){var t=e.activity,a=e.classes;return u.a.createElement(u.a.Fragment,null,u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(H.a,{className:a.activitiyListItem_Typography},"Created"),C()(t.dateCreated).format("MMMM D, YYYY")),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(H.a,{className:a.activitiyListItem_Typography},"Last Updated"),t.dateUpdated&&C()(t.dateUpdated).format("MMMM D, YYYY")||"n/a"))};function Ne(e,t){var a="There has been an error. Please try again.";if("formSync"===t)switch(e){case 400:a="There seems to be an issue with your form, please check your form for errors and try again.";break;case 500:a="Our system experienced an issue. Please try again."}return a}function Fe(e,t,a){var n=Object(G.a)({},e),r={};if(delete n.activity_date_time,a){if(a.includes("Treatment"))return n;a.includes("Observation_Plant")&&(r={invasive_plant_code:t.invasive_plants[0].invasive_plant_code})}return delete n.latitude,delete n.longitude,delete n.reported_area,{activityData:n,activitySubtypeData:r}}function Me(e,t,a,n){var r=Object(Te.a)();return{_id:r,activityId:r,docType:ye.ACTIVITY,activityType:a,activitySubtype:n,status:ve.NEW,sync:{ready:!1,status:fe.NOT_SYNCED,error:null},dateCreated:new Date,dateUpdated:null,formData:e,formStatus:be.NOT_VALIDATED,geometry:t}}function Re(e,t,a){return Le.apply(this,arguments)}function Le(){return(Le=Object(c.a)(i.a.mark((function e(t,a,n){var r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={activity_data:{activity_date_time:C()(new Date).format()}},c=Me(r,null,a,n),e.next=4,t.database.put(c);case 4:return e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Be(e,t){return We.apply(this,arguments)}function We(){return(We=Object(c.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(Te.a)(),delete a._rev,r=Object(G.a)(Object(G.a)({},a),{},{_id:n,dateCreated:new Date,dateUpdated:null,status:ve.NEW,activityId:n}),e.next=5,t.database.put(r);case 5:return e.next=7,t.database.get(r._id);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(e,t,a,n){return Ge.apply(this,arguments)}function Ge(){return(Ge=Object(c.a)(i.a.mark((function e(t,a,n,r){var c,o,l,s,u,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=Fe(r.formData.activity_data,r.formData.activity_subtype_data,r.activitySubtype),o=c.activityData,l=c.activitySubtypeData,s={activity_data:Object(G.a)(Object(G.a)({},o),{},{activity_date_time:C()(new Date).format()}),activity_subtype_data:Object(G.a)({},l)},u=r.geometry,n===L.Treatment_ChemicalPlant?s.activity_subtype_data=Object(G.a)(Object(G.a)({},s.activity_subtype_data),{},{activity_id:r._id}):s.activity_type_data={activity_id:r._id},d=Me(s,u,a,n),e.next=7,t.database.put(d);case 7:return e.abrupt("return",d);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ue,qe=a(1076),Ye=a(1003),Ve=a(1004),He=a(1005),Je=a(1006),Qe=function(e){var t=e.isOpen,a=e.heading,n=e.message,r=e.handleAgree,i=e.handleDisagree;return u.a.createElement(qe.a,{open:t,onClose:function(){return i()},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},u.a.createElement(Ye.a,{id:"alert-dialog-title"},a),u.a.createElement(Ve.a,null,u.a.createElement(He.a,{id:"alert-dialog-description"},n)),u.a.createElement(Je.a,null,u.a.createElement(ce.a,{onClick:function(){return i()},color:"primary"},"Disagree"),u.a.createElement(ce.a,{onClick:function(){return r()},color:"primary",autoFocus:!0},"Agree")))},Ke=Object(q.a)((function(e){return{newActivityButtonsRow:{"& Button":{marginRight:"0.5rem",marginBottom:"0.5rem"}},syncSuccessful:{color:e.palette.success.main},syncFailed:{color:e.palette.error.main},activitiyListItem:{display:"flex",flexDirection:"row",marginTop:"0.5rem",marginBottom:"0.5rem",border:"1px solid",borderColor:e.palette.grey[300],borderRadius:"6px"},activityListItem_Grid:Object(U.a)({flexDirection:"row"},e.breakpoints.down("sm"),{flexDirection:"column"}),activitiyListItem_Typography:Object(U.a)({},e.breakpoints.down("sm"),{display:"inline",marginRight:"1rem"}),formControl:{marginRight:20,minWidth:150}}})),$e=function(e){var t=Ke(),a=Object(s.useContext)(x),n=Ce(),r=Object(s.useState)(null),o=Object(_.a)(r,2),l=o[0],d=o[1];Object(s.useEffect)((function(){m()}),[]);var m=function(){var t=Object(c.a)(i.a.mark((function t(){var a,r,c,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Activity_Observation_PlantTerrestrial"===e.activity.activitySubtype){t.next=2;break}return t.abrupt("return");case 2:if(!(c=null===(a=e.activity.formData)||void 0===a||null===(r=a.activity_subtype_data)||void 0===r?void 0:r.invasive_plant_code)){t.next=8;break}return t.next=6,n.getSpeciesDetails([c]);case 6:o=t.sent,d(o[0].code_description);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=e.isDisabled||e.activity.sync.status===fe.SYNC_SUCCESSFUL;return u.a.createElement(Y.a,{className:t.activityListItem_Grid,container:!0,spacing:2},u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis",title:e.activity.activitySubtype.split("_")[2]},u.a.createElement(H.a,{className:t.activitiyListItem_Typography},"Subtype"),e.activity.activitySubtype.split("_")[2])),l&&u.a.createElement(u.a.Fragment,null,u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis",title:l},u.a.createElement(H.a,{className:t.activitiyListItem_Typography},"Species"),l))),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:1},u.a.createElement(H.a,{variant:"h6",className:t.activitiyListItem_Typography},"Form Status"),e.activity.formStatus),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:l?1:2},u.a.createElement(H.a,{className:t.activitiyListItem_Typography},"Sync Status"),e.activity.sync.status),u.a.createElement(Pe,{classes:t,activity:e.activity}),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:l?1:2},u.a.createElement(H.a,{className:t.activitiyListItem_Typography},"Reviewed"),u.a.createElement(J.a,{disabled:p,checked:e.activity.sync.ready,onChange:function(t){return function(t){t.preventDefault(),t.stopPropagation();var n=t.target.checked;a.database.upsert(e.activity._id,(function(e){return Object(G.a)(Object(G.a)({},e),{},{sync:Object(G.a)(Object(G.a)({},e.sync),{},{ready:n})})}))}(t)},onClick:function(e){return e.stopPropagation()}})))},Ze=function(e){var t=Ke(),a=Object(ke.f)(),n=Object(s.useContext)(x),r=Object(s.useContext)(k),o=Object(s.useState)([]),l=Object(_.a)(o,2),d=l[0],m=l[1],p=Object(s.useState)(null),v=Object(_.a)(p,2),f=v[0],b=v[1],g=Object(s.useState)(!1),h=Object(_.a)(g,2),O=h[0],E=h[1],j=Object(s.useCallback)(Object(c.a)(i.a.mark((function t(){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.database.find({selector:{docType:ye.ACTIVITY,activityType:e.activityType},use_index:"activitiesIndex"});case 2:a=t.sent,m(Object(y.a)(a.docs));case 4:case"end":return t.stop()}}),t)}))),[n.database,e.activityType]);Object(s.useEffect)((function(){j()}),[r,j]);var w=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.database.remove(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.database.upsert(ye.APPSTATE,(function(e){return Object(G.a)(Object(G.a)({},e),{},{activeActivity:t._id})}));case 2:"Observation"===t.activityType?a.push({pathname:"/home/activity/observation",search:"?observation="+t._id,state:{observation:t._id}}):a.push("/home/activity");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=d.sort((function(e,t){return new Date(t.dateUpdated).valueOf()-new Date(e.dateUpdated).valueOf()}));return u.a.createElement(Q.a,null,C.map((function(a){var n=e.isDisabled||a.sync.status===fe.SYNC_SUCCESSFUL;return a.activitySubtype.includes(e.workflowFunction)||["Transect","Dispersal"].includes(a.activityType)?u.a.createElement(K.a,{key:a._id},u.a.createElement($.a,{button:!0,className:t.activitiyListItem,onClick:function(){return S(a)}},u.a.createElement(Z.a,null,u.a.createElement(X.a,{fontSize:"large",className:Object(ue.a)(a.sync.status===fe.SYNC_SUCCESSFUL&&t.syncSuccessful||a.sync.status===fe.SYNC_FAILED&&t.syncFailed),component:_e[e.activityType]})),u.a.createElement($e,{isDisabled:e.isDisabled,activity:a}),u.a.createElement(ee.a,null,u.a.createElement(te.a,{disabled:n,onClick:function(){b(a),E(!0)}},u.a.createElement(oe.a,null)))),u.a.createElement(Qe,{isOpen:O,handleDisagree:function(){return E(!1)},handleAgree:Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(f);case 2:E(!1);case 3:case"end":return e.stop()}}),e)}))),heading:"Delete Activity?",message:"Are you sure you would like to delete this activity? Once deleted, this activity cannot be recovered"})):null})))},Xe=function(){var e=Ke(),t=Object(s.useContext)(x),a=Ce(),n=Object(s.useState)(!1),r=Object(_.a)(n,2),o=r[0],l=r[1],d=Object(s.useState)(!1),m=Object(_.a)(d,2),p=m[0],f=m[1],b=Object(s.useState)("Plant"),y=Object(_.a)(b,2),g=y[0],h=y[1],O=[{label:"Fire Monitoring",type:L.Transect_FireMonitoring},{label:"Vegetation Transect (Full, Lumped, Invasive Plant Density)",type:L.Transect_Vegetation},{label:"Biocontrol Efficacy",type:L.Transect_BiocontrolEfficacy}],E=function(){var e=Object(c.a)(i.a.mark((function e(){var n,r,c,o,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),l(!0),e.next=4,t.database.find({selector:{docType:ye.ACTIVITY,formStatus:be.VALID,"sync.ready":!0,"sync.status":{$ne:fe.SYNC_SUCCESSFUL}},use_index:"formStatusIndex"});case 4:n=e.sent,r=[],c=Object(z.a)(n.docs),e.prev=7,c.s();case 9:if((o=c.n()).done){e.next=29;break}return s=o.value,e.prev=11,e.next=14,a.createActivity({activity_id:s.activityId,created_timestamp:s.dateCreated,activity_type:s.activityType,activity_subtype:s.activitySubtype,geometry:s.geometry,media:s.photos&&s.photos.map((function(e){return{file_name:e.filepath,encoded_file:e.dataUrl}})),form_data:s.formData});case 14:return Ae(t,"Syncing ".concat(s.activitySubtype.split("_")[2]," activity has succeeded.")),e.next=17,t.database.upsert(s._id,(function(e){return Object(G.a)(Object(G.a)({},e),{},{sync:Object(G.a)(Object(G.a)({},e.sync),{},{status:fe.SYNC_SUCCESSFUL,error:null})})}));case 17:e.next=27;break;case 19:return e.prev=19,e.t0=e.catch(11),Ie(t,JSON.stringify(e.t0)),alert(JSON.stringify(e.t0)),u=Ne(e.t0.response.status,"formSync"),r.push("Syncing ".concat(s.activitySubtype.split("_")[2]," activity has failed: ").concat(u)),e.next=27,t.database.upsert(s._id,(function(t){return Object(G.a)(Object(G.a)({},t),{},{sync:Object(G.a)(Object(G.a)({},t.sync),{},{status:fe.SYNC_FAILED,error:e.t0.message})})}));case 27:e.next=9;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(7),c.e(e.t1);case 34:return e.prev=34,c.f(),e.finish(34);case 37:r.forEach((function(e){Ie(t,e)})),l(!1),f(!1);case 40:case"end":return e.stop()}}),e,null,[[7,31,34,37],[11,19]])})));return function(){return e.apply(this,arguments)}}();return u.a.createElement(u.a.Fragment,null,u.a.createElement(v.a,null,u.a.createElement(v.a,{mb:3,display:"flex",justifyContent:"space-between"},u.a.createElement(ae.a,{variant:"outlined",className:e.formControl},u.a.createElement(ne.a,null,"Workflow Functions"),u.a.createElement(re.a,{value:g,onChange:function(e){h(e.target.value)},label:"Select Workflow Function"},u.a.createElement(ie.a,{value:"Plant"},"Plant"),u.a.createElement(ie.a,{value:"Animal"},"Animal"),u.a.createElement(ie.a,{value:"Special"},"Enhanced Collection"))),u.a.createElement(ce.a,{disabled:p,variant:"contained",color:"primary",startIcon:u.a.createElement(le.a,{className:Object(ue.a)(o&&"rotating")}),onClick:function(){return E()}},"Submit Records")),u.a.createElement(v.a,null,"Special"!==g&&u.a.createElement(v.a,null,u.a.createElement(v.a,null,"Plant"===g&&u.a.createElement(H.a,{variant:"h5"},"Observations"),"Animal"===g&&u.a.createElement(H.a,{variant:"h5"},"Activities")),u.a.createElement(v.a,{className:e.newActivityButtonsRow},"Plant"===g&&u.a.createElement(u.a.Fragment,null,u.a.createElement(ce.a,{disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){return Re(t,R.Observation,L.Observation_PlantTerrestrial)}},"Plant Terrestrial"),u.a.createElement(ce.a,{disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){return Re(t,R.Observation,L.Observation_PlantAquatic)}},"Plant Aquatic")),u.a.createElement(Ze,{workflowFunction:g,isDisabled:p,activityType:R.Observation})),u.a.createElement(v.a,{className:e.newActivityButtonsRow},"Animal"===g&&u.a.createElement(u.a.Fragment,null,u.a.createElement(ce.a,{disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){return Re(t,R.AnimalActivity,L.Activity_AnimalTerrestrial)}},"Animal Terrestrial"),u.a.createElement(ce.a,{disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){return Re(t,R.AnimalActivity,L.Activity_AnimalAquatic)}},"Animal Aquatic")),u.a.createElement(Ze,{workflowFunction:g,isDisabled:p,activityType:R.AnimalActivity}))),"Special"!==g&&"Animal"!==g&&u.a.createElement(v.a,null,u.a.createElement(v.a,null,u.a.createElement(H.a,{variant:"h5"},"Treatments")),u.a.createElement(v.a,{className:e.newActivityButtonsRow},u.a.createElement(Ze,{workflowFunction:g,isDisabled:p,activityType:R.Treatment}))),"Special"!==g&&"Animal"!==g&&u.a.createElement(v.a,null,u.a.createElement(v.a,null,u.a.createElement(H.a,{variant:"h5"},"Efficacy Monitorings")),u.a.createElement(Ze,{workflowFunction:g,isDisabled:p,activityType:R.Monitoring})),"Special"===g&&u.a.createElement(u.a.Fragment,null,u.a.createElement(v.a,null,u.a.createElement(v.a,null,u.a.createElement(H.a,{variant:"h5"},"Transects")),u.a.createElement(v.a,{className:e.newActivityButtonsRow},O.map((function(e){return u.a.createElement(ce.a,{key:e.label,disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){Re(t,R.Transect,e.type)}},e.label)}))),u.a.createElement(Ze,{workflowFunction:g,isDisabled:p,activityType:R.Transect})),u.a.createElement("br",null),u.a.createElement(v.a,null,u.a.createElement(v.a,null,u.a.createElement(H.a,{variant:"h5"},"Dispersals")),u.a.createElement(v.a,{className:e.newActivityButtonsRow},u.a.createElement(ce.a,{disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){Re(t,R.Dispersal,L.Activity_BiologicalDispersal)}},"Biological Dispersal")),u.a.createElement(Ze,{workflowFunction:g,isDisabled:p,activityType:R.Dispersal})),u.a.createElement("br",null),u.a.createElement(v.a,null,u.a.createElement(v.a,null,u.a.createElement(H.a,{variant:"h5"},"Development/Testing")),u.a.createElement(v.a,{className:e.newActivityButtonsRow},u.a.createElement(ce.a,{disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){return Ie(t,"An error message!")}},"Simulate Error"),u.a.createElement(ce.a,{disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){return Ae(t,"A Success message!")}},"Simulate Success"),u.a.createElement(ce.a,{disabled:p,variant:"contained",startIcon:u.a.createElement(se.a,null),onClick:function(){return De(t,"A Warning message!")}},"Simulate Warning")))))))},et=function(e){return u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(Xe,null))},tt=a(1034),at=a(1077),nt=a(1031),rt=a(1033),it=a(1032),ct=a(524),ot=a(53),lt=a(140),st=a.n(lt),ut=function(e){return u.a.createElement(ce.a,Object.assign({variant:"contained"},e,{color:"primary"}),u.a.createElement(st.a,null)," Add Item")},dt=a(163),mt=a(248),pt=a.n(mt),vt=a(249),ft=a.n(vt),bt=a(247),yt=a.n(bt),_t={remove:u.a.createElement(yt.a,null),plus:u.a.createElement(st.a,null),"arrow-up":u.a.createElement(pt.a,null),"arrow-down":u.a.createElement(ft.a,null)},gt=function(e){var t=e.icon,a=(e.className,Object(dt.a)(e,["icon","className"]));return u.a.createElement(ce.a,Object.assign({variant:"outlined"},a,{size:"small"}),_t[t])},ht=ot.b.isMultiSelect,Ot=ot.b.getDefaultRegistry,Et=function(e){var t=e.TitleField,a=e.idSchema,n=e.title,r=e.required;if(!n)return null;var i="".concat(a.$id,"__title");return u.a.createElement(t,{id:i,title:n,required:r})},jt=function(e){var t=e.DescriptionField,a=e.idSchema,n=e.description;if(!n)return null;var r="".concat(a.$id,"__description");return u.a.createElement(t,{id:r,description:n})},xt=function(e){var t={flex:1,paddingLeft:6,paddingRight:6,fontWeight:"bold"};return u.a.createElement(Y.a,{container:!0,key:e.key,alignItems:"center"},u.a.createElement(Y.a,{item:!0,xs:12},u.a.createElement(v.a,{mb:2},u.a.createElement(K.a,{elevation:1},u.a.createElement(v.a,{p:2},e.children)))),e.hasToolbar&&u.a.createElement(Y.a,{item:!0},(e.hasMoveUp||e.hasMoveDown)&&u.a.createElement(gt,{icon:"arrow-up",className:"array-item-move-up",tabIndex:-1,style:t,disabled:e.disabled||e.readonly||!e.hasMoveUp,onClick:e.onReorderClick(e.index,e.index-1)}),(e.hasMoveUp||e.hasMoveDown)&&u.a.createElement(gt,{icon:"arrow-down",tabIndex:-1,style:t,disabled:e.disabled||e.readonly||!e.hasMoveDown,onClick:e.onReorderClick(e.index,e.index+1)}),e.hasRemove&&u.a.createElement(gt,{icon:"remove",tabIndex:-1,style:t,disabled:e.disabled||e.readonly,onClick:e.onDropIndexClick(e.index)})))},wt=function(e){return u.a.createElement("fieldset",{className:e.className},u.a.createElement(Et,{key:"array-field-title-".concat(e.idSchema.$id),TitleField:e.TitleField,idSchema:e.idSchema,title:e.uiSchema["ui:title"]||e.title,required:e.required}),(e.uiSchema["ui:description"]||e.schema.description)&&u.a.createElement("div",{className:"field-description",key:"field-description-".concat(e.idSchema.$id)},e.uiSchema["ui:description"]||e.schema.description),u.a.createElement("div",{className:"row array-item-list",key:"array-item-list-".concat(e.idSchema.$id)},e.items&&e.items.map(xt)),e.canAdd&&u.a.createElement(ut,{className:"array-item-add",onClick:e.onAddClick,disabled:e.disabled||e.readonly}))},St=function(e){return u.a.createElement(v.a,null,u.a.createElement(Et,{key:"array-field-title-".concat(e.idSchema.$id),TitleField:e.TitleField,idSchema:e.idSchema,title:e.uiSchema["ui:title"]||e.title,required:e.required}),(e.uiSchema["ui:description"]||e.schema.description)&&u.a.createElement(jt,{key:"array-field-description-".concat(e.idSchema.$id),DescriptionField:e.DescriptionField,idSchema:e.idSchema,description:e.uiSchema["ui:description"]||e.schema.description}),u.a.createElement(Y.a,{direction:"column",container:!0,key:"array-item-list-".concat(e.idSchema.$id)},e.items&&e.items.map((function(e){return xt(e)})),e.canAdd&&u.a.createElement(Y.a,{container:!0,justify:"flex-end"},u.a.createElement(Y.a,{item:!0},u.a.createElement(v.a,{mt:2},u.a.createElement(ut,{className:"array-item-add",onClick:e.onAddClick,disabled:e.disabled||e.readonly}))))))},Ct=function(e){var t=e.schema,a=e.registry,n=void 0===a?Ot():a;return ht(t,n.rootSchema)?u.a.createElement(wt,e):u.a.createElement(St,e)},kt=a(899),Tt=a(897),It=ot.b.ADDITIONAL_PROPERTY_FLAG,At=function(e){var t="".concat(e.label," Key");if(!e.schema.hasOwnProperty(It))return u.a.createElement(u.a.Fragment,null,e.children);return u.a.createElement(Y.a,{container:!0,key:"".concat(e.id,"-key"),alignItems:"center",spacing:2},u.a.createElement(Y.a,{item:!0},u.a.createElement(ae.a,{fullWidth:!0,required:e.required},u.a.createElement(ne.a,null,t),u.a.createElement(Tt.a,{defaultValue:e.label,disabled:e.disabled||e.readonly,id:"".concat(e.id,"-key"),name:"".concat(e.id,"-key"),onBlur:e.readonly?void 0:function(t){var a=t.target;return e.onKeyChange(a.value)},type:"text"}))),u.a.createElement(Y.a,{item:!0,xs:!0},e.children),u.a.createElement(Y.a,{item:!0},u.a.createElement(gt,{icon:"remove",tabIndex:-1,style:{flex:1,paddingLeft:6,paddingRight:6,fontWeight:"bold"},disabled:e.disabled||e.readonly,onClick:e.onDropPropertyClick(e.label)})))},Dt=function(e){return u.a.createElement(At,{classNames:e.classNames,disabled:e.disabled,id:e.id,label:e.label,onDropPropertyClick:e.onDropPropertyClick,onKeyChange:e.onKeyChange,readonly:e.readonly,required:e.required,schema:e.schema},u.a.createElement(ae.a,{fullWidth:!0,error:!(!e.rawErrors||!e.rawErrors.length),required:e.required},e.children,e.displayLabel&&e.rawDescription?u.a.createElement(H.a,{variant:"caption",color:"textSecondary"},e.rawDescription):null,e.rawErrors&&e.rawErrors.length>0&&u.a.createElement(Q.a,{dense:!0,disablePadding:!0},e.rawErrors.map((function(t,a){return u.a.createElement($.a,{key:a,disableGutters:!0},u.a.createElement(kt.a,{id:e.id},t))}))),e.rawHelp&&u.a.createElement(kt.a,{id:e.id},e.rawHelp)))},Pt=a(1022),Nt=a(487),Ft=a.n(Nt),Mt=a(901),Rt=ot.b.canExpand,Lt=Object(Mt.a)({root:{marginTop:10}}),Bt=function(e){var t=Lt(),a=e.DescriptionField,n=e.TitleField;return u.a.createElement(u.a.Fragment,null,(e.uiSchema["ui:title"]||e.title)&&u.a.createElement(n,{id:"".concat(e.idSchema.$id,"-title"),title:e.title,required:e.required}),e.description&&u.a.createElement(a,{id:"".concat(e.idSchema.$id,"-description"),description:e.description}),u.a.createElement(Y.a,{container:!0,spacing:2,className:t.root},e.properties.map((function(t,a){return u.a.createElement(Y.a,{item:!0,xs:e.uiSchema["ui:column-xs"]||12,sm:e.uiSchema["ui:column-sm"]||e.uiSchema["ui:column-xs"]||12,md:e.uiSchema["ui:column-md"]||e.uiSchema["ui:column-sm"]||e.uiSchema["ui:column-xs"]||12,lg:e.uiSchema["ui:column-lg"]||e.uiSchema["ui:column-md"]||e.uiSchema["ui:column-sm"]||e.uiSchema["ui:column-xs"]||12,xl:e.uiSchema["ui:column-xl"]||e.uiSchema["ui:column-lg"]||e.uiSchema["ui:column-md"]||e.uiSchema["ui:column-sm"]||e.uiSchema["ui:column-xs"]||12,key:a,style:{marginBottom:"10px"}},u.a.createElement(u.a.Fragment,null,t.content.props&&t.content.props.schema&&t.content.props.schema["x-tooltip-text"]&&u.a.createElement(Pt.a,{enterTouchDelay:0,title:t.content.props.schema["x-tooltip-text"],placement:"left"},u.a.createElement(Ft.a,{style:{float:"right",marginBottom:5,color:"rgb(170, 170, 170)"}})),t.content))})),Rt(e.schema,e.uiSchema,e.formData)&&u.a.createElement(Y.a,{container:!0,justify:"flex-end"},u.a.createElement(Y.a,{item:!0},u.a.createElement(ut,{className:"object-property-expand",onClick:e.onAddClick(e.schema),disabled:e.disabled||e.readonly})))))},Wt={"ui:column-xs":12,"ui:column-md":6,"ui:column-lg":3},zt={"ui:column-xs":12,"ui:column-md":6,"ui:column-lg":4},Gt={"ui:column-xs":12,"ui:column-md":6,"ui:column-lg":6},Ut={person_name:{}},qt={waterbody_name_gazetted:{},waterbody_name_local:{},waterbody_type:{"ui:widget":"single-select-autocomplete"},waterbody_use:{}},Yt={water_sample_depth:{},secchi_depth:{},water_colour:{}},Vt={transect_line_id:{},transect_comment:{},start_x_utm:{},start_y_utm:{},end_x_utm:{},end_y_utm:{},transect_length:{"ui:readonly":!0},transect_bearing:{"ui:readonly":!0}},Ht={utm_zone:{},transect_start_date_time:{},transect_end_date_time:{},project_number:{},surveyor1_name:{},surveyor2_name:{},field_recorder_name:{},research_trial_code:{},realm_code:{"ui:widget":"single-select-autocomplete"},site_aspect:{},site_aspect_variability:{},site_slope:{},site_slope_variability:{},site_elevation:{},cloud_cover_code:{"ui:widget":"single-select-autocomplete"},beaufort_wind_code:{"ui:widget":"single-select-autocomplete"},precipitation_code:{"ui:widget":"single-select-autocomplete"},burn_severity_code:{},ecological_moisture_regime_code:{"ui:widget":"single-select-autocomplete"},mesoslope_position_code:{"ui:widget":"single-select-autocomplete"},site_surface_shape_code:{"ui:widget":"single-select-autocomplete"},soil_properties_code:{"ui:widget":"single-select-autocomplete"},surface_substrate_code:{"ui:widget":"single-select-autocomplete"},site_activity_disturbance:{},disturbance_site_defunct:{},disturbance_condition_code:{"ui:widget":"single-select-autocomplete"},disturbance_type_code:{"ui:widget":"single-select-autocomplete"},invasive_plant_change_code:{"ui:widget":"single-select-autocomplete"},target_plant_change_code:{"ui:widget":"single-select-autocomplete"},treatment_seeded:{},density_count_type_code:{"ui:widget":"single-select-autocomplete"},trace_plants:{},growth_pattern:{},frame_size_code:{},biocontrol_noted_code:{},photoplot_start:{},photoplot_end:{},photoplot_aerials:{},photoplot_full_25m:{},plot_location:{}},Jt={sample_point_id:{},offset_distance:{},utm_x:{"ui:readonly":!0},utm_y:{"ui:readonly":!0},veg_transect_sampler:{},veg_transect_recorder:{},veg_transect_native_forbs:{},veg_transect_grasses:{},veg_transect_bare_ground:{},veg_transect_shrubs:{},veg_transect_bryophytes:{},veg_transect_litter:{},invasive_plants:{items:Object(G.a)({},{invasive_plant_code:{"ui:widget":"single-select-autocomplete"}})}},Qt={transect_line:Object(G.a)(Object(G.a)({},Gt),Vt),fire_monitoring_transect_points:{items:Object(G.a)(Object(G.a)({},Wt),Jt)}},Kt={transect_data:Object(G.a)(Object(G.a)({},zt),Ht),fire_monitoring_transect_lines:{items:Object(G.a)({},Qt)}},$t={sample_point_id:{},offset_distance:{},utm_x:{"ui:readonly":!0},utm_y:{"ui:readonly":!0}},Zt={invasive_plants:{items:Object(G.a)({},{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},percent_covered:{}})},lumped_species:{items:Object(G.a)({},{lumped_species_type:{"ui:widget":"single-select-autocomplete"},percent_covered:{"ui:widget":"single-select-autocomplete"}})},custom_species:{items:Object(G.a)({},{custom_species_type:{"ui:widget":"single-select-autocomplete"},percent_covered:{}})}},Xt={invasive_plants:{items:Object(G.a)({},{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},number_plants:{}})},lumped_species:{items:Object(G.a)({},{lumped_species_type:{"ui:widget":"single-select-autocomplete"},number_plants:{}})},custom_species:{items:Object(G.a)({},{custom_species_type:{"ui:widget":"single-select-autocomplete"},number_plants:{}})}},ea={invasive_plants:{items:Object(G.a)({},{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},daubenmire_classification:{"ui:widget":"single-select-autocomplete"}})},lumped_species:{items:Object(G.a)({},{lumped_species_type:{"ui:widget":"single-select-autocomplete"},daubenmire_classification:{"ui:widget":"single-select-autocomplete"}})},custom_species:{items:Object(G.a)({},{custom_species_type:{"ui:widget":"single-select-autocomplete"},daubenmire_classification:{"ui:widget":"single-select-autocomplete"}})}},ta={vegetation_transect_points:Object(G.a)(Object(G.a)({},Wt),$t),vegetation_transect_species:Object(G.a)(Object(G.a)({},zt),Zt)},aa={vegetation_transect_points:Object(G.a)(Object(G.a)({},Wt),$t),vegetation_transect_species:Object(G.a)(Object(G.a)({},zt),Xt)},na={vegetation_transect_points:Object(G.a)(Object(G.a)({},Wt),$t),vegetation_transect_species:Object(G.a)(Object(G.a)({},zt),ea)},ra={transect_line:Object(G.a)(Object(G.a)({},Gt),Vt),vegetation_transect_points_percent_cover:{items:Object(G.a)({},ta)},vegetation_transect_points_number_plants:{items:Object(G.a)({},aa)},vegetation_transect_points_daubenmire:{items:Object(G.a)({},na)}},ia={transect_data:Object(G.a)(Object(G.a)({},zt),Ht),vegetation_transect_lines:{items:Object(G.a)({},ra)}},ca={transect_line:Object(G.a)(Object(G.a)({},Gt),Vt),biocontrol_efficacy_transect_points:{items:Object(G.a)(Object(G.a)({},Wt),{sample_point_id:{},offset_distance:{},utm_x:{"ui:readonly":!0},utm_y:{"ui:readonly":!0},veg_transect_sampler:{},veg_transect_recorder:{},veg_transect_target:{},veg_transect_other_ips:{},veg_transect_native_forbs:{},veg_transect_grasses:{},veg_transect_bare_ground:{},veg_transect_shrubs:{},veg_transect_bryophytes:{},veg_transect_litter:{},veg_total_percentage:{"ui:readonly":!0}})}},oa={transect_data:Object(G.a)(Object(G.a)({},zt),Ht),transect_invasive_plants:{items:Object(G.a)(Object(G.a)({},zt),{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},invasive_plant_density_code:{"ui:widget":"single-select-autocomplete"},invasive_plant_distribution_code:{"ui:widget":"single-select-autocomplete"},soil_texture_code:{"ui:widget":"single-select-autocomplete"},linear_infestation:{},biological_agent_code:{"ui:widget":"single-select-autocomplete"}})},biocontrol_efficacy_transect_lines:{items:Object(G.a)({},ca)}},la={observation_type_code:{"ui:widget":"single-select-autocomplete"},observation_persons:{items:Object(G.a)({},Ut)}},sa={observation_plant_terrestrial_data:Object(G.a)(Object(G.a)({},Wt),{soil_texture_code:{"ui:widget":"single-select-autocomplete"},specific_use_code:{"ui:widget":"single-select-autocomplete"},slope_code:{"ui:widget":"single-select-autocomplete"},aspect_code:{"ui:widget":"single-select-autocomplete"},research_detection_ind:{},well_ind:{},special_care_ind:{}}),invasive_plants:{items:Object(G.a)(Object(G.a)({},Wt),{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},plant_life_stage_code:{"ui:widget":"single-select-autocomplete"},invasive_plant_density_code:{"ui:widget":"single-select-autocomplete"},invasive_plant_distribution_code:{"ui:widget":"single-select-autocomplete"}})}},ua={waterbody_data:Object(G.a)(Object(G.a)(Object(G.a)({},zt),qt),{},{water_level_management:{"ui:widget":"single-select-autocomplete"},substrate_type:{"ui:widget":"single-select-autocomplete"},tidal_influence:{},comment:{"ui:widget":"textarea"}}),project_data:Object(G.a)(Object(G.a)({},Gt),{surveyors:{},survey_type:{"ui:widget":"single-select-autocomplete"}}),terrain_characteristics:Object(G.a)(Object(G.a)({},zt),{},{adjacent_land_use:{},inflow_permanent:{},inflow_other:{},outflow:{},shoreline_types:{}}),water_quality:Object(G.a)(Object(G.a)({},zt),Yt),invasive_plants:{items:Object(G.a)(Object(G.a)({},zt),{sample_point_id:{},invasive_plant_code:{"ui:widget":"single-select-autocomplete"},provincial_edrr:{},invasive_plant_density_code:{"ui:widget":"single-select-autocomplete"},invasive_plant_distribution_code:{"ui:widget":"single-select-autocomplete"},plant_life_stage_code:{"ui:widget":"single-select-autocomplete"},plant_health_code:{"ui:widget":"single-select-autocomplete"},plant_seed_stage_code:{"ui:widget":"single-select-autocomplete"},voucher_specimen_collected:{},e_dna_sample:{},genetic_structure_collected:{},genetic_sample_id:{},negative_obs_ind:{}})}},da={Activity_AnimalTerrestrial:{comment:{"ui:widget":"textarea"}},Activity_AnimalAquatic:{invasive_aquatic_animals:{items:Object(G.a)(Object(G.a)({},zt),{invasive_animal_code:{"ui:widget":"single-select-autocomplete"},early_detection_rapid_resp_ind:{},negative_obs_ind:{},life_stage:{"ui:widget":"single-select-autocomplete"},sex:{},reproductive_maturity:{"ui:widget":"single-select-autocomplete"},length:{},length_method:{},weight:{},behaviour:{"ui:widget":"single-select-autocomplete"},condition:{"ui:widget":"single-select-autocomplete"},captured:{},disposed:{},specimen_id:{},sample_collected:{},sample_id:{},sample_type:{"ui:widget":"single-select-autocomplete"},age_analysis:{},genetic_analysis:{}})},site_information:{waterbody_data:Object(G.a)(Object(G.a)(Object(G.a)({},Wt),qt),{},{reach_number:{},adjacent_land_use:{},watershed_code:{},waterbody_id:{},additional_site_features:{"ui:widget":"textarea"},comment:{"ui:widget":"textarea"}}),terrain_characteristics:Object(G.a)(Object(G.a)({},Wt),{setting:{},aspect:{},hillslope_coupling:{},shoreline_type:{},cover:{},recreational_features:{},number_inlets:{},inlet_type:{},number_outlets:{},outlet_type:{}}),access:Object(G.a)(Object(G.a)({},Wt),{access_air:{},access_road:{},access_auto:{},access_off_road:{},access_off_road_distance:{},access_trail:{},access_trail_distance:{},access_closest_community:{},access_water_access:{},comments:{"ui:widget":"textarea"}}),aquatic_flora:Object(G.a)(Object(G.a)({},zt),{emergent_vegetation:{},emergent_vegetation_dominant_species:{},submergent_vegetation:{},submergent_vegetation_dominant_species:{},floating_algae_present:{},lake_bathymetry:{},littoral_area:{},max_depth:{},benchmark:{},max_water_level:{},benchmark_type:{"ui:widget":"textarea"}}),water_quality:Object(G.a)(Object(G.a)(Object(G.a)({},zt),Yt),{},{water_sample:{},water_sample_requisition_number:{},surface_water_temperature:{},field_ph:{},turbidity:{},ice_depth:{}}),conductivity_profile:Object(G.a)(Object(G.a)({},zt),{depth:{},dissolved_oxygen:{},temperature:{},conductivity:{},thermocline:{}})},activity_data:{survey_data:Object(G.a)(Object(G.a)({},Gt),{survey_design:{},survey_start_date_time:{},survey_end_date_time:{},survey_details:{}}),treatment_data:Object(G.a)(Object(G.a)({},Gt),{treatment_start_date_time:{},treatment_end_date_time:{},permit_number:{},survey_details:{}}),monitoring_data:Object(G.a)(Object(G.a)({},Gt),{monitoring_start_date_time:{},monitoring_end_date_time:{},monitoring_results:{"ui:widget":"textarea"},comment:{"ui:widget":"textarea"}}),net_trap_specifications:Object(G.a)(Object(G.a)({},zt),{haul_number:{},date_time_in:{},date_time_out:{},net_trap_type:{},length:{},depth:{},mesh_size:{},mesh_description:{},zone:{},habitat:{},substrate_type:{}}),electrofisher_specifications:Object(G.a)(Object(G.a)({},zt),{passes:{},date_time_in:{},date_time_out:{},one_pass_time:{},length:{},width:{},enclosure:{},voltage:{},frequency:{},pulse:{},make:{},model:{}}),plankton_tow_sample:Object(G.a)(Object(G.a)({},zt),{tows:{},date_time:{},plankton_tow_type:{},tow_depth_length:{},volume_sampled:{},containers:{},preserved_sample_ph:{},arrival_sample_ph:{},preservative_type:{},preservation_concentration:{},other_species:{},veliger_positive:{},buffered:{}}),substrate_sample:Object(G.a)(Object(G.a)({},zt),{date_installed:{},date_monitored:{},waterbody:{},site_location:{},depth:{},latitude:{},longitude:{},water_temperature:{},water_column_ph:{},secchi_depth:{},preservative_type:{},location_description:{"ui:widget":"textarea"},comments:{"ui:widget":"textarea"},microscopy_species:{"ui:widget":"textarea"},e_dna_sample:{"ui:widget":"textarea"},adult_suspected_presence:{},sample_collected:{}}),shoreline_surveys:Object(G.a)(Object(G.a)({},zt),{date_time:{},waterbody:{},target_species:{},weather_conditions:{},sampling_distance:{},sampling_location_lat:{},sampling_location_lng:{},substrate_type:{},species_present:{},density:{},diameter_largest_individual:{},other_species_found:{},comments:{"ui:widget":"textarea"}}),edna:Object(G.a)(Object(G.a)({},zt),{comment:{}}),habitat_alteration:Object(G.a)(Object(G.a)({},Gt),{type:{},description:{"ui:widget":"textarea"}}),chemical:Object(G.a)(Object(G.a)({},Gt),{type:{},description:{"ui:widget":"textarea"}}),biological:Object(G.a)(Object(G.a)({},Gt),{type:{},description:{"ui:widget":"textarea"}})}},Observation:la,Observation_PlantTerrestrial:sa,Observation_PlantAquatic:ua,Transect_FireMonitoring:Kt,Transect_Vegetation:ia,Transect_BiocontrolEfficacy:oa,Dispersal_BiologicalDispersal:{monitoring_organization:{},biological_agent_presence_code:{"ui:widget":"single-select-autocomplete"},count_duration:{},biological_agent_code:{"ui:widget":"single-select-autocomplete"},plant_count:{},biological_agent_count:{},applicator1_name:{},applicator2_name:{},treatment_organization:{},invasive_plant_code:{"ui:widget":"single-select-autocomplete"},phen_transect_sampler:{},phen_transect_recorder:{},phen_transect_seedlings:{},phen_transect_rosettes:{},phen_transect_bolting:{},phen_transect_flowering:{},phen_transect_seeds:{},phen_transect_senescent:{},phen_total_plants:{},phen_number_stems:{},phen_tallest_1:{},phen_tallest_2:{},phen_tallest_3:{},phen_tallest_4:{},phen_level_se:{},phen_level_ro:{},phen_level_bo:{},phen_level_fl:{},phen_level_sf:{},phen_level_sc:{},phen_total_percentage:{"ui:readonly":!0}},Treatment:{activity_id:{"ui:readonly":!0},treatment_organization:{},treatment_location:{"ui:widget":"textarea"},treatment_persons:{items:Object(G.a)({},Ut)}},Treatment_MechanicalPlant:{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},mechanical_method_code:{"ui:widget":"single-select-autocomplete"},mechanical_disposal_code:{"ui:widget":"single-select-autocomplete"}},Treatment_MechanicalPlant_BulkEdit:{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},mechanical_method_code:{"ui:widget":"single-select-autocomplete"},mechanical_disposal_code:{"ui:widget":"single-select-autocomplete"}},Treatment_BiologicalPlant:{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},treatment_issues_code:{"ui:widget":"single-select-autocomplete"},classified_area_code:{"ui:widget":"single-select-autocomplete"},release_quantity:{},mortality:{},agent_source:{},biological_agent_code:{"ui:widget":"single-select-autocomplete"},biological_agent_stage_code:{"ui:widget":"single-select-autocomplete"},bioagent_maturity_status_code:{"ui:widget":"single-select-autocomplete"}},Treatment_BiologicalPlant_BulkEdit:{invasive_plant_code:{"ui:widget":"single-select-autocomplete"},classified_area_code:{"ui:widget":"single-select-autocomplete"},biological_agent_code:{"ui:widget":"single-select-autocomplete"},biological_agent_stage_code:{"ui:widget":"single-select-autocomplete"},bioagent_maturity_status_code:{"ui:widget":"single-select-autocomplete"}},Monitoring:{activity_id:{"ui:readonly":!0},observer_first_name:{},observer_last_name:{},efficacy_code:{"ui:widget":"single-select-autocomplete"}},Monitoring_BiologicalTerrestrialPlant:{plant_count:{},agent_count:{},count_duration:{},agent_destroyed_ind:{},legacy_presence_ind:{},foliar_feeding_damage_ind:{},root_feeding_damage_ind:{},oviposition_marks_ind:{},eggs_present_ind:{},larvae_present_ind:{},pupae_present_ind:{},adults_present_ind:{},tunnels_present_ind:{},biological_agent_spread:{}},ProjectCode:{description:{}},Herbicide:{liquid_herbicide_code:{"ui:widget":"single-select-autocomplete"},herbicide_amount:{},mix_delivery_rate:{},application_rate:{},dilution:{"ui:readonly":!0},specific_treatment_area:{"ui:readonly":!0},tank_volume:{"ui:readonly":!0}},FourColumnStyle:Wt,ThreeColumnStyle:zt,TwoColumnStyle:Gt,Jurisdictions:{jurisdiction_code:{"ui:widget":"single-select-autocomplete"},percent_covered:{}}},ma={activity_id:{"ui:readonly":!0},applicator1_name:{},applicator1_license:{},applicator2_name:{},applicator2_license:{},pesticide_employer_code:{"ui:widget":"single-select-autocomplete"},pesticide_user_license_number:{},chemical_method_code:{"ui:widget":"single-select-autocomplete"},temperature:{},humidity:{},pest_management_plan:{"ui:widget":"single-select-autocomplete"},invasive_plant_code:{"ui:widget":"single-select-autocomplete"},herbicide:{items:Object(G.a)({},da.Herbicide)},wind_speed:{},wind_direction_code:{"ui:widget":"single-select-autocomplete"},pesticide_use_permit_PUP:{},signage_on_site:{}},pa={pesticide_employer_code:{"ui:widget":"single-select-autocomplete"},pest_management_plan:{"ui:widget":"single-select-autocomplete"},pesticide_use_permit_PUP:{},treatment_issues_code:{"ui:widget":"single-select-autocomplete"},chemical_method_code:{"ui:widget":"single-select-autocomplete"},herbicide:{items:Object(G.a)({},da.Herbicide)},invasive_plant_code:{"ui:widget":"single-select-autocomplete"}},va={activity_date_time:{"ui:widget":"datetime"},latitude:{"ui:readonly":!0},longitude:{"ui:readonly":!0},reported_area:{"ui:readonly":!0},invasive_species_agency_code:{"ui:widget":"single-select-autocomplete"},jurisdictions:{items:Object(G.a)({},da.Jurisdictions)},general_comment:{},access_description:{"ui:widget":"textarea"},project_code:{items:Object(G.a)({},da.ProjectCode)}},fa={Treatment_ChemicalPlant:ma,Activity:va,MonitoringActivity:Object(G.a)(Object(G.a)({},va),{},{access_description:Object(G.a)(Object(G.a)({},va.access_description),{},{"ui:readonly":!0}),jurisdiction_code:{"ui:disabled":!0}}),Activity_BulkEdit:{invasive_species_agency_code:{"ui:widget":"single-select-autocomplete"},jurisdiction_code:{"ui:widget":"single-select-autocomplete"}},Treatment_ChemicalPlant_BulkEdit:pa},ba={Activity_Observation_PlantTerrestrial:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_type_data:Object(G.a)(Object(G.a)({},da.TwoColumnStyle),da.Observation),activity_subtype_data:Object(G.a)({},da.Observation_PlantTerrestrial)},Activity_Observation_PlantTerrestrial_BulkEdit:{activity_data:Object(G.a)(Object(G.a)({},da.TwoColumnStyle),fa.Activity_BulkEdit)},Activity_Observation_PlantAquatic:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_type_data:Object(G.a)(Object(G.a)({},da.TwoColumnStyle),da.Observation),activity_subtype_data:Object(G.a)({},da.Observation_PlantAquatic)},Activity_AnimalActivity_AnimalTerrestrial:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Activity_AnimalTerrestrial)},Activity_AnimalActivity_AnimalAquatic:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_subtype_data:Object(G.a)({},da.Activity_AnimalAquatic)},Activity_Transect_FireMonitoring:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_subtype_data:Object(G.a)({},da.Transect_FireMonitoring)},Activity_Transect_Vegetation:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_subtype_data:Object(G.a)({},da.Transect_Vegetation)},Activity_Transect_BiocontrolEfficacy:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_subtype_data:Object(G.a)({},da.Transect_BiocontrolEfficacy)},Activity_Dispersal_BiologicalDispersal:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Dispersal_BiologicalDispersal)},Activity_Treatment_ChemicalPlant:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Treatment_ChemicalPlant)},Activity_Treatment_ChemicalPlant_BulkEdit:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity_BulkEdit),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Treatment_ChemicalPlant_BulkEdit)},Activity_Treatment_MechanicalPlant:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_type_data:Object(G.a)(Object(G.a)({},da.TwoColumnStyle),da.Treatment),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Treatment_MechanicalPlant)},Activity_Treatment_MechanicalPlant_BulkEdit:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity_BulkEdit),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Treatment_MechanicalPlant_BulkEdit)},Activity_Treatment_BiologicalPlant:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity),activity_type_data:Object(G.a)(Object(G.a)({},da.TwoColumnStyle),da.Treatment),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Treatment_BiologicalPlant)},Activity_Treatment_BiologicalPlant_BulkEdit:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.Activity_BulkEdit),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Treatment_BiologicalPlant_BulkEdit)},Activity_Monitoring_ChemicalTerrestrialAquaticPlant:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.MonitoringActivity),activity_type_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Monitoring)},Activity_Monitoring_MechanicalTerrestrialAquaticPlant:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.MonitoringActivity),activity_type_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Monitoring)},Activity_Monitoring_BiologicalTerrestrialPlant:{activity_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),fa.MonitoringActivity),activity_type_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Monitoring),activity_subtype_data:Object(G.a)(Object(G.a)({},da.ThreeColumnStyle),da.Monitoring_BiologicalTerrestrialPlant)}},ya=a(1021),_a=a(489),ga=a.n(_a),ha=a(488),Oa=a.n(ha),Ea=a(1078),ja=a(1023),xa=u.a.createElement(Oa.a,{fontSize:"small"}),wa=u.a.createElement(ga.a,{fontSize:"small"}),Sa=function(e){var t=e.options.enumDisabled,a=e.options.enumOptions||[];return u.a.createElement(Ea.a,{multiple:!0,autoHighlight:!0,id:e.id,value:e.value?a.filter((function(t){return e.value.includes(t.value)})):[],getOptionSelected:function(e,t){return!(!(null===e||void 0===e?void 0:e.value)||!(null===t||void 0===t?void 0:t.value))&&e.value===t.value},disabled:e.disabled,options:a,disableCloseOnSelect:!0,filterOptions:Object(ja.a)({limit:50}),getOptionLabel:function(e){return e.label},onChange:function(t,a){var n=[];a.forEach((function(e){return n.push(e.value)})),e.onChange(n)},renderOption:function(e,a){var n=a.selected,r=t&&-1!==t.indexOf(e.value);return u.a.createElement(u.a.Fragment,null,u.a.createElement(J.a,{icon:xa,checkedIcon:wa,style:{marginRight:8},checked:n,disabled:r,value:e.value}),e.label)},renderInput:function(t){return u.a.createElement(ya.a,Object.assign({},t,{variant:"outlined",required:e.required,label:e.label||e.schema.title,placeholder:"Begin typing to filter results..."}))}})},Ca=function(e){var t=e.options.enumOptions;t||(t=[]);var a={},n=Object.values(t).map((function(e){return a[e.value]=e.label||e.title||e.value,e.value})),r=e.value||"",i=Object(s.useState)(r),c=Object(_.a)(i,2),o=c[0],l=c[1],d=Object(s.useState)(r?a[r]:""),m=Object(_.a)(d,2),p=m[0],v=m[1];return u.a.createElement("div",null,u.a.createElement(Ea.a,{autoComplete:!0,autoHighlight:!0,autoSelect:e.required,blurOnSelect:!0,openOnFocus:!0,selectOnFocus:!0,clearOnEscape:!e.required,disableClearable:e.required,id:e.id,disabled:e.disabled,clearOnBlur:!1,value:o,onLoad:function(){e.onChange(r)},onChange:function(t,a,n){"clear"===n?(l(""),e.onChange("")):(l(a),e.onChange(a))},options:n,getOptionSelected:function(e){return e===o},filterOptions:Object(ja.a)({stringify:function(e){return e+" "+a[e]}}),getOptionLabel:function(e){return e?a[e]:""},inputValue:p,onInputChange:function(e,t){return v(t)},renderInput:function(t){return u.a.createElement(ya.a,Object.assign({},t,{variant:"outlined",required:e.required,label:e.label||e.schema.title,placeholder:"Begin typing to filter results..."}))}}))},ka=Object(N.a)(Object(G.a)(Object(G.a)({},F),{},{props:{MuiTextField:{variant:"outlined"}}})),Ta=function(e){var t=e.isDisabled||!1;return u.a.createElement(u.a.Fragment,null,u.a.createElement(Y.a,{container:!0,spacing:3},u.a.createElement(Y.a,{container:!0,item:!0,spacing:3},u.a.createElement(Y.a,{item:!0},!e.hideCheckFormForErrors&&u.a.createElement(ce.a,{disabled:t,variant:"contained",color:"primary",onClick:function(){e.onSubmit&&e.onSubmit()}},"Check Form For Errors")),e.onCopy&&u.a.createElement(Y.a,{item:!0},u.a.createElement(ce.a,{disabled:t,variant:"contained",color:"primary",onClick:function(){return e.onCopy()}},"Copy Form Data")),sessionStorage.getItem("copiedFormData")&&sessionStorage.getItem("activitySubtype")===e.activitySubtype&&e.onPaste&&u.a.createElement(Y.a,{item:!0},u.a.createElement(ce.a,{disabled:t,variant:"contained",color:"primary",onClick:function(){return e.onPaste()}},"Paste Form Data")))))},Ia=function(e){var t,a,n,r,o=Ce(),l=Object(s.useState)({schema:null,uiSchema:null}),d=Object(_.a)(l,2),m=d[0],p=d[1],y=Object(s.useState)(null),g=Object(_.a)(y,2),h=g[0],O=g[1];if(Object(s.useEffect)((function(){(function(){var t=Object(c.a)(i.a.mark((function t(){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.getCachedApiSpec();case 2:a=t.sent,p({schema:Object(G.a)(Object(G.a)({},a.components.schemas[e.activity.activitySubtype]),{},{components:a.components}),uiSchema:ba[e.activity.activitySubtype]});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[e.activity.activitySubtype]),!m.schema||!m.uiSchema)return u.a.createElement(b.a,null);var E=e.isDisabled||(null===(t=e.activity)||void 0===t||null===(a=t.sync)||void 0===a?void 0:a.status)===fe.SYNC_SUCCESSFUL||!1;return u.a.createElement(v.a,{width:"100%"},u.a.createElement(v.a,{mb:3},u.a.createElement(Ta,{onSubmit:function(){return h.submit()},isDisabled:E,onCopy:e.copyFormData?function(){return e.copyFormData()}:null,onPaste:e.pasteFormData?function(){return e.pasteFormData()}:null,activitySubtype:e.activity.activitySubtype,hideCheckFormForErrors:e.hideCheckFormForErrors})),u.a.createElement(f.a,{theme:ka},u.a.createElement(ct.a,{ObjectFieldTemplate:Bt,FieldTemplate:Dt,ArrayFieldTemplate:Ct,widgets:{"multi-select-autocomplete":Sa,"single-select-autocomplete":Ca},key:null===(n=e.activity)||void 0===n?void 0:n._id,disabled:E,formData:(null===(r=e.activity)||void 0===r?void 0:r.formData)||null,schema:m.schema,uiSchema:m.uiSchema,liveValidate:!1,showErrorList:!0,validate:e.customValidation,transformErrors:e.customErrorTransformer,autoComplete:"off",ErrorList:function(){return u.a.createElement("div",null,u.a.createElement(H.a,{color:"error",variant:"h5"},"The form contains one or more errors!"),u.a.createElement(H.a,{color:"error",variant:"h6"},"Incorrect fields are highlighted below."))},onChange:function(t){e.onFormChange&&e.onFormChange(t,h)},onError:function(t){e.onFormSubmitError&&e.onFormSubmitError(t,h)},onSubmit:function(t){e.onFormSubmitSuccess&&e.onFormSubmitSuccess(t,h)},ref:function(t){t&&(e.setParentFormRef&&e.setParentFormRef(t),O(t))}},u.a.createElement(u.a.Fragment,null))),u.a.createElement(v.a,{mt:3},u.a.createElement(Ta,{onSubmit:function(){return h.submit()},isDisabled:E,onCopy:e.copyFormData?function(){return e.copyFormData()}:null,onPaste:e.pasteFormData?function(){return e.pasteFormData()}:null,activitySubtype:e.activity.activitySubtype,hideCheckFormForErrors:e.hideCheckFormForErrors})))},Aa=a(22),Da=(a(842),a(843),a(844),a(845),a(846),a(847),a(849),a(850),function(){return u.a.createElement("svg",{viewBox:"0 0 50 50",className:"spinner"},u.a.createElement("circle",{cx:"25",cy:"25",r:"20",className:"path",fill:"none",stroke:"rgba(0,0,0,0.7)",strokeWidth:"3",strokeLinecap:"round"}))}),Pa=(a(851),a(64)),Na=a(252),Fa=function(e){var t,a=null===(t=e.geometry[0])||void 0===t?void 0:t.geometry.coordinates,n=1e5;"Polygon"===e.geometry[0].geometry.type&&(null===a||void 0===a?void 0:a[0])&&(n/=a[0].reduce((function(e,t){return t[1]>e?t[1]:e}),0)-a[0].reduce((function(e,t){return t[1]<e?t[1]:e}),n));return n},Ma=window.location.hostname;switch(!0){case/^localhost/.test(Ma):Ue="http://localhost:8080";break;case/^dev.*/.test(Ma):Ue="https://invasivesbci-geoserver-dev-7068ad-dev.apps.silver.devops.gov.bc.ca";break;case/^test.*/.test(Ma):Ue="https://invasivesbci-geoserver-tst-7068ad-tst.apps.silver.devops.gov.bc.ca";break;case/^invasivesbc.*/.test(Ma):Ue="https://invasivesbci-geoserver-7068ad.apps.silver.devops.gov.bc.ca"}var Ra=function(e){var t,a=Object(s.useContext)(x),n=Object(s.useRef)(null),r=Object(s.useRef)([]),o=Object(s.useState)(new Aa.FeatureGroup),l=Object(_.a)(o,2),d=l[0],m=l[1],p=Object(s.useState)({}),v=Object(_.a)(p,2),f=v[0],b=v[1],g=Object(s.useState)(!1),h=Object(_.a)(g,2),O=h[0],E=h[1],j=function(e){return Aa.control.savetiles(e,{zoomlevels:[13,14,15,16,17],confirm:function(e,t){t(!0),console.log("increment a counter here")}})},w=function(e){if(e){var t=[[e._northEast.lat,e._northEast.lng],[e._southWest.lat,e._southWest.lng]];n.current.fitBounds(t)}},S=Object(s.useState)(null),C=Object(_.a)(S,2),k=C[0],T=C[1];Object(s.useEffect)((function(){}),[k]);var I=function(){n.current=Aa.map(e.mapId,{zoomControl:!1}).setView([55,-128],10),T(n.current.getZoom()),n.current.on("contextmenu",(function(t){e.contextMenuState.setContextMenuState({isOpen:!0,lat:t.latlng.lat,lng:t.latlng.lng})})),n.current.addControl(Aa.control.locate({icon:"bullseye",flyTo:!0,iconElementTag:"div"})),e.showDrawControls&&function(){var e=new Aa.Control.Draw({position:"topright",draw:{marker:!1,circle:!0},edit:{featureGroup:d,remove:!0,edit:!0}});n.current.addControl(e)}();var t=Aa.tileLayer.offline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:24,maxNativeZoom:17,attribution:'&copy; <a href="https://www.esri.com/en-us/arcgis/products/location-services/services/basemaps">ESRI Basemap</a>'}),a=Aa.tileLayer.offline("https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",{maxZoom:24,maxNativeZoom:17}),o=Aa.tileLayer.offline("https://maps.gov.bc.ca/arcgis/rest/services/province/roads_wm/MapServer/tile/{z}/{y}/{x}",{maxZoom:24,useCache:!0,cacheMaxAge:6048e5});t.addTo(n.current);var l={"Esri Imagery":t,"BC Government":o},s=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_ADMIN_BOUNDARIES.ADM_NR_DISTRICTS_SPG@EPSG:3857@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),u=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_ADMIN_BOUNDARIES.TADM_MOT_DISTRICT_BNDRY_POLY@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),m=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_ADMIN_BOUNDARIES.TADM_MOT_REGIONAL_BNDRY_POLY@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),p=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_FOREST_VEGETATION.BEC_BIOGEOCLIMATIC_POLY@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),v=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_WATER_MANAGEMENT.GW_WATER_WELLS_WRBC_SVW@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),f=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_BASEMAPPING.FWA_STREAM_NETWORKS_SP@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),b=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_BASEMAPPING.FWA_WETLANDS_POLY@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),y=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:regional_invasive_species_organization_areas@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.6,tms:!0}),_=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:invasive_plant_management_areas@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.6,tms:!0}),g=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_WILDLIFE_MANAGEMENT.WCP_UNGULATE_WINTER_RANGE_SP@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.6,tms:!0}),h=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_ADMIN_BOUNDARIES.CLAB_NATIONAL_PARKS@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.6,tms:!0}),O=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:aggregate_tenures@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),E=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_TANTALIS.TA_SURFACE_OWNERSHIP_SVW@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.4,tms:!0}),x=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_LEGAL_ADMIN_BOUNDARIES.ABMS_MUNICIPALITIES_SP@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.4,tms:!0}),S=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_LEGAL_ADMIN_BOUNDARIES.ABMS_REGIONAL_DISTRICTS_SP@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.4,tms:!0}),C=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:jurisdiction@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.4,tms:!0}),k=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_IMAGERY_AND_BASE_MAPS.MOT_ROAD_FEATURES_INVNTRY_SP@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),I=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_LAND_USE_PLANNING.RMP_OGMA_LEGAL_CURRENT_SVW@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.8,tms:!0}),A=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_WILDLIFE_MANAGEMENT.WCP_WILDLIFE_HABITAT_AREA_POLY@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.6,tms:!0}),D=Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_WILDLIFE_MANAGEMENT.WCP_FISH_SENSITIVE_WS_POLY@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.6,tms:!0}),P={Placenames:a,Wells:v,"Gravel Pits":O,Streams:f,Wetlands:b,Ownership:E,"Invasive Plant Management Areas":_,"Regional Invasive Species Organization Areas":y,"Natural Resource Districts":s,Municipalites:x,"Regional Districts":S,"Road Features Inventory":k,Biogeoclimatic:p,"MOTI Regions":m,"MOTI Districts":u,Jurisdictions:C,"Old Growth Management Areas":I,"Wildlife Habitat Areas":A,"First Nations Reserves":Aa.tileLayer.offline("".concat(Ue,"/geoserver/gwc/service/tms/1.0.0/invasives:WHSE_ADMIN_BOUNDARIES.CLAB_INDIAN_RESERVES@EPSG:900913@png/{z}/{x}/{y}.png"),{opacity:.6,tms:!0}),"Fisheries Sensitive Watersheds":D,"Ungulate Winter Range":g,"National Parks":h};n.current.addLayer(a);var N=j(t);N._map=n.current,r.current.push(N);var F,M,R=j(o);R._map=n.current,r.current.push(R),F=l,M=P,n.current.addControl(Aa.control.layers(F,M,{position:"topleft"})),w(n.current.getBounds()),n.current.on("dragend",(function(){e.extentState.setExtent(n.current.getBounds())})),n.current.on("zoomend",(function(){e.extentState.setExtent(n.current.getBounds()),T(n.current.getZoom())})),n.current.on("draw:created",(function(t){var a=t.layer.toGeoJSON();"circle"===t.layerType?a=Object(G.a)(Object(G.a)({},a),{},{properties:Object(G.a)(Object(G.a)({},a.properties),{},{radius:t.layer.getRadius()})}):"rectangle"===t.layerType&&(a=Object(G.a)(Object(G.a)({},a),{},{properties:Object(G.a)(Object(G.a)({},a.properties),{},{isRectangle:!0})})),a=L(a),e.geometryState.setGeometry([a])}));var L=function(e){if("LineString"===e.geometry.type){var t=prompt("Enter buffer width (total) in meters","1"),a=Pa.buffer(e.geometry,parseInt(t,10)/1e3,{units:"kilometers",steps:1}),n=Pa.featureCollection([a,e.geometry]);return Object(G.a)(Object(G.a)({},e),{},{geometry:n.features[0].geometry})}return e};n.current.on("draw:editstop",Object(c.a)(i.a.mark((function t(){var a,n,r,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=null===d||void 0===d||null===(a=d.toGeoJSON())||void 0===a?void 0:a.features[0],d.getLayers()[0]._mRadius&&(c=null===(r=d.getLayers()[0])||void 0===r?void 0:r.getRadius(),n=Object(G.a)(Object(G.a)({},n),{},{properties:Object(G.a)(Object(G.a)({},n.properties),{},{radius:c})})),(n=L(n))&&e.geometryState.setGeometry([n]);case 4:case"end":return t.stop()}}),t)})))),n.current.on("draw:deleted",(function(){var t,a,n=null===d||void 0===d||null===(t=d.toGeoJSON())||void 0===t?void 0:t.features[0];e.geometryState.setGeometry(null===(a=e.geometryState.geometry)||void 0===a?void 0:a.filter((function(e){return JSON.stringify(e)===JSON.stringify(n)})))}))};Object(s.useEffect)((function(){return I(),function(){n.current&&n.current.remove()}}),[a]),Object(s.useEffect)((function(){var t;n.current&&(null===(t=e.geometryState)||void 0===t?void 0:t.geometry)&&(function(){var t,a,r,i;if((null===(t=e.geometryState)||void 0===t||null===(a=t.geometry)||void 0===a?void 0:a.length)&&("Point"!==(null===(r=e.geometryState)||void 0===r?void 0:r.geometry[0].geometry.type)||(null===(i=e.geometryState)||void 0===i?void 0:i.geometry[0].radius))){var c={type:"FeatureCollection",features:Object(y.a)(e.geometryState.geometry)},o=Pa.bbox(c);n.current.fitBounds([[o[1],o[0]],[o[3],o[2]]])}}(),function(){var t,a=Object(G.a)({},f);e.geometryState&&e.geometryState.geometry.forEach((function(e){var t={radius:10,weight:4,stroke:!0};Aa.geoJSON(e,{style:{weight:4,opacity:.65},pointToLayer:function(e,a){return e.properties.radius?Aa.circle(a,{radius:e.properties.radius}):Aa.circleMarker(a,t)},onEachFeature:function(e,t){d.addLayer(t)}})})),(null===(t=e.interactiveGeometryState)||void 0===t?void 0:t.interactiveGeometry)&&e.interactiveGeometryState.interactiveGeometry.forEach((function(e){var t=e.recordDocID||e._id;if(a[t]&&a[t].hash===JSON.stringify(e)&&!0!==a[t])a[t]=Object(G.a)(Object(G.a)({},a[t]),{},{updated:!1});else{var r={color:e.color,weight:4,opacity:.65},i={radius:10,weight:4,stroke:!0},c=Aa.geoJSON(e.geometry,{style:r,pointToLayer:function(e,t){return e.properties.radius?Aa.circle(t,{radius:e.properties.radius}):Aa.circleMarker(t,i)},onEachFeature:function(t,a){var r=e.popUpComponent(e.description);a.on("click",(function(){var a="<table><tr><th>Attribute</th><th>Value</th></tr>";Object.keys(t.properties).forEach((function(e){"uploadedSpatial"!==e&&(a+="<tr><td>".concat(e,"</td><td>").concat(t.properties[e],"</td></tr>"))})),a+="</table>";var i=Pa.centroid(t),c=[i.geometry.coordinates[1],i.geometry.coordinates[0]];t.properties.uploadedSpatial?Aa.popup().setLatLng(c).setContent(a).openOn(n.current):Aa.popup().setLatLng(c).setContent(r).openOn(n.current),e.onClickCallback()}))}});a[t]={hash:JSON.stringify(e),geo:c,updated:!0}}})),Object.keys(a).forEach((function(e){if(!0!==a[e].updated)return!1===a[e].updated?void 0:(Object.values(a[e].geo._layers).forEach((function(e){d.removeLayer(e)})),void delete a[e]);Object.values(a[e].geo._layers).forEach((function(e){d.addLayer(e)})),delete a[e].updated})),b(a),m(d),n.current=n.current.addLayer(d)}())}),[e.geometryState.geometry,null===e||void 0===e||null===(t=e.interactiveGeometryState)||void 0===t?void 0:t.interactiveGeometry]),Object(s.useEffect)((function(){var t;n.current&&(null===(t=e.extentState)||void 0===t?void 0:t.extent)&&w(e.extentState.extent)}),[e.extentState.extent]);var A=Object(s.useState)(null),D=Object(_.a)(A,2),P=D[0],N=D[1],F=function(){var e=Object(c.a)(i.a.mark((function e(t){var r,c,o,l,s,u,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N("Yum yum yum"),r=null===t||void 0===t?void 0:t.name,r.replace(/\..*/g,"").replace(/[^\w]/g,"_"),e.next=5,t.text().then((function(e){return e}));case 5:if(c=e.sent,o=(new DOMParser).parseFromString(c,"application/xml"),l=Object(Na.kml)(o),s=Pa.bbox(l),u=Aa.latLng(s[1],s[0]),d=Aa.latLng(s[3],s[2]),n.current.flyToBounds([u,d]),!(null===l||void 0===l?void 0:l.features)){e.next=15;break}return e.next=15,a.database.upsert("spatial_uploads",(function(e){return console.log("spatial_uploads",e),l.features.forEach((function(e,t){l.features[t].properties.uploadedSpatial=!0})),Object(G.a)(Object(G.a)({},e),{},{docType:ye.SPATIAL_UPLOADS,geometry:e.geometry?[].concat(Object(y.a)(l.features),Object(y.a)(e.geometry)):l.features})}));case 15:N(null);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(c.a)(i.a.mark((function e(){var t,o,l,s,u,d,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E(!0),t=n.current.getBounds(),o=t.getWest(),l=t.getSouth(),s=t.getEast(),u=t.getNorth(),d=[o,l,s,u],(m=[{name:"Wells",schema:"WHSE_WATER_MANAGEMENT.GW_WATER_WELLS_WRBC_SVW"}]).forEach(function(){var e=Object(c.a)(i.a.mark((function e(t,n){var r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://openmaps.gov.bc.ca/geo/pub/wfs?service=WFS&version=1.1.0&request=GetFeature&typeName=pub:".concat(t.schema,"&outputFormat=json&srsName=epsg:4326&bbox=").concat(d,",epsg:4326"),e.next=3,Oe()(r);case 3:return c=e.sent,e.next=6,a.database.upsert("offline_data",(function(e){var t,a;return{docType:ye.OFFLINE_DATA,geometry:(null===(t=e.geometry)||void 0===t||null===(a=t.features)||void 0===a?void 0:a.length)>0?[].concat(Object(y.a)(e.geometry.features),Object(y.a)(c.data.features)):c.data.features}}));case 6:n==m.length-1&&E(!1);case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),e.abrupt("return");case 15:r.current.forEach((function(e,t){setTimeout((function(){e._saveTiles(),t===r.current.length-1&&E(!1)}),1e3*t)}));case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return u.a.createElement("div",{id:e.mapId,className:e.classes.map,onDragEnter:function(e){var t,a;switch(e.preventDefault(),null===e||void 0===e||null===(t=e.dataTransfer)||void 0===t||null===(a=t.items[0])||void 0===a?void 0:a.type){case"application/vnd.google-earth.kmz":N("Sorry... KMZ files are currently not supported. Please unzip and provide the internal KML.");break;case"application/vnd.google-earth.kml+xml":N("I love to eat KML files");break;default:N(null)}},onDragOver:function(e){return e.preventDefault()},onDrop:function(e){var t;e.preventDefault(),N(null);var a=null===e||void 0===e||null===(t=e.dataTransfer)||void 0===t?void 0:t.files[0],n=null===a||void 0===a?void 0:a.type;null===a||void 0===a||a.name;switch(n){case"application/vnd.google-earth.kmz":N("Yuck! KMZs are nasty");break;case"application/vnd.google-earth.kml+xml":F(a);break;default:N(null)}}},"// The drop zone for uploading files",u.a.createElement("div",{style:P?{backgroundColor:"rgba(255,255,255,0.4)",fontSize:"2.5rem",fontWeight:800,color:"white",zIndex:1e4,position:"absolute",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",padding:"10rem",outline:"1rem dashed white",outlineOffset:"-6rem"}:{display:"none"},onDragLeave:function(e){e.preventDefault(),N(null)}}," ",P," "),u.a.createElement("div",{id:"offline-layers-button",title:"Offline layers",onClick:M,style:{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",backgroundColor:"white",color:"#464646",width:"2.7rem",height:"2.7rem",top:"148px",left:"5px",zIndex:1e3,borderRadius:"4px",cursor:"pointer"}},O?u.a.createElement(Da,null):u.a.createElement("img",{src:"/assets/icon/download.svg",style:{transform:"scale(0.7)",opacity:"0.7"}})))},La=a(528),Ba=a(1026),Wa=a(1027),za=a(1028),Ga=a(1029),Ua=function(e){var t=Object(La.a)().getPhoto,a=function(){var a=Object(c.a)(i.a.mark((function a(){var n,r,c;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t({resultType:o.a.DataUrl,source:o.b.Camera,quality:100});case 2:n=a.sent,r=(new Date).getTime()+"."+n.format,c={filepath:r,dataUrl:n.dataUrl},e.photoState.setPhotos([].concat(Object(y.a)(e.photoState.photos),[c]));case 6:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),n=function(){var t=Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.photoState.setPhotos([]);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),r=function(){var t=Object(c.a)(i.a.mark((function t(a){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.photoState.photos.filter((function(e){return e.filepath!==a})),e.photoState.setPhotos(n);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return e.photoState?u.a.createElement(v.a,{width:1},u.a.createElement(v.a,{mb:3},u.a.createElement(Y.a,{container:!0},u.a.createElement(Y.a,{container:!0,item:!0},e.photoState.photos.map((function(t,a){return u.a.createElement(Y.a,{item:!0,xs:12,sm:6,md:4,lg:3,key:a},u.a.createElement(Ba.a,null,u.a.createElement(Wa.a,{src:t.dataUrl,component:"img"}),!e.isDisabled&&u.a.createElement(za.a,null,u.a.createElement(te.a,{onClick:function(){return r(t.filepath)}},u.a.createElement(oe.a,null)))))}))))),!e.isDisabled&&u.a.createElement(v.a,null,u.a.createElement(Y.a,{container:!0},u.a.createElement(Y.a,{container:!0,item:!0,spacing:3,justify:"center"},u.a.createElement(Y.a,{item:!0},u.a.createElement(ce.a,{variant:"contained",color:"primary",startIcon:u.a.createElement(Ga.a,null),onClick:function(){return a()}},"Add A Photo")),u.a.createElement(Y.a,{item:!0},u.a.createElement(ce.a,{variant:"contained",startIcon:u.a.createElement(oe.a,null),onClick:function(){return n()}},"Remove All Photos")))))):u.a.createElement(b.a,null)},qa=a(339),Ya=function(e){var t=Object(qa.b)(),a=t.currentPosition,n=t.startWatch,r=t.clearWatch,o=Object(qa.a)().getPosition,l=Object(s.useState)([]),d=Object(_.a)(l,2),m=d[0],p=d[1],v=Object(s.useContext)(x);Object(s.useEffect)((function(){o()}),[]);var f=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({enableHighAccuracy:!0}),Ae(v,JSON.stringify("Starting track."));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){var t=Object(c.a)(i.a.mark((function t(){var a,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m.length>=4?(a=Pa.lineString(m),n=Pa.lineToPolygon(a),window.confirm("Convert track to polygon?")?(e.geometryState.setGeometry([n]),Ae(v,JSON.stringify("Made a polygon!!  ")),r()):(Ae(v,JSON.stringify("Made a polyine!!  ")),r())):window.confirm("Sure you're done walkin'?  Didn't collect 4 points.")&&(alert("Cancelled track."),r());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(s.useEffect)((function(){if(a)if(0==m.length){var t=[[a.coords.longitude,a.coords.latitude]];p(t);var n=JSON.parse('\n          {\n            "type": "Feature",\n            "geometry": {\n              "type": "LineString",\n              "coordinates": '+JSON.stringify(t)+'\n            },\n            "properties": {\n            }\n          }\n          ');e.geometryState.setGeometry([n])}else try{if(function(e,t,a){var n=null;try{var r=Pa.point(e),i=Pa.point(t);n=Pa.distance(r,i,{units:"kilometers"})>a}catch(c){console.dir(c)}return n}([a.coords.longitude,a.coords.latitude],m[m.length-1],.001)){p([].concat(Object(y.a)(m),[[a.coords.longitude,a.coords.latitude]]));var r=JSON.parse('\n          {\n            "type": "Feature",\n            "geometry": {\n              "type": "LineString",\n              "coordinates": '+JSON.stringify(m)+'\n            },\n            "properties": {\n            }\n          }\n          ');e.geometryState.setGeometry([r])}}catch(i){Ae(v,JSON.stringify("Computer says no.  "+JSON.stringify(i)))}}),[a]),u.a.createElement(u.a.Fragment,null,e.cloneActivityButton&&e.cloneActivityButton(),e.linkedActivity&&u.a.createElement(u.a.Fragment,null,u.a.createElement(at.a,null,u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-form-content",id:"panel-form-header"},u.a.createElement(H.a,{className:e.classes.heading},"Linked Activity Form")),u.a.createElement(rt.a,{className:e.classes.formContainer},u.a.createElement(Ia,Object(G.a)(Object(G.a)({},e),{},{activity:e.linkedActivity,isDisabled:!0})))),e.linkedActivity.photos.length>0&&u.a.createElement(at.a,null,u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-photo-content",id:"panel-photo-header"},u.a.createElement(H.a,{className:e.classes.heading},"Linked Activity Photos")),u.a.createElement(rt.a,{className:e.classes.photoContainer},u.a.createElement(Ua,Object(G.a)(Object(G.a)({},e),{},{activity:e.linkedActivity,isDisabled:!0}))))),u.a.createElement(at.a,{defaultExpanded:!0},u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-map-content",id:"panel-map-header"},u.a.createElement(H.a,{className:e.classes.heading},"Map")),u.a.createElement(rt.a,null,u.a.createElement(Y.a,{xs:12,alignItems:"flex-start",container:!0},u.a.createElement(Y.a,{xs:2,item:!0},u.a.createElement(ce.a,{variant:"contained",color:"primary",onClick:f},"Record a Polygon!")),u.a.createElement(Y.a,{xs:2,item:!0},u.a.createElement(ce.a,{disabled:!0,variant:"contained",color:"primary",onClick:f},"Record Buffered Line!")),u.a.createElement(Y.a,{xs:2,item:!0},u.a.createElement(ce.a,{variant:"contained",color:"secondary",onClick:b},"End Track Recording")),u.a.createElement(Y.a,{xs:12,className:e.classes.mapContainer,item:!0},u.a.createElement(Ra,e))))),u.a.createElement(at.a,null,u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-form-content",id:"panel-form-header"},u.a.createElement(H.a,{className:e.classes.heading},"Activity Form")),u.a.createElement(rt.a,{className:e.classes.formContainer},u.a.createElement(Ia,e))),u.a.createElement(at.a,null,u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-photo-content",id:"panel-photo-header"},u.a.createElement(H.a,{className:e.classes.heading},"Activity Photos")),u.a.createElement(rt.a,{className:e.classes.photoContainer},u.a.createElement(Ua,e))))},Va=function(e,t){var a;return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];a&&clearTimeout(a),a=setTimeout((function(){t.apply(void 0,r),a=null}),e)}},Ha={14725:9.5,9528:4.75,5931:4,14726:5.5,23713:3,31641:11.5,23957:4.6,29249:5.2,29888:8,27856:3.25,21053:8,29334:8,28945:5,27634:9.3,31642:6.2,30841:7,27801:12,23545:.83,32957:.292,28517:.5,26722:4.6,27884:3,30203:4.68,30063:1.7,28551:.5,28552:2.6,26271:.02,22759:10,28198:8,27487:8,29498:8,9007:17.3,9005:4.67,27972:5.5,26980:9.2,27615:9,29994:9,28840:9};function Ja(e){return function(t,a){var n,r=Object(z.a)(e);try{for(r.s();!(n=r.n()).done;){a=(0,n.value)(t,a)}}catch(i){r.e(i)}finally{r.f()}return a}}function Qa(e){return function(t,a){var n=Number.POSITIVE_INFINITY;return["Activity_Treatment_MechanicalPlant","Activity_Observation_PlantTerrestrial","Activity_Treatment_ChemicalPlant"].includes(e)&&(n=5e4),a.activity_data.reported_area.__errors=[],t.activity_data.reported_area>n&&a.activity_data.reported_area.addError("Area cannot exceed ".concat(n," m\xb2")),a}}function Ka(e){return function(t,a){if("Activity_Observation_PlantTerrestrial"!==e||!t||!t.activity_subtype_data||!t.activity_subtype_data.invasive_plants||!t.activity_subtype_data.invasive_plants.length)return a;var n=t.activity_subtype_data.invasive_plants,r=[];return n.forEach((function(e){r.push(e.invasive_plant_code)})),a&&a.activity_subtype_data&&a.activity_subtype_data.invasive_plants?(a.activity_subtype_data.invasive_plants.__errors=[],new Set(r).size!==r.length&&a.activity_subtype_data.invasive_plants.addError("There are duplicated invasive plant species identified.\n        Please remove or fix duplicated species."),a):a}}function $a(e){return function(t,a){if("Activity_Treatment_ChemicalPlant"!==e)return a;a.activity_subtype_data.temperature.__errors=[];var n=t.activity_subtype_data.temperature;return(n<10||n>30)&&a.activity_subtype_data.temperature.addError("Temperature should ideally be between 15 and 22 degrees"),a}}function Za(e){return function(t,a){if("Activity_Treatment_ChemicalPlant"!==e)return a;a.activity_subtype_data.wind_direction_code.__errors=[];var n=t.activity_subtype_data,r=n.wind_speed,i=n.wind_direction_code;return r>0&&"No Wind"===i&&a.activity_subtype_data.wind_direction_code.addError("Must specify a wind direction when wind speed is > 0"),0===r&&"No Wind"!==i&&a.activity_subtype_data.wind_direction_code.addError("Cannot specify a wind direction when wind speed is 0"),a}}function Xa(e){return function(t,a){var n,r,i=null===e||void 0===e||null===(n=e.formData)||void 0===n||null===(r=n.activity_subtype_data)||void 0===r?void 0:r.invasive_plants,c=(null===t||void 0===t?void 0:t.activity_subtype_data).invasive_plant_code;return i&&c?(a.activity_subtype_data.invasive_plant_code.__errors=[],i.some((function(e){return e.invasive_plant_code===c}))||a.activity_subtype_data.invasive_plant_code.addError("You must select a species that was previously observed in the linked activity"),a):a}}function en(){return function(e,t){return e&&e.activity_subtype_data&&e.activity_subtype_data.herbicide&&e.activity_subtype_data.herbicide.length?(e.activity_subtype_data.herbicide.forEach((function(e,a){if(!t||!t.activity_subtype_data||!t.activity_subtype_data.herbicide||!t.activity_subtype_data.herbicide[a]||!t.activity_subtype_data.herbicide[a].application_rate)return t;t.activity_subtype_data.herbicide[a].application_rate.__errors=[],e.application_rate&&e.application_rate>Ha[e.liquid_herbicide_code]&&t.activity_subtype_data.herbicide[a].application_rate.addError("Application rate exceeds maximum applicable rate of ".concat(Ha[e.liquid_herbicide_code]," L/ha for this herbicide"))})),t):t}}function tn(){return function(e,t){if(!e||!e.activity_subtype_data)return t;var a=Object.keys(e.activity_subtype_data).filter((function(e){return e.includes("transect_lines")}));if(!a.length)return t;var n="vegetation_transect_lines"===a[0];return Object(y.a)(e.activity_subtype_data[a[0]]).forEach((function(e,r){var i,c=null===e||void 0===e||null===(i=e.transect_line)||void 0===i?void 0:i.transect_length,o=Object.keys(e).filter((function(e){return e.includes("transect_points")}));if(!o.length)return t;e[o[0]].forEach((function(e,i){var l=t.activity_subtype_data[a[0]][r][o[0]][i];if(!(l=function(e,t,a,n){if(e){if(!t.vegetation_transect_points.offset_distance)return null;n.vegetation_transect_points.offset_distance.__errors=[]}else{if(!t.offset_distance)return null;n.offset_distance.__errors=[]}if((e?t.vegetation_transect_points.offset_distance:t.offset_distance)>a){var r="Offset distance for a transect point cannot exceed the length of the associated transect line";e?n.vegetation_transect_points.offset_distance.addError(r):n.offset_distance.addError(r)}return n}(n,e,c,l)))return t}))})),t}}function an(e){Object(G.a)({},e);if(!e||!e.herbicide||"{}"===JSON.stringify(e.herbicide[0]))return e;var t=Object(y.a)(e.herbicide),a=[];return t.forEach((function(e){var t=Object(G.a)({},e);t.application_rate&&t.herbicide_amount&&t.liquid_herbicide_code&&t.mix_delivery_rate?(t.specific_treatment_area=parseFloat((t.herbicide_amount/t.mix_delivery_rate).toFixed(4)),t.dilution=parseFloat((100*t.application_rate/t.mix_delivery_rate).toFixed(4)),t.tank_volume=parseFloat((100*t.herbicide_amount/t.dilution).toFixed(4))):(delete t.specific_treatment_area,delete t.dilution,delete t.tank_volume),a.push(t)})),Object(G.a)(Object(G.a)({},e),{},{herbicide:"{}"!==JSON.stringify(a[0])&&a||e.herbicide})}function nn(e){var t=Object(G.a)({},e),a=Object.keys(t).filter((function(e){return e.includes("transect_lines")}));if(!a.length)return e;var n="biocontrol_efficacy_transect_lines"===a[0],r="biological_dispersals"===a[0],i="vegetation_transect_lines"===a[0],c=Object(y.a)(e[a[0]]),o=[];return c.forEach((function(e){var t=Object(G.a)({},e),a=Object.keys(t).filter((function(e){return e.includes("transect_points")})),c=Object(G.a)({},t.transect_line),l=c.start_x_utm,s=c.end_x_utm,u=c.start_y_utm,d=c.end_y_utm,m=s-l,p=d-u;if(l&&s&&u&&d){var v=Math.atan(m/p)*(180/Math.PI);m>0&&p<0?v+=180:m<0&&p<0&&(v-=180),c.transect_bearing=parseFloat(v.toFixed(1)),c.transect_length=parseFloat(Math.hypot(m,p).toFixed(1))}else delete c.transect_bearing,delete c.transect_length;if(a.length){var f=Object(y.a)(t[a[0]]),b=[];f.forEach((function(e){var t=Object(G.a)({},e),a=Object(G.a)({},t.vegetation_transect_points),o=(a||t).offset_distance;if(o&&o<=c.transect_length){var s=o/c.transect_length,d=parseFloat((l+s*m).toFixed(1)),v=parseFloat((u+s*p).toFixed(1));i?(a.utm_x=d,a.utm_y=v,t.vegetation_transect_points=a):(t.utm_x=d,t.utm_y=v)}else i?(delete a.utm_x,delete a.utm_y,t.vegetation_transect_points=a):(delete t.utm_x,delete t.utm_y);if(n){var f=t.veg_transect_native_forbs,y=t.veg_transect_grasses,_=t.veg_transect_bare_ground,g=t.veg_transect_shrubs,h=t.veg_transect_bryophytes,O=t.veg_transect_litter;f&&y&&_&&g&&h&&O?t.veg_total_percentage=f+y+_+g+h+O:delete t.veg_total_percentage}if(r){var E=t.phen_level_se,j=t.phen_level_ro,x=t.phen_level_bo,w=t.phen_level_fl,S=t.phen_level_sf,C=t.phen_level_sc;E&&j&&x&&w&&S&&C?t.phen_total_percentage=E+j+x+w+S+C:delete t.phen_total_percentage}b.push(t)})),o.push(Object(G.a)(Object(G.a)({},t),{},Object(U.a)({transect_line:c},a[0],b)))}else o.push(Object(G.a)(Object(G.a)({},t),{},{transect_line:c}))})),t=Object(G.a)(Object(G.a)({},e),{},Object(U.a)({},a[0],o.length&&o))}function rn(e){var t=e.formData,a=Object(G.a)({},t.activity_data),n=Object(G.a)(Object(G.a)({},a),JSON.parse(sessionStorage.getItem("copiedFormData")).activity_data);return Object(G.a)(Object(G.a)({},JSON.parse(sessionStorage.getItem("copiedFormData"))),{},{activity_data:n})}function cn(e){var t=0;if(!e||!e.length||"LineString"===e[e.length-1].geometry.type)return t;var a=e[e.length-1];return"Point"!==a.geometry.type||a.properties.hasOwnProperty("radius")?"Point"===a.geometry.type&&a.properties.hasOwnProperty("radius")?t=Math.PI*Math.pow(a.properties.radius,2):"Polygon"===a.geometry.type&&(t=Pa.area(Pa.polygon(a.geometry.coordinates))):t=1,parseFloat(t.toFixed(0))}function on(e){if(e&&e[e.length-1]&&e[e.length-1].geometry){var t=e[e.length-1].geometry,a=t.coordinates[0],n=null,r=null;if("Point"===t.type)n=t.coordinates[1],r=a;else if("LineString"===t.type)n=a[1],r=a[0];else if(e[0].properties.isRectangle){var i=Pa.center(Pa.polygon(t.coordinates)).geometry;n=i.coordinates[1],r=i.coordinates[0]}else n=a[0][1],r=a[0][0];return{latitude:parseFloat(n.toFixed(6)),longitude:parseFloat(r.toFixed(6))}}}var ln=Object(q.a)((function(e){return{heading:{fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular},mapContainer:{height:"600px"},map:{height:"100%",width:"100%",zIndex:0}}})),sn=function(e){var t=ln(),a=Object(s.useContext)(x),n=Object(s.useState)(!0),r=Object(_.a)(n,2),o=r[0],l=r[1],d=Object(s.useState)(null),m=Object(_.a)(d,2),p=m[0],f=m[1],y=Object(s.useState)(!1),g=Object(_.a)(y,2),h=g[0],O=g[1],E=Object(s.useState)([]),j=Object(_.a)(E,2),w=j[0],S=j[1],C=Object(s.useState)(null),k=Object(_.a)(C,2),T=k[0],I=k[1],A=Object(s.useState)({isOpen:!1,lat:0,lng:0}),D=Object(_.a)(A,2),P=D[0],N=D[1],F=Object(s.useState)(null),M=Object(_.a)(F,2),R=M[0],L=M[1],B=R&&R._id,z=Object(s.useState)([]),U=Object(_.a)(z,2),q=U[0],Y=U[1],V=function(e){var t=(e.formData||{}).activity_data;return Object(G.a)(Object(G.a)({},e.formData),{},{activity_data:Object(G.a)(Object(G.a)({},t),{},{reported_area:cn(e.geometry)})})},J=Object(s.useCallback)((function(e){L((function(t){var n=on(e)||{},r=n.latitude,i=n.longitude,c=t.formData,o=cn(e),l=Object(G.a)(Object(G.a)({},c),{},{activity_data:Object(G.a)(Object(G.a)({},c.activity_data),{},{latitude:r,longitude:i,reported_area:o})});return a.database.upsert(t._id,(function(a){return Object(G.a)(Object(G.a)(Object(G.a)({},a),t),{},{formData:l,geometry:e,status:ve.EDITED,dateUpdated:new Date})})),Object(G.a)(Object(G.a)({},t),{},{formData:l,geometry:e,status:ve.EDITED,dateUpdated:new Date})}))}),[a.database]),Q=Object(s.useCallback)(function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.database.upsert(R._id,(function(e){return Object(G.a)(Object(G.a)({},e),{},{extent:t})}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[a.database,R]),K=Object(s.useCallback)(function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.database.upsert(R._id,(function(e){return Object(G.a)(Object(G.a)({},e),{},{photos:t,dateUpdated:new Date})}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[a.database,R]),$=function(){var t=Object(c.a)(i.a.mark((function t(n,r){var c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setFormHasErrors&&e.setFormHasErrors(!1),c={formData:n.formData,status:ve.EDITED,dateUpdated:new Date,formStatus:be.VALID},r.setState(Object(G.a)(Object(G.a)({},r.state),{},{schemaValidationErrors:[],schemaValidationErrorSchema:{}}),(function(){L(Object(G.a)(Object(G.a)({},R),c))})),t.next=5,a.database.upsert(R._id,(function(e){return Object(G.a)(Object(G.a)({},e),c)}));case 5:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),Z=Object(s.useCallback)(Va(100,function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=nn(n=an(t.formData.activity_subtype_data)),r={formData:Object(G.a)(Object(G.a)({},t.formData),{},{activity_subtype_data:n}),status:ve.EDITED,dateUpdated:new Date,formStatus:be.VALID},L(Object(G.a)(Object(G.a)({},R),r)),e.next=6,a.database.upsert(B,(function(e){return Object(G.a)(Object(G.a)({},e),r)}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),[R]),X=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=rn(R),n={formData:t,status:ve.EDITED,dateUpdated:new Date,formStatus:be.VALID},L(Object(G.a)(Object(G.a)({},R),n)),Ae(a,"Successfully pasted form data."),e.next=6,a.database.upsert(B,(function(e){return Object(G.a)(Object(G.a)({},e),n)}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ee=function(){!function(e,t){var a=Fe(Object(G.a)({},e.activity_data),Object(G.a)({},e.activity_subtype_data)).activityData,n=Object(G.a)(Object(G.a)({},e),{},{activity_data:a});sessionStorage.setItem("copiedFormData",JSON.stringify(n)),sessionStorage.setItem("activitySubtype",t)}(R.formData,R.activitySubtype),Ae(a,"Successfully copied form data.")},te=function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.database.find({selector:{_id:ye.APPSTATE}});case 2:if((n=e.sent)&&n.docs&&n.docs.length){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,a.database.find({selector:{_id:t||n.docs[0].activeActivity}});case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.database.upsert(ye.APPSTATE,(function(e){var a=Object(G.a)(Object(G.a)({},e),{},{activeActivity:t._id});return O(!0),a}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ne=function(){var e=Object(c.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null,t.activitySubtype.includes("ChemicalPlant")?a=t.formData.activity_subtype_data.activity_id:["Treatment","Monitoring"].includes(t.activityType)&&t.activitySubtype.includes("Plant")&&(a=t.formData.activity_type_data.activity_id),!a){e.next=7;break}return e.next=5,te(a);case 5:n=e.sent,f(n.docs[0]);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(s.useEffect)((function(){(function(){var t=Object(c.a)(i.a.mark((function t(){var a,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,te(e.activityId||null);case 2:if(a=t.sent){t.next=6;break}return l(!1),t.abrupt("return");case 6:return n=V(a.docs[0]),r=Object(G.a)(Object(G.a)({},a.docs[0]),{},{formData:n}),t.next=10,ne(r);case 10:S(r.geometry),I(r.extent),Y(r.photos||[]),L(r),l(!1);case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[a,h]),Object(s.useEffect)((function(){!o&&R&&J(w)}),[w,o,J]),Object(s.useEffect)((function(){!o&&R&&Q(T)}),[T,o,Q]),Object(s.useEffect)((function(){!o&&R&&K(q)}),[q,o,K]),Object(s.useEffect)((function(){e.setObservation&&R&&e.setObservation(R)}),[R]),o?u.a.createElement(b.a,null):u.a.createElement(W.a,{className:e.classes.container},!R&&u.a.createElement(u.a.Fragment,null,u.a.createElement(v.a,{mb:3},u.a.createElement(H.a,{variant:"h4"},"Current Activity ")),u.a.createElement(H.a,null,"There is no current activity. When you start creating an activity, it will become your current activity and show up in this tab.")),R&&u.a.createElement(Ya,{customValidation:Ja([Qa(R.activitySubtype),Za(R.activitySubtype),$a(R.activitySubtype),Ka(R.activitySubtype),en(),tn(),function(e,t){if(!e||!e.activity_data||!e.activity_data.jurisdictions)return t;var a=e.activity_data.jurisdictions,n=0;return a.forEach((function(e){n+=e.percent_covered})),t.activity_data.jurisdictions.__errors=[],100!==n&&t.activity_data.jurisdictions.addError("Total percentage of area covered by jurisdictions must equal 100%"),t},Xa(p)]),customErrorTransformer:function(e){return e.filter((function(e){return"should be equal to one of the allowed values"!==e.message&&"should match exactly one schema in oneOf"!==e.message&&"should match some schema in anyOf"!==e.message}))},classes:t,activity:R,linkedActivity:p,onFormChange:Z,onFormSubmitSuccess:$,onFormSubmitError:function(){Ie(a,"There are errors in your form. Please make sure your form contains no errors and try again.")},photoState:{photos:q,setPhotos:Y},mapId:R._id,geometryState:{geometry:w,setGeometry:S},extentState:{extent:T,setExtent:I},contextMenuState:{state:P,setContextMenuState:N},pasteFormData:function(){return X()},copyFormData:function(){return ee()},cloneActivityButton:function(){return u.a.createElement(v.a,{mb:3,display:"flex",flexDirection:"row-reverse"},u.a.createElement(ce.a,{variant:"contained",color:"primary",startIcon:u.a.createElement(tt.a,null),onClick:Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Be(a,R);case 2:t=e.sent,ae(t),Ae(a,"Successfully cloned activity. You are now viewing the cloned activity.");case 5:case"end":return e.stop()}}),e)})))},"Clone Activity"))},setParentFormRef:e.setParentFormRef,showDrawControls:!0}))},un=a(1030),dn=a(1044),mn=a(1045),pn=a(1046),vn=a(1073),fn=a(1035),bn=a(1036),yn=a(1071),_n=a(1037),gn=function(){var e=Object(s.useContext)(I),t=window.cordova?"":"Online",a=Object(s.useState)(t),n=Object(_.a)(a,2),r=n[0],i=n[1],c=[{label:"Network Status: ".concat(r),url:"/"},{label:"Disclaimer",url:"https://www.gov.bc.ca/gov/content/home/disclaimer"},{label:"Privacy",url:"https://www.gov.bc.ca/gov/content/home/privacy"},{label:"Accessibility",url:"https://www.gov.bc.ca/gov/content/home/accessible-government"},{label:"Copyright",url:"https://www.gov.bc.ca/gov/content/home/copyright"}];return Object(s.useEffect)((function(){if(e){var t=e.connected?"Online":"Offline",a="".concat(t," (type: ").concat(e.connectionType,")");i(a)}}),[e]),u.a.createElement(fn.a,{position:"static"},u.a.createElement(bn.a,{style:{justifyContent:"flex-end"}},u.a.createElement(yn.a,{value:!1,variant:"scrollable",scrollButtons:"on"},c.map((function(e){return u.a.createElement(_n.a,{label:e.label,key:e.label,onClick:function(){return window.open(e.url)}})})))))},hn=a(1038),On=a(1039),En=a(1040),jn=a(1041),xn=a(1042),wn=a(1043);var Sn=function(){var e=Object(ge.b)().keycloak,t=null===e||void 0===e?void 0:e.userInfo,a=function(){var t,a;return(null===e||void 0===e||null===(t=e.resourceAccess)||void 0===t||null===(a=t["invasives-bc"])||void 0===a?void 0:a.roles)||[]};return{obj:e,username:null===t||void 0===t?void 0:t.username,preferred_username:null===t||void 0===t?void 0:t.preferred_username,displayName:function(){var e;return null!==(e=null===t||void 0===t?void 0:t.name)&&void 0!==e?e:null===t||void 0===t?void 0:t.preferred_username}(),firstName:function(){var e;return null!==(e=null===t||void 0===t?void 0:t.firstName)&&void 0!==e?e:null===t||void 0===t?void 0:t.given_name}(),lastName:function(){var e;return null!==(e=null===t||void 0===t?void 0:t.lastName)&&void 0!==e?e:null===t||void 0===t?void 0:t.family_name}(),email:null===t||void 0===t?void 0:t.email,roles:a(),sub:null===t||void 0===t?void 0:t.sub,hasRole:function(e){return!(!e||!e.length)&&(Array.isArray(e)?e.some((function(e){return a().includes(e)})):a().includes(e))}}},Cn=Object(q.a)((function(e){return{pointer:{cursor:"pointer"},alignment:{justifyContent:"inherit","@media (max-device-width: 1430px)":{justifyContent:"center"}}}})),kn=a(858),Tn=function(e){var t=Sn(),a=Cn(),n=Object(ke.f)(),r=Object(s.useState)([]),i=Object(_.a)(r,2),c=i[0],o=i[1],l=Object(s.useCallback)((function(e){for(var t=0;t<c.length;t++){if([c[t].path].concat(Object(y.a)(c[t].childPaths||[])).some((function(e){return n.location.pathname.includes(e)})))return t}return e}),[n.location.pathname]),d=u.a.useState(l(0)),m=Object(_.a)(d,2),p=m[0],v=m[1];return Object(s.useEffect)((function(){v((function(e){return l(e)}))}),[n.location.pathname,l]),Object(s.useEffect)((function(){c&&c.length||o((function(){var a=[];return(t.hasRole(B)||e.isMobileNoNetwork)&&(a.push({label:"Home",path:"/home/landing",icon:u.a.createElement(hn.a,null)}),a.push({label:"Search",path:"/home/search",icon:u.a.createElement(On.a,null)}),a.push({label:"Plan My Trip",path:"/home/plan",icon:u.a.createElement(En.a,null)}),a.push({label:"Cached Records",path:"/home/references",childPaths:["/home/references/activity"],icon:u.a.createElement(jn.a,null)}),a.push({label:"My Records",path:"/home/activities",icon:u.a.createElement(xn.a,null)}),a.push({label:"Map",path:"/home/map",icon:u.a.createElement(wn.a,null)}),a.push({label:"Current Activity",path:"/home/activity",icon:u.a.createElement(de.a,null)})),a}))}),[t]),c&&c.length?u.a.createElement(fn.a,{position:"static"},u.a.createElement(bn.a,null,u.a.createElement(Y.a,{className:a.alignment,"flex-direction":"row",container:!0},u.a.createElement(Y.a,{xs:1,item:!0},u.a.createElement("img",{className:a.pointer,src:kn,width:"50",height:"50",alt:"B.C. Government Logo",onClick:function(){return n.push("/")}})),u.a.createElement(Y.a,{xs:11,item:!0},u.a.createElement(yn.a,{value:p,onChange:function(e,t){v(t)},variant:"scrollable",scrollButtons:"on"},c.map((function(e){return u.a.createElement(_n.a,{label:e.label,key:e.label.split(" ").join("_"),icon:e.icon,onClick:function(){return n.push(e.path)}})}))))))):u.a.createElement(b.a,null)},In=function(e){var t=Object(s.useContext)(x),a=Object(s.useContext)(k),n=Object(s.useState)(!1),r=Object(_.a)(n,2),o=r[0],l=r[1],d=Object(s.useState)(null),m=Object(_.a)(d,2),p=m[0],f=m[1],b=Object(s.useState)(0),y=Object(_.a)(b,2),g=y[0],h=y[1],O=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.database.find({selector:{docType:ye.NOTIFICATION,acknowledged:!1},fields:["dateCreated","_id","notificationType","text","docType","acknowledged"],use_index:"notificationsIndex"});case 2:(a=e.sent).docs=a.docs.filter((function(e){return e._id&&e.notificationType&&e.text})),a.docs.sort((function(e,t){return e.dateCreated<t.dateCreated?1:e.dateCreated>t.dateCreated?-1:0})),h(a.docs.length),a.docs.length>0&&(f(a.docs[0]),l(!0));case 7:case"end":return e.stop()}}),e)}))),[t.database]);Object(s.useEffect)((function(){O()}),[a,O]);return u.a.createElement(v.a,{width:"inherit",height:"100%",display:"flex",flex:"1",flexDirection:"column"},u.a.createElement(Tn,{isMobileNoNetwork:e.children.props.isMobileNoNetwork}),u.a.createElement(un.a,{timeout:50,in:o},u.a.createElement(vn.a,{severity:null==p?"success":p.notificationType,action:u.a.createElement(te.a,{"aria-label":"close",color:"inherit",size:"medium",onClick:function(){var e;e=p._id,t.database.upsert(e,(function(e){return Object(G.a)(Object(G.a)({},e),{},{acknowledged:!0})})),l(!1)}},u.a.createElement(dn.a,{badgeContent:g},u.a.createElement(mn.a,null)),u.a.createElement(pn.a,{fontSize:"inherit"}))},u.a.createElement("strong",null,null==p?null:p.text))),u.a.createElement(v.a,{mb:"43px",height:"inherit",width:"inherit",overflow:"auto"},e.children),u.a.createElement(v.a,{position:"absolute",bottom:"0",left:"0",right:"0",bgcolor:"primary.main",color:"primary.contrastText"},u.a.createElement(gn,null)))},An=a(1049),Dn=a(1050),Pn=a(1051),Nn=a(1052),Fn=a(1053),Mn=a(1080),Rn=a(1054),Ln=a(1081),Bn=a(13),Wn=a(1047),zn=a(1048),Gn=a(1055),Un=a(1056),qn=a(1057),Yn=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.split("/").map((function(e){return e.split("_").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(t?" ":"")})).join("/")},Vn=Object(q.a)((function(e){return{component:{marginTop:"15px"},visuallyHidden:{border:0,clip:"rect(0 0 0 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",top:20,width:1},paper:{textAlign:"left",color:e.palette.text.primary,flexDirection:"column"},table:{minWidth:750,width:"auto",tableLayout:"auto"},tableRow:{verticalAlign:"top"},tableContainer:{display:"table-row"},cell:{whiteSpace:"nowrap",width:1,borderBottom:0},wideCell:{minWidth:500,maxWidth:500},missingValue:{fontStyle:"italic",color:"#777"},header:{backgroundColor:"rgba(0, 0, 0, 0.06)"},dropdown:{paddingBottom:0,paddingTop:0,paddingLeft:"1em"},dropdownCol:{width:1},openRow:{overflow:"inherit",whiteSpace:"inherit",maxWidth:600},closedRow:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:350},emptyTable:{paddingLeft:30},button:{marginLeft:10,marginRight:10,whiteSpace:"nowrap",minWidth:"max-content"},numberCell:{align:"right"},dateCell:{}}})),Hn=Object(q.a)((function(e){return{root:{paddingLeft:e.spacing(2),paddingRight:e.spacing(1)},highlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:Object(Bn.e)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},title:{flex:"1 1 100%",fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular},toolbar:{height:"1px"},button:{marginLeft:10,marginRight:10,whiteSpace:"nowrap",minWidth:"max-content"}}})),Jn=function(e,t){var a=e[t.id],n=t.valueMap,r="number"===t.type;switch(typeof a){case"object":return null===a?null:Array.isArray(a)?a.map((function(e){return n[e]||e})).join(" "):n[null===a||void 0===a?void 0:a.children]||(null===a||void 0===a?void 0:a.children);case"function":var i=a(e);return n[i]||i;case"string":default:return r?+n[a]||+a:n[a]||a}};function Qn(e){var t=e.classes,a=e.onSelectAllClick,n=e.order,r=e.orderBy,i=e.numSelected,c=e.rowCount,o=e.onRequestSort,l=e.headers,s=e.pageHasDropdown,d=e.enableSelection,m=e.enableTooltips;return u.a.createElement(Rn.a,{className:t.header},u.a.createElement(Nn.a,null,(d||s)&&u.a.createElement(Fn.a,{padding:"checkbox",className:t.cell},d&&u.a.createElement(J.a,{indeterminate:i>0&&i<c,checked:c>0&&i===c,onChange:a,inputProps:{"aria-label":"select all desserts"}}),s&&u.a.createElement(te.a,{"aria-label":"expand row",size:"small"})),l.map((function(e){return u.a.createElement(Fn.a,{key:e.id,padding:e.padding,sortDirection:r===e.id&&n,className:"".concat(t.cell," ").concat(e.className)},u.a.createElement(Ln.a,{active:r===e.id,direction:r===e.id?n:e.defaultOrder,onClick:(a=e.id,function(e){o(e,a)})},m&&!!e.tooltip&&u.a.createElement(Pt.a,{title:e.tooltip,arrow:!0},u.a.createElement("div",null,e.title)),!e.tooltip&&e.title,r===e.id&&u.a.createElement("span",{className:t.visuallyHidden},"desc"===n?"sorted descending":"sorted ascending")));var a}))))}var Kn,$n=function(e){var t=Hn(),a=e.selectedRows,n=e.tableName,r=e.enableFiltering,o=e.actions,l=e.databaseContext,s=(null===a||void 0===a?void 0:a.length)||0,d=o.map((function(e){var n=!e.bulkCondition||e.bulkCondition(a);if(e.displayInvalid&&"hidden"!==e.displayInvalid||n)return u.a.createElement(ce.a,{key:e.key,variant:"contained",color:"primary",size:"small",disabled:"disable"===e.displayInvalid&&!n,className:t.button,startIcon:e.icon,onClick:function(){var t=Object(c.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.stopPropagation(),"error"===e.displayInvalid&&e.bulkCondition&&!e.bulkCondition(a)&&e.invalidError?Ie(l,e.invalidError):e.action(a);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},e.label)})).filter((function(e){return e}));return u.a.createElement(nt.a,{className:t.toolbar,expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-map-content",id:"panel-map-header"},u.a.createElement(bn.a,{className:Object(ue.a)(t.root,Object(U.a)({},t.highlight,s>0))},s>0?u.a.createElement(H.a,{className:t.title,color:"inherit",variant:"subtitle1",component:"div"},s," selected"):u.a.createElement(H.a,{className:t.title,variant:"h6",id:"tableTitle",component:"div"},n),s>0&&d,r&&!s&&u.a.createElement(Pt.a,{title:"Filter list"},u.a.createElement(te.a,{"aria-label":"filter list"},u.a.createElement(Gn.a,null)))))},Zn=function(e){var t,a=e.row,n=e.header,r=e.className,i=(e.valueMap,n.id);"object"!==typeof a[i]||Array.isArray(a[i])||(t=a[i]);var c,o=Jn(a,n);return u.a.createElement(Fn.a,Object.assign({component:"th",scope:"row",align:n.align,padding:n.padding,className:r},t),(c=o)&&String(c).trim().length?c:" N/A")},Xn=function(e){var t=e.keyField,a=e.headers,n=e.row,r=e.isExpanded,o=e.toggleExpanded,l=e.enableSelection,s=e.isSelected,d=e.toggleSelected,m=e.pageHasDropdown,p=e.dropdown,f=e.hasOverflow,b=e.actions,y=e.actionStyle,_=e.databaseContext,g=Vn(),h=n[t];if(void 0===h)throw new Error("Error: table row has no matching key defined");var O=!!p&&p(n),E="record-table-checkbox-".concat(h),j=b.map((function(e){var t=!e.rowCondition||e.rowCondition(n);if(e.displayInvalid&&"hidden"!==e.displayInvalid||t)return u.a.createElement(ce.a,{key:e.key,variant:"contained",color:"primary",size:"small",disabled:"disable"===e.displayInvalid&&!t,className:g.button,startIcon:e.icon,onClick:function(){var t=Object(c.a)(i.a.mark((function t(a){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.stopPropagation(),"error"===e.displayInvalid&&e.rowCondition&&!e.rowCondition(n)&&e.invalidError?Ie(_,e.invalidError):e.action([n]);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},e.label)})).filter((function(e){return e})),x=!!O||"dropdown"===y&&(null===j||void 0===j?void 0:j.length)>0;return u.a.createElement(u.a.Fragment,{key:h},u.a.createElement(Nn.a,{hover:!0,role:"checkbox","aria-checked":s,tabIndex:-1,selected:s,onClick:o},(l||m)&&u.a.createElement(Fn.a,{padding:"checkbox",className:g.cell},l&&u.a.createElement(J.a,{checked:s,onClick:d,inputProps:{"aria-labelledby":E}}),m&&u.a.createElement(te.a,{"aria-label":"expand row",size:"small"},(x||f)&&(r?u.a.createElement(Un.a,null):u.a.createElement(qn.a,null)))),a.map((function(e){return u.a.createElement(Zn,{header:e,key:e.id,row:n,className:"\n            ".concat(g.cell,"\n            ").concat(e.className,"\n            ").concat("number"===e.type&&g.numberCell,"\n            ").concat(f&&(r?g.openRow:g.closedRow),"\n          "),valueMap:e.valueMap})}))),x&&u.a.createElement(Nn.a,{className:g.tableRow},u.a.createElement(Fn.a,{className:g.dropdown,colSpan:100},u.a.createElement(un.a,{in:r,timeout:"auto"},"dropdown"===y&&(null===j||void 0===j?void 0:j.length)>0&&j,u.a.createElement(v.a,{margin:2},O)))))},er=function(e){var t,a,n,r,o,l=Vn(),d=Object(ke.f)(),m=Object(s.useContext)(x),p=Ce(),v=e.tableName,f=void 0===v?"":v,b=e.keyField,g=void 0===b?"_id":b,h=e.startingOrder,O=void 0===h?"asc":h,E=e.dropdownLimit,j=void 0===E||E,w=e.onToggleExpandRow,S=e.overflowDropdown,C=void 0===S||S,k=e.overflowLimit,T=void 0===k?50:k,I=(e.expandable,e.startExpanded),A=void 0===I||I,D=e.startingRowsPerPage,P=void 0===D?10:D,N=e.rowsPerPageOptions,F=void 0!==N&&N,M=e.enableSelection,R=void 0!==M&&M,L=e.enableFiltering,B=void 0!==L&&L,W=e.enableTooltips,z=void 0===W||W,U=e.pagination,q=void 0===U?"overflow":U,Y=e.densePadding,V=void 0!==Y&&Y,H=e.padEmptyRows,J=void 0!==H&&H,Q=e.rowActionStyle,K=void 0===Q?"dropdown":Q,$=Object(s.useMemo)((function(){return e.rows}),[null===(t=e.rows)||void 0===t?void 0:t.length]),Z=Object(s.useCallback)((function(t){return!!e.dropdown&&e.dropdown(t)}),[!!e.dropdown]),X=Object(s.useMemo)((function(){return e.tableSchemaType}),[null===(a=e.tableSchemaType)||void 0===a?void 0:a.length]),ee=Object(s.useState)({schema:null,uiSchema:null}),te=Object(_.a)(ee,2),ae=te[0],ne=te[1],re=Object(s.useState)(!1),ie=Object(_.a)(re,2),ce=ie[0],oe=ie[1],le=Object(s.useMemo)((function(){return(e.headers?e.headers:$.length?Object.keys($[0]):[]).map((function(e,t){var a,n,r,i,c,o,l,s;if("string"!==typeof e&&"number"!==typeof e||(l={id:s=e||t}),"object"===typeof e&&(s=e.id||t,l=Object(G.a)({id:s,align:"number"===e.type?"right":"left",padding:"default",defaultOrder:"asc"},e)),!l)throw new Error("Table header not defined correctly - must be a string, number or object");var u=null===ae||void 0===ae||null===(a=ae.schema)||void 0===a||null===(n=a.properties)||void 0===n?void 0:n[s],d={};return null===ae||void 0===ae||null===(r=ae.schema)||void 0===r||null===(i=r.properties)||void 0===i||null===(c=i[s])||void 0===c||null===(o=c.anyOf)||void 0===o||o.forEach((function(e){e.enum[0]&&e.title&&(d[e.enum[0]]=e.title)})),Object(G.a)(Object(G.a)({title:Yn(s,!0)},u),{},{valueMap:Object(G.a)(Object(G.a)({},d),l.valueMap),tooltip:null===u||void 0===u?void 0:u["x-tooltip-text"]},l)}))}),[$,null===(n=e.headers)||void 0===n?void 0:n.length,ce]),se=!1===e.actions?{}:Object(G.a)(Object(G.a)({},e.actions),{},{edit:Object(G.a)({key:"edit",enabled:R,action:function(){var e=Object(c.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==(a=t.map((function(e){return e[g]}))).length){e.next=7;break}return e.next=4,m.database.upsert(ye.APPSTATE,(function(e){return Object(G.a)(Object(G.a)({},e),{},{activeActivity:a[0]})}));case 4:d.push({pathname:"/home/activity"}),e.next=8;break;case 7:d.push({pathname:"/home/search/bulkedit",search:"?activities="+a.join(","),state:{activityIdsToEdit:a}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),label:"Edit",icon:u.a.createElement(Wn.a,null),bulkAction:!0,rowAction:!0,bulkCondition:function(e){return e.every((function(e,t,a){var n=Object(_.a)(a,1)[0];return e.subtype===n.subtype}))},rowCondition:void 0,displayInvalid:"error",invalidError:"All selected rows must be of the same SubType to Bulk Edit"},null===(r=e.actions)||void 0===r?void 0:r.edit),delete:Object(G.a)({key:"delete",enabled:R,action:function(e){},label:"Delete",icon:u.a.createElement(zn.a,null),bulkAction:!0,rowAction:!0,bulkCondition:void 0,rowCondition:void 0,displayInvalid:"disable"},null===(o=e.actions)||void 0===o?void 0:o.delete)}),ue=e.startingOrderBy,de=void 0===ue?le.length?le[0].id:"id":ue,me=Object.values(se).filter((function(e){return e.enabled&&e.bulkAction})),pe=Object.values(se).filter((function(e){return e.enabled&&e.rowAction})),ve=Object(s.useState)(O),fe=Object(_.a)(ve,2),be=fe[0],_e=fe[1],ge=Object(s.useState)(de),he=Object(_.a)(ge,2),Oe=he[0],Ee=he[1],je=Object(s.useState)(0),xe=Object(_.a)(je,2),we=xe[0],Se=xe[1],Te=Object(s.useState)(P),Ie=Object(_.a)(Te,2),Ae=Ie[0],De=Ie[1],Pe=Object(s.useState)([]),Ne=Object(_.a)(Pe,2),Fe=Ne[0],Me=Ne[1],Re=Object(s.useState)(e.selected||[]),Le=Object(_.a)(Re,2),Be=Le[0],We=Le[1],ze=Object(s.useCallback)(function(){var e=Object(c.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getCachedApiSpec();case 2:return a=e.sent,n="string"===typeof t?[t]:t||[],e.next=6,ne({schema:n.reduce((function(e,t){return Object(G.a)(Object(G.a)({},e),{},{properties:Object(G.a)(Object(G.a)({},e.properties),a.components.schemas[t].properties)})}),{}),uiSchema:n.reduce((function(e,t){return Object(G.a)(Object(G.a)({},e),ba[t])}),{})});case 6:oe(!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[X]);Object(s.useEffect)((function(){ze(X)}),[X]),Object(s.useEffect)((function(){We(e.selected||[])}),[JSON.stringify(e.selected)]),Object(s.useEffect)((function(){e.setSelected&&e.setSelected(Be)}),[JSON.stringify(Be)]);var Ge=Object(s.useMemo)((function(){return Be.map((function(e){var t=$.find((function(t){return t[g]===e}));return t||void 0})).filter((function(e){return e}))}),[JSON.stringify(Be),$]),Ue=Object(s.useMemo)((function(){return le.find((function(e){return e.id===Oe}))}),[le,Oe]),qe=Object(s.useMemo)((function(){return function(e,t,a){if(!t)return e;var n=e.map((function(e,a){return[Jn(e,t),a,e]}));return n.sort((function(e,t){return e[0]>t[0]?a?1:-1:t[0]>e[0]?a?-1:1:e[1]-t[1]})),n.map((function(e){return e[2]}))}($,Ue,"asc"===be).slice(we*Ae,we*Ae+Ae)}),[$,Ue,be,we,Ae]),Ye=Object(s.useMemo)((function(){return qe.map((function(e){return Z?Z(e):void 0}))}),[qe,Z]),Ve=Object(s.useMemo)((function(){return qe.map((function(e){return le.filter((function(t){var a=t.id;return String(e[a]).length>T})).length>0}))}),[qe,le,T]),He=Object(s.useMemo)((function(){return!!Z&&Ye.filter((function(e){return e})).length>0||C&&Ve.filter((function(e){return e})).length>0||(null===pe||void 0===pe?void 0:pe.length)>0&&"dropdown"===K}),[Z,Ye,C,Ve,null===pe||void 0===pe?void 0:pe.length,K]),Je="overflow"===q?$.length>Ae:!!q,Qe=Object(s.useCallback)((function(e,t){_e(Oe===t&&"asc"===be?"desc":"asc"),Ee(t),Se(0)}),[Oe,be]),Ke=Object(s.useCallback)((function(e){if(e.target.checked){var t=$.map((function(e){return e[g]}));We(t)}else We([])}),[$]),$e=Object(s.useCallback)((function(e,t){var a=e.indexOf(t),n=[];-1===a?n=n.concat(e,t):0===a?n=n.concat(e.slice(1)):a===e.length-1?n=n.concat(e.slice(0,-1)):a>0&&(n=n.concat(e.slice(0,a),e.slice(a+1))),We(n)}),[]),Ze=function(e,t){Se(t)},Xe=function(e){De(parseInt(e.target.value,10)),Se(0)},et=Ae-Math.min(Ae,$.length-we*Ae),tt=Object(s.useCallback)((function(e){var t;t=-1!==Fe.indexOf(e)?Fe.filter((function(t){return t!==e})):j?[e]:[].concat(Object(y.a)(Fe),[e]),Me(t),w&&w($.find((function(t){return t[g]===e})),t,Ge)}),[null===Fe||void 0===Fe?void 0:Fe.length,JSON.stringify(Fe),j,Ge,$]),nt=Object(s.useMemo)((function(){return u.a.createElement(Qn,{classes:l,numSelected:Be.length,order:be,orderBy:Oe,onSelectAllClick:Ke,onRequestSort:Qe,rowCount:$.length,headers:le,enableSelection:R,enableTooltips:z,pageHasDropdown:He})}),[null===Be||void 0===Be?void 0:Be.length,be,Oe,Ke,Qe,$.length,le,R,z,He]),it=!ce&&(null===X||void 0===X?void 0:X.length)>0;return Object(s.useMemo)((function(){return u.a.createElement("div",{className:l.component},u.a.createElement(at.a,{defaultExpanded:A||!$.length},(R||B||f.length>0)&&u.a.createElement($n,{selectedRows:R?Ge:[],tableName:f,enableFiltering:B,actions:me,databaseContext:m}),u.a.createElement(rt.a,{className:l.paper},it&&u.a.createElement("div",{className:l.emptyTable},"Loading"),!it&&!$.length&&u.a.createElement("div",{className:l.emptyTable},"No data to display"),!it&&!!$.length&&u.a.createElement(An.a,null,u.a.createElement(Dn.a,{className:l.table,"aria-labelledby":"tableTitle",size:V?"small":"medium","aria-label":"enhanced table"},nt,u.a.createElement(Pn.a,null,qe.map((function(e,t){return u.a.createElement(Xn,{key:e[g],keyField:g,headers:le,row:e,dropdown:Z,pageHasDropdown:He,hasOverflow:Ve[t],isExpanded:-1!==Fe.indexOf(e[g]),isSelected:-1!==Be.indexOf(e[g]),enableSelection:R,toggleExpanded:function(t){t.stopPropagation(),tt(e[g])},toggleSelected:function(t){t.stopPropagation(),$e(Be,e[g])},actions:pe,actionStyle:K,databaseContext:m})})),J&&et>0&&u.a.createElement(Nn.a,{style:{height:(V?33:53)*et}},u.a.createElement(Fn.a,{colSpan:le.length}))))),!it&&!!$.length&&Je&&u.a.createElement(Mn.a,{rowsPerPageOptions:!1===F?void 0:F,component:"div",count:$.length,rowsPerPage:Ae,page:we,onChangePage:Ze,onChangeRowsPerPage:Xe}))))}),[$,ce,we,Ae,JSON.stringify(Be),JSON.stringify(Fe),be,Oe])},tr=Object(q.a)((function(e){return{heading:{fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular,align:"center"},wideCell:{minWidth:500,maxWidth:500},missingValue:{fontStyle:"italic",color:"#777"}}})),ar=function(e){var t,a,n,r,i,c,o,l,s,d,m,p,v=tr(),f=null===e||void 0===e||null===(t=e.record)||void 0===t||null===(a=t.point_of_interest_payload)||void 0===a?void 0:a.form_data,b=Object(G.a)(Object(G.a)({},null===f||void 0===f?void 0:f.point_of_interest_data),null===f||void 0===f?void 0:f.point_of_interest_type_data),y=f.surveys,_=f.mechanical_treatments,g=f.chemical_treatments,h=f.biological_treatments,O=f.biological_dispersals,E=null===e||void 0===e||null===(n=e.record)||void 0===n||null===(r=n.point_of_interest_payload)||void 0===r||null===(i=r.geometry[0])||void 0===i||null===(c=i.geometry)||void 0===c?void 0:c.coordinates,j=parseFloat(E[0]).toFixed(6),x=parseFloat(E[1]).toFixed(6),w=function(e){return e&&String(e).trim()?e:u.a.createElement("div",{className:v.missingValue},"N/A")};return u.a.createElement(W.a,null,u.a.createElement(at.a,{defaultExpanded:!0},u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-map-content",id:"panel-map-header"},u.a.createElement(H.a,{className:v.heading},"Legacy IAPP Site: ",b.site_id)),u.a.createElement(rt.a,null,u.a.createElement(Y.a,{container:!0,spacing:1},u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Created"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(b.created_date_on_device)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Slope"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(b.slope_code)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"PaperFile"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(b.project_code[0].description)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Aspect"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(b.aspect_code)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Longitude"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(j)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Latitude"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(x)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Elevation"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(b.elevation)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Specific Use"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(b.specific_use_code)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Mapsheet"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(b.map_sheet)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Soil Texture"),u.a.createElement(Y.a,{item:!0,xs:9,sm:4},w(b.soil_texture_code)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Jurisdiction"),u.a.createElement(Y.a,{item:!0,xs:3},(null===y||void 0===y||null===(o=y[0])||void 0===o||null===(l=o.jurisdictions)||void 0===l?void 0:l.length)>0&&w(y[0].jurisdictions[0].jurisdiction_code)+" ("+y[0].jurisdictions[0].percent_covered+"%)"||"Not Provided"),u.a.createElement(Y.a,{item:!0,xs:3},(null===y||void 0===y||null===(s=y[0])||void 0===s||null===(d=s.jurisdictions)||void 0===d?void 0:d.length)>1&&w(y[0].jurisdictions[1].jurisdiction_code)+" ("+y[0].jurisdictions[1].percent_covered+"%)"),u.a.createElement(Y.a,{item:!0,xs:3},(null===y||void 0===y||null===(m=y[0])||void 0===m||null===(p=m.jurisdictions)||void 0===p?void 0:p.length)>2&&w(y[0].jurisdictions[2].jurisdiction_code)+" ("+y[0].jurisdictions[2].percent_covered+"%)"),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Access Description"),u.a.createElement(Y.a,{item:!0,xs:9,sm:10},w(b.access_description)),u.a.createElement(Y.a,{item:!0,xs:3,sm:2},"Comments"),u.a.createElement(Y.a,{item:!0,xs:9,sm:10},w(b.general_comment))))),u.a.createElement(er,{tableName:"Survey Details on Site "+b.site_id,keyField:"survey_id",startingOrderBy:"survey_id",startingOrder:"desc",actions:!1,headers:[{id:"survey_id",title:"Survey ID",type:"number"},{id:"common_name",title:"Common Name"},{id:"species",title:"Species"},{id:"genus",title:"Genus"},{id:"survey_date",title:"Survey Date"},{id:"invasive_species_agency_code",title:"Agency"},{id:"reported_area",title:"Area (m\xb2)",type:"number"},{id:"density",align:"center",title:"Density"},{id:"distribution",align:"center",title:"Distribution"},{id:"general_comment",title:"Comments"}],rows:(null===y||void 0===y?void 0:y.length)?y.map((function(e){return Object(G.a)(Object(G.a)({},e),{},{density:e.density+(e.density?" ("+e.invasive_plant_density_code+")":""),distribution:e.distribution+(e.distribution?" ("+e.invasive_plant_distribution_code+")":"")})})):[]}),u.a.createElement(er,{tableName:"Mechanical Treatments and Efficacy Monitoring",startExpanded:!1,keyField:"treatment_id",startingOrderBy:"treatment_id",startingOrder:"desc",actions:!1,headers:[{id:"treatment_id",title:"Treatment ID",type:"number"},{id:"common_name",title:"Species (Common)"},{id:"treatment_date",title:"Treatment Date"},{id:"invasive_species_agency_code",title:"Agency"},{id:"reported_area",title:"Reported Area (m\xb2)",type:"number"},{id:"mechanical_method_code_label",title:"Mech Method"},{id:"project_code_label",title:"Project Code"},{id:"general_comment",title:"Comments"}],rows:_.length?_.map((function(e){return Object(G.a)(Object(G.a)({},e),{},{mechanical_method_code_title:"("+e.mechanical_method_code+") "+e.mechanical_method,project_code_title:e.project_code[0].description})})):[],dropdown:function(e){var t;return(null===(t=e.monitoring)||void 0===t?void 0:t.length)?u.a.createElement(er,{tableName:"Monitoring",startExpanded:!0,startingOrderBy:"monitoring_id",startingOrder:"desc",keyField:"monitoring_id",actions:!1,headers:[{id:"monitoring_id",title:"Monitoring ID",type:"number"},{id:"monitoring_date",title:"Monitoring Date"},{id:"invasive_species_agency_code",title:"Agency"},{id:"efficacy_percent",title:"Efficacy",type:"number"},{id:"project_code_label",title:"Project Code"},{id:"general_comment",title:"Comments"}],rows:e.monitoring.length?e.monitoring.map((function(e,t){return Object(G.a)(Object(G.a)({},e),{},{project_code_title:e.project_code[0].description})})):[]}):void 0}}),u.a.createElement(er,{tableName:"Chemical Treatments and Efficacy Monitoring",startExpanded:!1,keyField:"treatment_id",startingOrderBy:"treatment_id",startingOrder:"desc",actions:!1,headers:[{id:"treatment_id",title:"Treatment ID",type:"number"},{id:"common_name",title:"Species (Common)"},{id:"treatment_date",title:"Treatment Date"},{id:"invasive_species_agency_code",title:"Agency"},{id:"reported_area",title:"Reported Area (m\xb2)",type:"number"},{id:"chemical_method",title:"Method"},{id:"project_code_label",title:"Project Code"},{id:"general_comment",title:"Comments"}],rows:g.length?g.map((function(e){return Object(G.a)(Object(G.a)({},e),{},{project_code_title:e.project_code[0].description})})):[],dropdown:function(e){return u.a.createElement(u.a.Fragment,{key:e.treatment_id+"_expanded"},u.a.createElement(er,{startExpanded:!0,keyField:"treatment_id",actions:!1,headers:[{id:"pmp_confirmation_number",title:"PMP Confirmation #"},{id:"herbicide_description",title:"Herbicide"},{id:"pmra_reg_number",title:"PMRA Reg #"},{id:"temperature",title:"Temperature",type:"number"},{id:"humidity",title:"Humidity"},{id:"wind_speed",title:"Wind Velocity",type:"number"},{id:"wind_direction",title:"Wind Direction"},{id:"application_rate",title:"Application Rate"},{id:"herbicide_amount",title:"Amount Used",type:"number"},{id:"dilution",title:"Dilution Rate"},{id:"mix_delivery_rate",title:"Mix Delivery Rate"}],rows:[e],enableFiltering:!1}),u.a.createElement(er,{tableName:"Monitoring",startExpanded:!0,startingOrderBy:"monitoring_date",keyField:"monitoring_id",actions:!1,headers:[{id:"monitoring_id",title:"Monitoring ID",type:"number"},{id:"monitoring_date",title:"Monitoring Date"},{id:"invasive_species_agency_code",title:"Agency"},{id:"efficacy_percent",title:"Efficacy",type:"number"},{id:"project_code_label",title:"Project Code"},{id:"general_comment",title:"Comments"}],rows:e.monitoring.length?e.monitoring.map((function(e,t){return Object(G.a)(Object(G.a)({},e),{},{project_code_title:e.project_code[0].description})})):[]}))}}),u.a.createElement(er,{tableName:"Biological Treatments and Efficacy Monitoring",startExpanded:!1,keyField:"treatment_id",startingOrderBy:"treatment_id",startingOrder:"desc",actions:!1,headers:[{id:"treatment_id",title:"Treatment ID",type:"number"},{id:"common_name",title:"Species (Common)"},{id:"treatment_date",title:"Treatment Date"},{id:"collection_date",title:"Collection Date"},{id:"bioagent_source",title:"Bioagent Source"},{id:"invasive_species_agency_code",title:"Agency"},{id:"stage_larva_ind",title:"Larvae?"},{id:"stage_egg_ind",title:"Eggs?"},{id:"stage_pupa_ind",title:"Pupae?"},{id:"stage_other_ind",title:"Other?"},{id:"release_quantity",title:"Release Quantity"},{id:"area_classification_code",title:"Area Classification Code"},{id:"biological_agent_code",title:"Biological Agent Code"},{id:"project_code_label",title:"Project Code"},{id:"general_comment",title:"Comments"}],rows:h.length?h.map((function(e){return Object(G.a)(Object(G.a)({},e),{},{project_code_title:e.project_code[0].description})})):[],dropdown:function(e){var t;return(null===(t=e.monitoring)||void 0===t?void 0:t.length)?u.a.createElement(er,{tableName:"Monitoring",startExpanded:!0,startingOrderBy:"monitoring_id",startingOrder:"desc",keyField:"monitoring_id",actions:!1,headers:[{id:"monitoring_id",title:"Monitoring ID",type:"number"},{id:"monitoring_date",title:"Monitoring Date"},{id:"plant_count",title:"Plant Count",type:"number"},{id:"agent_count",title:"Agent Count",type:"number"},{id:"count_duration",title:"Count Duration"},{id:"agent_destroyed_ind",title:"Agent Destroyed?"},{id:"legacy_presence_ind",title:"Legacy Presence?"},{id:"foliar_feeding_damage_ind",title:"Foliar Feeding Damage?"},{id:"root_feeding_damage_ind",title:"Root Feeding Damage?"},{id:"seed_feeding_damage_ind",title:"Seed Feeding Damage?"},{id:"oviposition_marks_ind",title:"Oviposition Marks?"},{id:"eggs_present_ind",title:"Eggs Present?"},{id:"larvae_present_ind",title:"Larvae Present?"},{id:"pupae_present_ind",title:"Pupae Present?"},{id:"adults_present_ind",title:"Adults Present?"},{id:"tunnels_present_ind",title:"Tunnels Present?"},{id:"project_code_label",title:"Project Code"},{id:"general_comment",title:"Comments"}],rows:e.monitoring.length?e.monitoring.map((function(e,t){return Object(G.a)(Object(G.a)({},e),{},{project_code_title:e.project_code[0].description})})):[]}):void 0}}),u.a.createElement(er,{tableName:"Biological Dispersals",startExpanded:!1,keyField:"biological_id",startingOrderBy:"biological_id",startingOrder:"desc",actions:!1,headers:[{id:"treatment_id",title:"Treatment ID",type:"number"},{id:"common_name",title:"Species (Common)"},{id:"monitoring_date",title:"Inspection Date"},{id:"project_code_label",title:"Project Code"},{id:"plant_count",title:"Plant Count",type:"number"},{id:"agent_count",title:"Agent Count",type:"number"},{id:"count_duration",title:"Count Duration"},{id:"biological_agent_code",title:"Agent Code"},{id:"foliar_feeding_damage_ind",title:"Foliar Feeding Damage?"},{id:"root_feeding_damage_ind",title:"Root Feeding Damage?"},{id:"seed_feeding_damage_ind",title:"Seed Feeding Damage?"},{id:"oviposition_marks_ind",title:"Oviposition Marks?"},{id:"eggs_present_ind",title:"Eggs?"},{id:"pupae_present_ind",title:"Pupae?"},{id:"adults_present_ind",title:"Adults?"},{id:"tunnels_present_ind",title:"Tunnels?"},{id:"general_comment",title:"Comments"}],rows:O.length?O.map((function(e){return Object(G.a)(Object(G.a)({},e),{},{project_code_title:e.project_code[0].description})})):[]}),u.a.createElement("br",null),u.a.createElement("br",null),u.a.createElement("br",null),u.a.createElement("br",null))},nr=Object(q.a)((function(e){return{heading:{fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular}}})),rr=function(e){var t=nr(),a=e.containerProps;return u.a.createElement(u.a.Fragment,null,u.a.createElement(H.a,{align:"center",className:t.heading},a.activity.activityType,": ",a.activity.activityId),u.a.createElement("br",null),u.a.createElement(at.a,null,u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-form-content",id:"panel-form-header"},u.a.createElement(H.a,{className:t.heading},"Form")),u.a.createElement(rt.a,null,u.a.createElement(Ia,a))),u.a.createElement(at.a,null,u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"panel-photo-content",id:"panel-photo-header"},u.a.createElement(H.a,{className:t.heading},"Photos")),u.a.createElement(rt.a,null,u.a.createElement(Ua,a))))},ir=a(1058),cr=a(1018),or=a(490),lr=a.n(or),sr=a(491),ur=a.n(sr),dr=a(255),mr=a.n(dr),pr=u.a.forwardRef((function(e,t){return u.a.createElement(ir.a,Object.assign({direction:"up",ref:t},e))}));!function(e){e.default="default",e.passThrough="passThrough"}(Kn||(Kn={}));var vr,fr=Object(q.a)((function(e){return{appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1},contextMenuItem:{textAlign:"center",height:300},contextMenuIcon:{fontSize:"large",height:100}}})),br=function(e){var t=fr();return u.a.createElement($.a,{className:t.contextMenuItem,onClick:function(t){e.onSelectFunction()},button:!0},u.a.createElement(cr.a,{primary:e.heading,secondary:e.description}))},yr=function(e){var t=fr(),a=Object(s.useContext)(x),n=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.database.upsert("sasquatch",(function(){return{docType:ye.POINT_OF_INTEREST,geometry:t,dateUpdated:new Date}}));case 2:Ae(a,"Saved New Point of Interest");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return u.a.createElement(u.a.Fragment,null,u.a.createElement(qe.a,{fullScreen:!0,open:e.contextMenuState.state.isOpen,onClose:function(t){e.handleClose()},TransitionComponent:pr},u.a.createElement(fn.a,{className:t.appBar},u.a.createElement(bn.a,null,u.a.createElement(te.a,{edge:"start",color:"inherit",onClick:function(t){e.handleClose()},"aria-label":"close"},u.a.createElement(mr.a,null)),u.a.createElement(H.a,{variant:"h5",className:t.title},"Choose something to do here: (",e.contextMenuState.state.lat,", ",e.contextMenuState.state.lng,")"),u.a.createElement(ce.a,{autoFocus:!0,color:"inherit",onClick:function(t){e.handleClose()}},"select"))),u.a.createElement(Q.a,null,u.a.createElement(br,{heading:"Mark a new point of interest here",description:"Points of interest can be used to capture something that isn't already in a layer and isn't representative of a field activity",onSelectFunction:function(){e.contextMenuState.setContextMenuState(Object(G.a)(Object(G.a)({},e.contextMenuState.state),{},{isOpen:!1}));var t,a,r=(t=e.contextMenuState.state.lng,a=e.contextMenuState.state.lat,[{type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(t.toFixed(6)),parseFloat(a.toFixed(6))]},properties:{name:"Sasquatch Siting"}}]);n(r)}}),u.a.createElement(V.a,null),u.a.createElement($.a,{className:t.contextMenuItem,button:!0},u.a.createElement(Z.a,{className:t.contextMenuIcon},u.a.createElement(lr.a,null)),u.a.createElement(cr.a,{primary:"Find things near here.",secondary:"Use this location as a starting point for a search.  You can look for planned or past activities, or points of interest."})),u.a.createElement(V.a,null),u.a.createElement($.a,{className:t.contextMenuItem,button:!0},u.a.createElement(Z.a,{className:t.contextMenuIcon},u.a.createElement(ur.a,null)),u.a.createElement(cr.a,{primary:"Start doing something here.",secondary:"Use this location as a starting point for an activity.  It can be a planned activity, a plan for multiple activities, or it can just be one field activity."})))))},_r=Object(q.a)((function(e){return{mapContainer:{height:"100%"},map:{height:"100%",width:"100%",zIndex:0},mainGrid:{height:"100%",width:"100%"},mapGridItemExpanded:{height:"100%",width:"100%"},mapGridItemShrunk:{height:"60%",width:"100%"},popOutGridItemExpanded:{height:"40%",display:"inherit",width:"100%"},popOutGridItemShrunk:{height:"0%",display:"none",width:"100%"},popOutComponent:{width:"100%",backgroundColor:e.palette.background.paper}}})),gr=function(e){return"<div>"+e+"</div>"},hr=function(e){var t=_r();return u.a.createElement("div",{className:t.popOutComponent},u.a.createElement("br",null),u.a.createElement("blockquote",null,u.a.createElement(Y.a,{container:!0,spacing:3},["Close","Edit","Photos","Show related activities"].map((function(t){return u.a.createElement(Y.a,{item:!0,key:t},u.a.createElement(ce.a,{disabled:"Close"!==t,color:"primary",variant:"contained",onClick:function(){e.buttonCloseCallback()}},t))})))),u.a.createElement("br",null),e.children)},Or=function(e){var t,a=_r(),n=Object(s.useContext)(x),r=Object(s.useContext)(k),o=Object(s.useState)([]),l=Object(_.a)(o,2),d=l[0],m=l[1],p=Object(s.useState)(null),f=Object(_.a)(p,2),y=f[0],g=f[1],h=Object(s.useState)(null),O=Object(_.a)(h,2),E=O[0],j=O[1],w=Object(s.useState)(!1),S=Object(_.a)(w,2),T=S[0],I=S[1],A=Object(s.useState)(!1),D=Object(_.a)(A,2),P=D[0],N=D[1],F=Object(s.useState)(null),M=Object(_.a)(F,2),R=M[0],L=M[1],B=Object(s.useState)(null),z=Object(_.a)(B,2),U=z[0],q=z[1],V=Object(s.useState)([]),H=Object(_.a)(V,2),J=H[0],Q=H[1],K=Object(s.useState)(null),$=Object(_.a)(K,2),Z=$[0],X=$[1],ee=Object(s.useState)({isOpen:!1,lat:0,lng:0}),te=Object(_.a)(ee,2),ae=te[0],ne=te[1];Object(s.useEffect)((function(){I(!!y)}),[r,y]);var re=function(){var e=Object(c.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(!0),e.next=3,n.database.find({selector:{_id:t._id}});case 3:a=e.sent,j(a.docs[0]);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.database.find({selector:{_id:ye.APPSTATE}});case 2:if((t=e.sent)&&t.docs&&t.docs.length){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,n.database.find({selector:{_id:t.docs[0].activeActivity}});case 7:(a=e.sent)&&a.docs[0]&&(q(a.docs[0]),Q(a.docs[0].photos||[]));case 9:case"end":return e.stop()}}),e)}))),[n.database]),ce=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var t,a,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=C()().valueOf(),!(null!==Z&&t<Z+6e4)){e.next=3;break}return e.abrupt("return");case 3:return X(t),e.next=6,n.database.find({selector:{docType:{$in:[ye.REFERENCE_ACTIVITY,ye.ACTIVITY,ye.REFERENCE_POINT_OF_INTEREST,ye.POINT_OF_INTEREST,ye.SPATIAL_UPLOADS,ye.OFFLINE_EXTENT,ye.OFFLINE_DATA]}},use_index:"docTypeIndex",fields:["_id","docType","geometry","lat","lon"]});case 6:if((a=e.sent)&&a.docs&&a.docs.length){e.next=9;break}return e.abrupt("return");case 9:r=[],c=[],a.docs.forEach((function(e){var t;if(e.geometry&&e.geometry.length){var a="Polygon",n=null===(t=e.geometry[0])||void 0===t?void 0:t.geometry.coordinates,r=Fa(e);switch("Polygon"!==e.geometry[0].geometry.type&&(a="(".concat(Number(n[1]).toFixed(2),", ").concat(Number(n[0]).toFixed(2),")")),e.docType){case ye.OFFLINE_DATA:c.push({recordDocID:e._id,recordDocType:e.docType,description:"Offline Data",geometry:e.geometry,color:"blue",popUpComponent:gr});break;case ye.OFFLINE_EXTENT:break;case ye.SPATIAL_UPLOADS:c.push({recordDocID:e._id,recordDocType:e.docType,description:"Uploaded spatial content:\n "+e._id+"\n"+a,geometry:e.geometry,color:"orange",onClickCallback:function(){console.log("uploaded content clicked")},popUpComponent:gr});break;case ye.POINT_OF_INTEREST:c.push({recordDocID:e._id,recordDocType:e.docType,description:"New Point of Interest:\n "+e._id+"\n"+a,geometry:e.geometry,color:"#99E472",zIndex:r,onClickCallback:function(){console.log("clicked geo"),re(e)},popUpComponent:gr});break;case ye.REFERENCE_ACTIVITY:c.push({recordDocID:e._id,recordDocType:e.docType,description:"Past Activity:\n "+e._id+"\n"+a,geometry:e.geometry[0],color:"#F3C911",zIndex:r,onClickCallback:function(){console.log("before handle geo"),re(e)},popUpComponent:gr});break;case ye.ACTIVITY:c.push({recordDocID:e._id,recordDocType:e.docType,description:"Activity:\n "+e._id+"\n"+a,geometry:e.geometry[0],color:"#E044A7",zIndex:r,onClickCallback:function(){console.log("before handle geo"),re(e)},popUpComponent:gr});break;case ye.REFERENCE_POINT_OF_INTEREST:c.push({recordDocID:e._id,recordDocType:e.docType,description:"Point of Interest:\n "+e._id+"\n"+a,geometry:e.geometry[0],color:"#FF5733",zIndex:r,onClickCallback:function(){console.log("before handle geo"),re(e)},popUpComponent:gr})}}})),m(r),g(c);case 14:case"end":return e.stop()}}),e)}))),[R]);Object(s.useEffect)((function(){ce()}),[r,P,ce]),Object(s.useEffect)((function(){console.log("chosen geo"),console.dir(E)}),[E]),Object(s.useEffect)((function(){ie()}),[ie]);var oe={activity:U,photoState:{photos:J,setPhotos:Q}};return u.a.createElement(v.a,{height:"inherit",width:"inherit"},u.a.createElement(Y.a,{className:a.mainGrid,container:!0},u.a.createElement(Y.a,{className:P?a.mapGridItemShrunk:a.mapGridItemExpanded,item:!0},u.a.createElement(W.a,{className:Object(ue.a)(a.mapContainer),maxWidth:!1,disableGutters:!0},T?u.a.createElement(Ra,{classes:a,showDrawControls:!1,mapId:"mainMap",geometryState:{geometry:d,setGeometry:m},interactiveGeometryState:{interactiveGeometry:y,setInteractiveGeometry:g},extentState:{extent:R,setExtent:L},contextMenuState:{state:ae,setContextMenuState:ne}}):u.a.createElement(b.a,null))),u.a.createElement(Y.a,{className:P?a.popOutGridItemExpanded:a.popOutGridItemShrunk,item:!0},u.a.createElement(hr,{buttonCloseCallback:function(){N(!1)},selectedGeo:E},(null===(t=E)||void 0===t?void 0:t.docType)===ye.REFERENCE_POINT_OF_INTEREST?u.a.createElement(ar,{record:E}):u.a.createElement(u.a.Fragment,null,U&&u.a.createElement(rr,{containerProps:oe}))))),u.a.createElement(yr,{contextMenuState:{state:ae,setContextMenuState:ne},handleClose:function(){ne(Object(G.a)(Object(G.a)({},ae),{},{isOpen:!1}))}}))},Er=a(160),jr=a(1059),xr=a(68),wr=a(1068),Sr=Object(q.a)((function(e){return{paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary},activityRecordsChoice:{padding:e.spacing(2)}}})),Cr=function(e){var t=Object(s.useContext)(x),a=Object(s.useState)([]),n=Object(_.a)(a,2),r=n[0],o=n[1],l=Object(s.useCallback)(Object(c.a)(i.a.mark((function a(){var n,r;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.database.find({selector:{_id:e.trip_ID}});case 2:(n=a.sent).docs.length>0&&(r=n.docs[0]).activityChoices&&o(Object(y.a)(r.activityChoices));case 4:case"end":return a.stop()}}),a)}))),[]);Object(s.useEffect)((function(){l()}),[l]);var d=function(){var a=Object(c.a)(i.a.mark((function a(n){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("updating trip "+e.trip_ID+" activity filters"),a.next=3,t.database.upsert(e.trip_ID,(function(e){return Object(G.a)(Object(G.a)({},e),{},{activityChoices:n})}));case 3:o(Object(y.a)(n));case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),m=function(e,t){var a=Object(y.a)(r);a[t]=e,d(Object(y.a)(a))},p=Sr(),f=Object(s.useState)(),b=Object(_.a)(f,2);b[0],b[1];return u.a.createElement(u.a.Fragment,null,u.a.createElement(xr.a,{utils:Er.a},u.a.createElement(Q.a,null,r.map((function(e,t){return u.a.createElement($.a,{key:t},u.a.createElement(K.a,{className:p.activityRecordsChoice},u.a.createElement(Y.a,{xs:8,container:!0,spacing:3},u.a.createElement(Y.a,{item:!0,xs:4},u.a.createElement("div",null,u.a.createElement(ne.a,{id:"demo-simple-select-label"},"Activity Type"),u.a.createElement(re.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:e.activityType,onChange:function(a){m(Object(G.a)(Object(G.a)({},e),{},{activityType:a.target.value}),t)}},u.a.createElement(ie.a,{value:"All"},"All"),u.a.createElement(ie.a,{value:"Observation"},"Observation"),u.a.createElement(ie.a,{value:"Treatment"},"Treatment"),u.a.createElement(ie.a,{value:"Monitoring"},"Monitoring")))),u.a.createElement(Y.a,{item:!0,xs:4},u.a.createElement(ne.a,null,"Photos"),u.a.createElement(jr.a,{color:"primary",checked:e.includePhotos,value:e.includePhotos,onChange:function(){m(Object(G.a)(Object(G.a)({},e),{},{includePhotos:!e.includePhotos}),t)}})),u.a.createElement(Y.a,{item:!0,xs:4},u.a.createElement(ne.a,null,"Forms"),u.a.createElement(jr.a,{color:"primary",checked:e.includeForms,value:e.includeForms,onChange:function(){m(Object(G.a)(Object(G.a)({},e),{},{includeForms:!e.includeForms}),t)}})),u.a.createElement(Y.a,{item:!0,xs:6},u.a.createElement(wr.a,{autoOk:!0,variant:"inline",format:"MM/dd/yyyy",margin:"normal",id:"date-picker-inline",label:"Earliest Date",value:e.startDate,onChange:function(a){m(Object(G.a)(Object(G.a)({},e),{},{startDate:a}),t)},KeyboardButtonProps:{"aria-label":"change date start"}})),u.a.createElement(Y.a,{item:!0,xs:6},u.a.createElement(wr.a,{autoOk:!0,variant:"inline",format:"MM/dd/yyyy",margin:"normal",id:"date-picker-inline",label:"Latest Date",value:e.endDate,onChange:function(a){m(Object(G.a)(Object(G.a)({},e),{},{endDate:a}),t)},KeyboardButtonProps:{"aria-label":"change date end"}})),u.a.createElement(Y.a,{container:!0,item:!0,justify:"flex-end"},u.a.createElement(ce.a,{variant:"contained",startIcon:u.a.createElement(oe.a,null),onClick:function(){return function(e){var t=Object(y.a)(r);t.splice(e,1),d(t)}(t)}},"Remove")))))}))),u.a.createElement(v.a,null,u.a.createElement(ce.a,{variant:"contained",color:"primary",startIcon:u.a.createElement(se.a,null),onClick:function(){var e;e={activityType:"",includePhotos:!1,includeForms:!1,species:[],startDate:null,endDate:null},d([].concat(Object(y.a)(r),[e]))}},"Add New"))))},kr=Object(q.a)((function(e){return{paper:{textAlign:"center",color:e.palette.text.secondary},metabaseRecordsChoice:{padding:e.spacing(2)},metabaseSearchField:{width:"fit-content",minWidth:200},metabaseFilter:{flexDirection:"column"},metabaseAddButton:{width:"100%"}}})),Tr=function(e){var t=Object(s.useContext)(x),a=Object(s.useContext)(k),n=Object(s.useState)([]),r=Object(_.a)(n,2),o=r[0],l=r[1],d=Object(s.useState)([]),m=Object(_.a)(d,2),p=m[0],v=m[1],f=Ce(),b=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.database.find({selector:{_id:"trip"}});case 2:(a=e.sent).docs.length&&(n=a.docs[0]).metabaseChoices&&l(Object(y.a)(n.metabaseChoices));case 4:case"end":return e.stop()}}),e)}))),[t.database]),g=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.database.find({selector:{_id:"trip"}});case 2:if(!(a=e.sent).docs.length){e.next=21;break}if(!(n=a.docs[0]).metabaseChoices||n.metabaseQueryOptionsLastChecked&&!(C()().diff(n.metabaseQueryOptionsLastChecked,"minutes")>=1)){e.next=20;break}return e.prev=6,e.next=9,f.getMetabaseQueryOptions();case 9:return r=e.sent,e.next=12,t.database.upsert("trip",(function(e){return Object(G.a)(Object(G.a)({},e),{},{metabaseQueryOptionsLastChecked:C()().valueOf(),metabaseQueryOptions:r})}));case 12:v(r),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(6),n.metabaseQueryOptions&&v(n.metabaseQueryOptions);case 18:e.next=21;break;case 20:n.metabaseQueryOptions&&v(n.metabaseQueryOptions);case 21:case"end":return e.stop()}}),e,null,[[6,15]])}))),[t.database]);Object(s.useEffect)((function(){b()}),[a,b]);var h=function(){var e=Object(c.a)(i.a.mark((function e(a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.database.upsert("trip",(function(e){return Object(G.a)(Object(G.a)({},e),{},{metabaseChoices:a})}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(e,t){var a=Object(y.a)(o);a[t]=e,h(Object(y.a)(a))},E=kr();return(null===p||void 0===p?void 0:p.length)||g(),u.a.createElement(u.a.Fragment,null,u.a.createElement(xr.a,{utils:Er.a},u.a.createElement(Y.a,{className:E.metabaseFilter},u.a.createElement(Q.a,null,o.map((function(e,t){return u.a.createElement($.a,{key:t},u.a.createElement(K.a,{className:E.metabaseRecordsChoice},u.a.createElement(Y.a,{container:!0,spacing:2,direction:"row"},u.a.createElement(Y.a,{container:!0,item:!0,xs:8},p&&p.length?u.a.createElement(re.a,{className:E.metabaseSearchField,label:"Metabase Query",id:"select",value:e.metabaseQueryId,onClick:function(){g()},onChange:function(a){O(Object(G.a)(Object(G.a)({},e),{},{metabaseQueryId:""+a.target.value,metabaseQueryName:p.filter((function(e){return e.id===a.target.value})).map((function(e){return e.name}))}),t)}},p.map((function(e){return u.a.createElement(ie.a,{key:e.id,value:e.id},e.name)}))):u.a.createElement(ya.a,{className:E.metabaseSearchField,label:"Metabase Query ID",value:e.metabaseQueryId,onClick:function(){g()},onChange:function(a){O(Object(G.a)(Object(G.a)({},e),{},{metabaseQueryId:a.target.value}),t)}})),u.a.createElement(Y.a,{container:!0,item:!0,xs:4,justify:"flex-end"},u.a.createElement(ce.a,{variant:"contained",startIcon:u.a.createElement(oe.a,null),onClick:function(){return function(e){var t=Object(y.a)(o);t.splice(e,1),h(t)}(t)}},"Remove")))))}))),u.a.createElement(ce.a,{variant:"contained",color:"primary",className:E.metabaseAddButton,startIcon:u.a.createElement(se.a,null),onClick:function(){var e;e={metabaseQueryId:""},h([].concat(Object(y.a)(o),[e]))}},"Add New"))))},Ir=a(523),Ar=a(882).DOMParser,Dr=function(e){var t=Object(s.useContext)(x),a=Object(s.useState)(null),n=Object(_.a)(a,2),r=n[0],o=n[1],l=function(){var e=Object(c.a)(i.a.mark((function e(a){var n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.text().then((function(e){return e}));case 2:if(n=e.sent,r=(new Ar).parseFromString(n),c=Object(Na.kml)(r),console.log("geo"),!c){e.next=10;break}return console.log("saving geo feat collection"),e.next=10,t.database.upsert("trip",(function(e){return Object(G.a)(Object(G.a)({},e),{},{geometry:c.features})}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(s.useEffect)((function(){r&&l(r)}),[r]),u.a.createElement(Ir.a,{dropzoneText:"Upload KML here",onChange:function(e){o(e[0])}})},Pr=Object(q.a)((function(e){return{paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary},pointOfInterestChoice:{padding:e.spacing(2)}}})),Nr=function(e){var t=Object(s.useContext)(x),a=Object(s.useState)([]),n=Object(_.a)(a,2),r=n[0],o=n[1],l=function(){var a=Object(c.a)(i.a.mark((function a(){var n,r;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("trip id for point filter: "+e.trip_ID),a.next=3,t.database.find({selector:{_id:e.trip_ID}});case 3:(n=a.sent).docs.length>0&&(r=n.docs[0]).pointOfInterestChoices&&o(Object(y.a)(r.pointOfInterestChoices));case 5:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();Object(s.useEffect)((function(){l()}),[]);var d=function(){var a=Object(c.a)(i.a.mark((function a(n){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.database.upsert(e.trip_ID,(function(e){return Object(G.a)(Object(G.a)({},e),{},{pointOfInterestChoices:n})}));case 2:o(Object(y.a)(n));case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),m=function(e,t){var a=r;a[t]=e,d(Object(y.a)(a))},p=Pr();return u.a.createElement(u.a.Fragment,null,u.a.createElement(xr.a,{utils:Er.a},u.a.createElement(Q.a,null,r.map((function(e,t){return u.a.createElement($.a,{key:t},u.a.createElement(K.a,{className:p.pointOfInterestChoice},u.a.createElement(Y.a,{container:!0,spacing:3},u.a.createElement(Y.a,{item:!0,xs:4},u.a.createElement("div",null,u.a.createElement(ne.a,{id:"demo-simple-select-label"},"Point Of Interest Type"),u.a.createElement(re.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:e.pointOfInterestType,onChange:function(a){m(Object(G.a)(Object(G.a)({},e),{},{pointOfInterestType:a.target.value}),t)}},u.a.createElement(ie.a,{value:""},"All"),u.a.createElement(ie.a,{value:"IAPP Site"},"IAPP Site")))),u.a.createElement(Y.a,{item:!0,xs:6},u.a.createElement(wr.a,{autoOk:!0,variant:"inline",format:"MM/dd/yyyy",margin:"normal",id:"date-picker-inline",label:"Earliest Date",value:e.startDate,onChange:function(a){m(Object(G.a)(Object(G.a)({},e),{},{startDate:a}),t)},KeyboardButtonProps:{"aria-label":"change date start"}})),u.a.createElement(Y.a,{item:!0,xs:6},u.a.createElement(wr.a,{autoOk:!0,variant:"inline",format:"MM/dd/yyyy",margin:"normal",id:"date-picker-inline",label:"Latest Date",value:e.endDate,onChange:function(a){m(Object(G.a)(Object(G.a)({},e),{},{endDate:a}),t)},KeyboardButtonProps:{"aria-label":"change date end"}})),u.a.createElement(Y.a,{container:!0,item:!0,justify:"flex-end"},u.a.createElement(ce.a,{variant:"contained",startIcon:u.a.createElement(oe.a,null),onClick:function(){return function(e){var t=Object(y.a)(r);t.splice(e,1),d(t)}(t)}},"Remove")))))}))),u.a.createElement(v.a,null,u.a.createElement(ce.a,{variant:"contained",color:"primary",startIcon:u.a.createElement(se.a,null),onClick:function(){var e;e={pointOfInterestType:"",includePhotos:!0,includeForms:!0,startDate:null,endDate:null},d([].concat(Object(y.a)(r),[e]))}},"Add New"))))},Fr=Object(q.a)((function(e){return{paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary},controlsGrid:Object(U.a)({flexDirection:"row"},e.breakpoints.down("sm"),{flexDirection:"column"})}})),Mr=function(e){Fr();var t=Ce(),a=Object(s.useContext)(x),n=Object(s.useContext)(k),r=Object(s.useState)(null),o=Object(_.a)(r,2),l=o[0],d=o[1],m=Object(s.useState)(!1),p=Object(_.a)(m,2),v=p[0],f=p[1],b=function(){var e=Object(c.a)(i.a.mark((function e(t){var n,r,c,o,l,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.database.allDocs({include_docs:!0});case 2:return n=e.sent,r=(null===n||void 0===n?void 0:n.rows)?n.rows:[],c=Object(G.a)({},t),o=r.filter((function(e){var a,n=null===(a=e.doc)||void 0===a?void 0:a._id;return c[n]=void 0,t[n]})).map((function(e){return t[e.id](e.doc)})),l=Object.keys(c).filter((function(e){return void 0!==c[e]})).map((function(e){return t[e]()})),(s=[].concat(Object(y.a)(o),Object(y.a)(l))).sort((function(e,t){return e.id<t.id?-1:e.id>t.id?1:0})),e.next=11,a.database.bulkDocs(s);case 11:return e.abrupt("return",Object.keys(t).length);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(c.a)(i.a.mark((function e(n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],!n.media_keys||!n.media_keys.length){e.next=13;break}return e.prev=2,e.next=5,t.getMedia(n.media_keys);case 5:e.sent.forEach((function(e){r.push({filepath:e.file_name,dataUrl:e.encoded_file})})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),Ie(a,"Could not fetch photos for "+n._id);case 12:return e.abrupt("return",r);case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}(),h=Object(s.useCallback)(Object(c.a)(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.database.find({selector:{_id:e.trip_ID,docType:ye.TRIP}});case 2:if((n=t.sent)&&n.docs&&n.docs.length){t.next=5;break}return t.abrupt("return");case 5:d(n.docs[0]);case 6:case"end":return t.stop()}}),t)}))),[a.database]);Object(s.useEffect)((function(){h()}),[n,h]);var O=function(){var n=Object(c.a)(i.a.mark((function n(){var r,c,o,s,u,d,m,p,v,f,_;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l&&l.activityChoices&&l.activityChoices.length){n.next=2;break}return n.abrupt("return");case 2:r=0,c=Object(z.a)(l.activityChoices),n.prev=4,c.s();case 6:if((o=c.n()).done){n.next=42;break}return s=o.value,u=l.geometry&&l.geometry.length&&l.geometry[0]||null,d=Object(G.a)(Object(G.a)(Object(G.a)(Object(G.a)({},s.activityType&&{activity_type:[s.activityType]}||[]),s.startDate&&{date_range_start:s.startDate}||{}),s.endDate&&{date_range_end:s.endDate}||{}),u&&{search_feature:u}||{}),n.next=12,t.getActivities(d);case 12:m=n.sent,p=[],v=Object(z.a)(m.rows),n.prev=15,_=i.a.mark((function t(){var a,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=f.value,n=[],!s.includePhotos){t.next=6;break}return t.next=5,g(a);case 5:n=t.sent;case 6:p=Object(G.a)(Object(G.a)({},p),{},Object(U.a)({},a.activity_id,(function(t){return Object(G.a)(Object(G.a)(Object(G.a)({},t),{},{_id:a.activity_id,docType:ye.REFERENCE_ACTIVITY,trip_IDs:(null===t||void 0===t?void 0:t.trip_IDs)?[].concat(Object(y.a)(t.trip_IDs),[e.trip_ID]):[e.trip_ID]},a),{},{formData:a.activity_payload.form_data,activityType:a.activity_type,activitySubtype:a.activity_subtype,geometry:a.activity_payload.geometry,photos:n})})));case 7:case"end":return t.stop()}}),t)})),v.s();case 18:if((f=v.n()).done){n.next=22;break}return n.delegateYield(_(),"t0",20);case 20:n.next=18;break;case 22:n.next=27;break;case 24:n.prev=24,n.t1=n.catch(15),v.e(n.t1);case 27:return n.prev=27,v.f(),n.finish(27);case 30:return n.prev=30,n.t2=r,n.next=34,b(p);case 34:r=n.t2+=n.sent,n.next=40;break;case 37:n.prev=37,n.t3=n.catch(30),Ie(a,"Error with inserting Activities into database: "+n.t3);case 40:n.next=6;break;case 42:n.next=47;break;case 44:n.prev=44,n.t4=n.catch(4),c.e(n.t4);case 47:return n.prev=47,c.f(),n.finish(47);case 50:Ae(a,"Cached "+r+" activities.");case 51:case"end":return n.stop()}}),n,null,[[4,44,47,50],[15,24,27,30],[30,37]])})));return function(){return n.apply(this,arguments)}}(),E=function(){var n=Object(c.a)(i.a.mark((function n(){var r,c,o,s,u,d,m,p,v,f,_;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l&&l.pointOfInterestChoices&&l.pointOfInterestChoices.length){n.next=2;break}return n.abrupt("return");case 2:r=0,c=Object(z.a)(l.pointOfInterestChoices),n.prev=4,c.s();case 6:if((o=c.n()).done){n.next=42;break}return s=o.value,u=l.geometry&&l.geometry.length&&l.geometry[0]||null,d=Object(G.a)(Object(G.a)(Object(G.a)(Object(G.a)({},s.pointOfInterestType&&{point_of_interest_type:s.pointOfInterestType}||{}),s.startDate&&{date_range_start:s.startDate}||{}),s.endDate&&{date_range_end:s.endDate}||{}),u&&{search_feature:u}||{}),n.next=12,t.getPointsOfInterest(d);case 12:m=n.sent,p={},v=Object(z.a)(m),n.prev=15,_=i.a.mark((function t(){var a,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=f.value,n=[],!s.includePhotos){t.next=6;break}return t.next=5,g(a);case 5:n=t.sent;case 6:p=Object(G.a)(Object(G.a)({},p),{},Object(U.a)({},"POI"+a.point_of_interest_id,(function(t){return Object(G.a)(Object(G.a)(Object(G.a)({},t),{},{_id:"POI"+a.point_of_interest_id,docType:ye.REFERENCE_POINT_OF_INTEREST,trip_IDs:(null===t||void 0===t?void 0:t.trip_IDs)?[].concat(Object(y.a)(t.trip_IDs),[e.trip_ID]):[e.trip_ID]},a),{},{formData:a.point_of_interest_payload.form_data,pointOfInterestType:a.point_of_interest_type,pointOfInterestSubtype:a.point_of_interest_subtype,geometry:Object(y.a)(a.point_of_interest_payload.geometry),photos:n})})));case 7:case"end":return t.stop()}}),t)})),v.s();case 18:if((f=v.n()).done){n.next=22;break}return n.delegateYield(_(),"t0",20);case 20:n.next=18;break;case 22:n.next=27;break;case 24:n.prev=24,n.t1=n.catch(15),v.e(n.t1);case 27:return n.prev=27,v.f(),n.finish(27);case 30:return n.prev=30,n.t2=r,n.next=34,b(p);case 34:r=n.t2+=n.sent,n.next=40;break;case 37:n.prev=37,n.t3=n.catch(30),Ie(a,"Error with inserting Points of Interest into database: "+n.t3);case 40:n.next=6;break;case 42:n.next=47;break;case 44:n.prev=44,n.t4=n.catch(4),c.e(n.t4);case 47:return n.prev=47,c.f(),n.finish(47);case 50:Ae(a,"Cached "+r+" points of interest.");case 51:case"end":return n.stop()}}),n,null,[[4,44,47,50],[15,24,27,30],[30,37]])})));return function(){return n.apply(this,arguments)}}(),j=function(){var n=Object(c.a)(i.a.mark((function n(){var r,c,o,s,u,d;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l&&l.metabaseChoices&&l.metabaseChoices.length){n.next=2;break}return n.abrupt("return");case 2:r=0,c=0,o=Object(z.a)(l.metabaseChoices),n.prev=5,u=i.a.mark((function n(){var o,u,d,m,p,v,f,_,h,O,E;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(d=s.value,m=l.geometry&&l.geometry.length&&l.geometry[0]||null,p=Object(G.a)(Object(G.a)({},d.metabaseQueryId&&{metabaseQueryId:d.metabaseQueryId}||{}),m&&{search_feature:m}||{}),d.metabaseQueryId){n.next=6;break}return Ie(a,"Metabase Query ID cannot be blank, please select a query"),n.abrupt("return",{v:void 0});case 6:return n.next=8,t.getMetabaseQueryResults(p);case 8:return v=n.sent,n.next=11,a.database.upsert(e.trip_ID,(function(e){return Object(G.a)(Object(G.a)({},e),{},{metabaseQueryNames:Object(G.a)(Object(G.a)({},l.metabaseQueryNames),{},Object(U.a)({},d.metabaseQueryId,v.name))})}));case 11:f=[],(null===v||void 0===v||null===(o=v.activities)||void 0===o?void 0:o.length)&&(f=v.activities),(null===v||void 0===v||null===(u=v.points_of_interest)||void 0===u?void 0:u.length)&&(f=[f].concat(Object(y.a)(v.points_of_interest))),_={},h=Object(z.a)(f),n.prev=16,E=i.a.mark((function t(){var a,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=O.value,n=[],!d.includePhotos){t.next=6;break}return t.next=5,g(a);case 5:n=t.sent;case 6:a.activity_id&&(_=Object(G.a)(Object(G.a)({},_),{},Object(U.a)({},a.activity_id,(function(t){return Object(G.a)(Object(G.a)(Object(G.a)({},t),{},{_id:a.activity_id,docType:ye.REFERENCE_ACTIVITY,trip_IDs:t&&t.trip_IDs?[].concat(Object(y.a)(t.trip_IDs),[e.trip_ID]):[e.trip_ID]},a),{},{formData:a.activity_payload.form_data,activityType:a.activity_type,activitySubtype:a.activity_subtype,geometry:a.activity_payload.geometry,photos:n})}))),r++),a.point_of_interest_id&&(_=Object(G.a)(Object(G.a)({},_),{},Object(U.a)({},"POI"+a.point_of_interest_id,(function(t){return Object(G.a)(Object(G.a)(Object(G.a)({},t),{},{_id:"POI"+a.point_of_interest_id,docType:ye.REFERENCE_POINT_OF_INTEREST,trip_IDs:t&&t.trip_IDs?[].concat(Object(y.a)(t.trip_IDs),[e.trip_ID]):[e.trip_ID]},a),{},{formData:a.point_of_interest_payload.form_data,pointOfInterestType:a.point_of_interest_type,pointOfInterestSubtype:a.point_of_interest_subtype,geometry:Object(y.a)(a.point_of_interest_payload.geometry),photos:n})}))),c++);case 8:case"end":return t.stop()}}),t)})),h.s();case 19:if((O=h.n()).done){n.next=23;break}return n.delegateYield(E(),"t0",21);case 21:n.next=19;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(16),h.e(n.t1);case 28:return n.prev=28,h.f(),n.finish(28);case 31:return n.prev=31,n.next=34,b(_);case 34:n.next=39;break;case 36:n.prev=36,n.t2=n.catch(31),Ie(a,"Error with inserting Metabase results into database: "+n.t2);case 39:case"end":return n.stop()}}),n,null,[[16,25,28,31],[31,36]])})),o.s();case 8:if((s=o.n()).done){n.next=15;break}return n.delegateYield(u(),"t0",10);case 10:if("object"!==typeof(d=n.t0)){n.next=13;break}return n.abrupt("return",d.v);case 13:n.next=8;break;case 15:n.next=20;break;case 17:n.prev=17,n.t1=n.catch(5),o.e(n.t1);case 20:return n.prev=20,o.f(),n.finish(20);case 23:Ae(a,"Cached "+(r?r+" activities":"")+(r&&c?" and ":"")+(c?c+" points of interest":"")+(r||c?" from Metabase.":"0 Metabase results."));case 24:case"end":return n.stop()}}),n,null,[[5,17,20,23]])})));return function(){return n.apply(this,arguments)}}(),w=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return function(){},e.next=4,f(!0);case 4:Promise.all([O(),E(),j()]).finally((function(){return f(!1)})).catch((function(e){f(!1),Ie(a,"Error when fetching from network: "+e)}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return u.a.createElement(u.a.Fragment,null,u.a.createElement(ce.a,{variant:"contained",color:"primary",disabled:v,onClick:w},v?u.a.createElement(Da,null):"Cache Trip For Offline"))},Rr=a(518),Lr=a.n(Rr),Br=a(338),Wr=a.n(Br),zr=a(517),Gr=a.n(zr),Ur=Object(q.a)((function(e){return{status:{}}}));!function(e){e.initial="initial",e.ready="ready",e.error="error"}(vr||(vr={}));var qr=function(e){return Ur(),e.statusCode==vr.initial?u.a.createElement(u.a.Fragment,null,u.a.createElement(Wr.a,{color:"disabled",fontSize:"large"})):e.statusCode==vr.ready?u.a.createElement(u.a.Fragment,null,u.a.createElement(Wr.a,{color:"primary",fontSize:"large"})):u.a.createElement(u.a.Fragment,null,u.a.createElement(Gr.a,{color:"error",fontSize:"large"}))},Yr=Object(q.a)((function(e){return{status:{}}})),Vr=function(e){var t=Object(s.useContext)(x),a=Object(s.useState)(null),n=Object(_.a)(a,2),r=n[0],o=n[1],l=Object(s.useState)(null),d=Object(_.a)(l,2),m=d[0],p=d[1],v=Object(s.useCallback)(Object(c.a)(i.a.mark((function a(){var n,c;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.database.find({selector:{_id:e.trip_ID}});case 2:(n=a.sent).docs.length>0&&(c=n.docs[0],p(c),c.name!=r&&o(c.name));case 4:case"end":return a.stop()}}),a)}))),[t.database]),f=function(){var a=Object(c.a)(i.a.mark((function a(n){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.database.upsert(e.trip_ID,(function(e){return Object(G.a)(Object(G.a)({},e),{},{name:n,persistenceStep:"naming trip"})}));case 2:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}();return Object(s.useEffect)((function(){v()}),[r]),Yr(),u.a.createElement(u.a.Fragment,null,m?u.a.createElement(Tt.a,{defaultValue:r,onBlur:function(e){f(e.target.value)},color:"primary"}):u.a.createElement(Da,null))},Hr=function(){var e=Object(c.a)(i.a.mark((function e(t,a){var n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("trip id to delete "+a),e.next=5,t.database.find({selector:{$and:[{docType:{$in:[ye.REFERENCE_ACTIVITY,ye.POINT_OF_INTEREST,ye.REFERENCE_POINT_OF_INTEREST]}},{trip_IDs:{$elemMatch:{$eq:a.toString()}}}]},use_index:"tripIDIndex"});case 5:n=e.sent,console.log(n.docs),r=[],c=[],n.docs.map((function(e){var t=!0;e.trip_IDs.map((function(e){e!==a.toString()&&(t=!1)})),t?r.push(Object(G.a)(Object(G.a)({},e),{},{_deleted:!0})):c.push(e)})),t.database.bulkDocs(r),c.map((function(e){var n=[];e.trip_IDs.map((function(e){e!==a.toString()&&n.push(e.toString())})),t.database.upsert(e._id,(function(e){return Object(G.a)(Object(G.a)({},e),{},{trip_IDs:[].concat(n)})}))})),Ae(t,"Wiped "+r.length+" records from trip.  "+c.length+" were not removed because they belong to another trip"),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),Ie(t,"Ran into a problem deleting trip records:"+e.t0),console.dir(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,a){return e.apply(this,arguments)}}(),Jr=Object(q.a)((function(e){return{accordionSummary:{padding:e.spacing(2),textAlign:"center"},tripList:{width:"100%"},tripAccordionGridItem:{textAlign:"left"},paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary},map:{height:"500px",width:"100%",zIndex:0},layerPicker:{height:"100%",width:"100%"},activityRecordList:{flexDirection:"column"},pointOfInterestList:{flexDirection:"column"},activityRecordQueryParmsRow:{width:"400px"},tripStorageUsageBar:{height:"20px",borderRadius:"20px"},totalStorageUsageBar:{height:"20px",borderRadius:"20px"},tripGrid:Object(U.a)({flexDirection:"column"},e.breakpoints.down("sm"),{flexDirection:"column"}),tripAccordion:{display:"block"}}})),Qr=function(e){var t=Jr(),a=Object(s.useContext)(x),n=Object(s.useState)([]),r=Object(_.a)(n,2),o=r[0],l=r[1],d=Object(s.useState)(null),m=Object(_.a)(d,2),p=m[0],f=m[1],b=Object(s.useState)(null),g=Object(_.a)(b,2),h=g[0],O=g[1],E=Object(s.useState)(null),j=Object(_.a)(E,2),w=j[0],S=(j[1],Object(s.useState)(null)),C=Object(_.a)(S,2),k=C[0],T=C[1],I=Object(s.useState)([]),A=Object(_.a)(I,2),D=A[0],P=A[1],N=Object(s.useState)(!1),F=Object(_.a)(N,2),M=F[0],R=F[1],L=Object(s.useState)({isOpen:!1,lat:0,lng:0}),B=Object(_.a)(L,2),z=B[0],U=B[1],q=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.database.find({selector:{docType:ye.PLAN_PAGE_EXTENT},use_index:"docTypeIndex"});case 2:if((t=e.sent)&&t.docs&&t.docs.length){e.next=5;break}return e.abrupt("return");case 5:if(t[0]){e.next=7;break}return e.abrupt("return");case 7:t[0].extent&&O(t[0].extent);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,r,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,a.database.find({selector:{docType:{$eq:ye.TRIP}},use_index:"docTypeIndex"});case 3:0===(null===(r=e.sent)||void 0===r||null===(t=r.docs)||void 0===t?void 0:t.length)&&(console.log("got here"),R(!0)),c=[],o=[],null===r||void 0===r||null===(n=r.docs)||void 0===n||n.map((function(e){c.push({trip_ID:e.trip_ID,trip_name:e.name,num_activities:5,num_POI:4}),e.geometry&&o.push({recordDocID:e._id,recordDocType:e.docType,description:"Uploaded spatial content:\n "+e._id+"\n",geometry:e.geometry,color:"orange",onClickCallback:function(){},popUpComponent:null})})),o.length>0&&f(o),P(c);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.database.find({selector:{trip_id:{$gte:null}},sort:[{trip_id:"desc"}],use_index:"tripIDIndex",limit:1});case 4:if((t=e.sent)&&t.docs&&t.docs.length){e.next=9;break}return e.abrupt("return",0);case 9:if(console.dir(t.docs),!t.docs[0].trip_id){e.next=14;break}return e.abrupt("return",parseInt(t.docs[0]._id));case 14:return e.abrupt("return",0);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(s.useEffect)((function(){(function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V();case 2:return e.next=4,q();case 4:R(!0);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[k]),Object(s.useEffect)((function(){M&&w&&o&&a.database.upsert(w,(function(e){return Object(G.a)(Object(G.a)({},e),{},{geometry:o,persistenceStep:"update geo"})}))}),[o,M,a.database]),Object(s.useEffect)((function(){M&&h&&a.database.upsert("planPageExtent",(function(e){return Object(G.a)(Object(G.a)({},e),{},{docType:ye.PLAN_PAGE_EXTENT,extent:h})}))}),[h,M]);var Q=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J();case 2:t=e.sent,t+=1,a.database.upsert(t.toString(),(function(e){return Object(G.a)(Object(G.a)({},e),{},{trip_ID:t.toString(),trip_name:"New Unnamed Trip",num_activities:0,num_POI:0,docType:ye.TRIP,stepState:[{},{status:vr.initial,expanded:!0},{status:vr.initial,expanded:!1},{status:vr.initial,expanded:!1},{status:vr.initial,expanded:!1},{status:vr.initial,expanded:!1},{status:vr.initial,expanded:!1}]})})),T(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(e){var a=Object(s.useContext)(x),n=Object(s.useState)(null),r=Object(_.a)(n,2),l=r[0],d=r[1],m=Object(s.useCallback)(Object(c.a)(i.a.mark((function t(){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.database){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,a.database.find({selector:{docType:ye.TRIP,trip_ID:e.trip_ID},use_index:"docTypeIndex"});case 4:if(!((n=t.sent).docs.length>0)){t.next=10;break}if((r=n.docs[0]).stepState){t.next=9;break}return t.abrupt("return");case 9:d(r.stepState);case 10:case"end":return t.stop()}}),t)}))),[a.database]),p=function(){var t=Object(c.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d(n),t.next=3,a.database.upsert(e.trip_ID,(function(e){return Object(G.a)(Object(G.a)({},e),{},{docType:ye.TRIP,stepState:n,persistenceStep:"updating state"})}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();Object(s.useEffect)((function(){m(),console.log("hook to get state")}),[a]);var v=function(e,t){for(var a=Object(y.a)(l),n=1;n<l.length;n++){var r=!(n!=t||!e);a[n]=Object(G.a)(Object(G.a)({},a[n]),{},{expanded:r})}console.log("accordion helper"),p(Object(y.a)(a))},f=function(e){for(var t=Object(y.a)(l),a=1;a<l.length;a++)t[a]=Object(G.a)(Object(G.a)({},t[a]),{},{expanded:!1}),a==e&&2!=a&&(t[a]=Object(G.a)(Object(G.a)({},t[a]),{},{status:vr.ready}));p(Object(y.a)(t))};return Object(s.useMemo)((function(){var a,n;return u.a.createElement(u.a.Fragment,null,l?u.a.createElement(Y.a,{item:!0,md:12},u.a.createElement(Z,{title:"Step 1: Name your trip",helpText:"The 'spatial filter' to your search.  Put bounds around data you need to pack with you.",additionalText:"other",expanded:null===(a=l[1])||void 0===a?void 0:a.expanded,tripStepDetailsClassName:t.activityRecordList,stepStatus:null===(n=l[1])||void 0===n?void 0:n.status,stepAccordionOnChange:function(e,t){v(t,1)},doneButtonCallBack:function(){f(1)}},u.a.createElement(Vr,{trip_ID:e.trip_ID})),u.a.createElement(Z,{title:"Step 2: Add a spatial boundary for your trip.",helpText:"The 'spatial filter' to your search.  Put bounds around data you need to pack with you.",additionalText:"other",expanded:l[2].expanded,tripStepDetailsClassName:t.activityRecordList,stepStatus:o?vr.ready:l[1].status,stepAccordionOnChange:function(e,t){v(t,2)},doneButtonCallBack:function(){f(2)}},u.a.createElement(K.a,{className:t.paper},u.a.createElement(H.a,{variant:"body1"},"Draw a polygon or square on the map, or upload a KML containing 1 shape."),u.a.createElement(Dr,null))),u.a.createElement(Z,{title:"Step 3: Choose past field activity data.",helpText:"This is where you can cache past activities (observations etc.) to the app.  If you want to search for records in a particular area, draw a polygon on the map.",additionalText:"other",expanded:l[3].expanded,tripStepDetailsClassName:t.activityRecordList,stepStatus:l[3].status,stepAccordionOnChange:function(e,t){v(t,3)},doneButtonCallBack:function(){f(3)}},u.a.createElement(Cr,{trip_ID:e.trip_ID})),u.a.createElement(Z,{title:"Step 4: Choose data from other systems, (IAPP)",helpText:"This is where you can cache IAPP sites, and later other points of interest.  If you want to search for records in a particular area, draw a polygon on the map.",additionalText:"other",expanded:l[4].expanded,tripStepDetailsClassName:t.pointOfInterestList,stepStatus:l[4].status,stepAccordionOnChange:function(e,t){v(t,4)},doneButtonCallBack:function(){f(4)}},u.a.createElement(Nr,{trip_ID:e.trip_ID})),u.a.createElement(Z,{title:"OPTIONAL: Get data from a Metabase Question",helpText:"If you have a Metabase question that contains field activity ID's, you can load those records here.",additionalText:"other",expanded:l[5].expanded,tripStepDetailsClassName:t.pointOfInterestList,stepStatus:l[5].status,stepAccordionOnChange:function(e,t){v(t,5)},doneButtonCallBack:function(){f(5)}},u.a.createElement(Tr,null)),u.a.createElement(Z,{title:"Last Step: Cache, Refresh, or Delete data for Trip ",helpText:"Cache the data and map data for the region you have selected, or refresh it, or delete.",additionalText:"other",expanded:l[6].expanded,tripStepDetailsClassName:t.pointOfInterestList,stepStatus:l[6].status,stepAccordionOnChange:function(e,t){v(t,6)},doneButtonCallBack:function(){f(6)}},u.a.createElement(Mr,{trip_ID:e.trip_ID}))):u.a.createElement(u.a.Fragment,null,"test",u.a.createElement(Da,null)))}),[JSON.stringify(l)])},Z=function(e){return u.a.createElement(at.a,{defaultExpanded:e.expanded,expanded:e.expanded,onChange:e.stepAccordionOnChange},u.a.createElement(nt.a,{className:t.accordionSummary,expandIcon:u.a.createElement(it.a,{fontSize:"large"}),"aria-controls":"panel-geo-record-picker-content",id:"panel-geo-record-picker-header"},u.a.createElement(Y.a,{alignContent:"flex-start",justify:"space-between",container:!0},u.a.createElement(Y.a,{xs:2,className:t.tripAccordionGridItem,item:!0},u.a.createElement(Pt.a,{color:"primary",title:e.helpText,arrow:!0},u.a.createElement(Lr.a,{fontSize:"large"}))),u.a.createElement(Y.a,{xs:6,item:!0},u.a.createElement(H.a,{align:"left",variant:"h5"},e.title)),u.a.createElement(Y.a,{xs:2,item:!0},u.a.createElement(qr,{statusCode:e.stepStatus})))),u.a.createElement(rt.a,{className:e.tripStepDetailsClassName},e.children,u.a.createElement(v.a,{m:2,alignSelf:"center"},u.a.createElement(ce.a,{variant:"contained",color:"primary",onClick:e.doneButtonCallBack},"I'm done here."))))},X=Object(s.useMemo)((function(){return u.a.createElement(K.a,{className:t.paper},u.a.createElement(Ra,Object.assign({},e,{classes:t,showDrawControls:!0,mapId:"TODO_this_needs_to_be_a_globally_uniqe_id_per_map_instance",geometryState:{geometry:o,setGeometry:l},interactiveGeometryState:{interactiveGeometry:p,setInteractiveGeometry:f},extentState:{extent:h,setExtent:O},contextMenuState:{state:z,setContextMenuState:U}})))}),[o,p,M]),ee=function(){var e=Object(c.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("You sure you want to do this?")){e.next=3;break}return e.next=3,Hr(a,t);case 3:return e.next=5,a.database.get(t.toString()).then((function(e){return a.database.remove(e)}));case 5:T(Math.random());case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return u.a.createElement(W.a,{className:e.classes.container},X,u.a.createElement(ce.a,{onClick:Q,color:"primary",variant:"contained"},"Add Trip"),!M&&u.a.createElement(u.a.Fragment,null," ","spinner ",u.a.createElement(Da,null)),M&&u.a.createElement(er,{className:t.tripList,tableName:"My Trips",keyField:"trip_ID",headers:[{id:"trip_ID",title:"Trip ID"},{id:"trip_name",title:"Trip Name"},{id:"num_activities",title:"# of Activities Cached"},{id:"num_poi",title:"# of POI Cached"},{id:"buttons"}],rows:(null===D||void 0===D?void 0:D.length)?D.map((function(e){return Object(G.a)(Object(G.a)({},e),{},{buttons:function(e){return u.a.createElement(te.a,null,u.a.createElement(oe.a,{onClick:function(){ee(e.trip_ID,e.trip_name)}}))}})})):[],dropdown:function(e){return u.a.createElement($,{trip_ID:e.trip_ID})}}))},Kr=Object(q.a)((function(e){return{heading:{fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular},mapContainer:{height:"600px"},map:{height:"100%",width:"100%",zIndex:0},formContainer:{},photoContainer:{}}})),$r=function(e){var t=Object(ke.h)(),a=Kr(),n=Object(s.useContext)(x),r=Object(s.useContext)(k),o=Object(s.useState)([]),l=Object(_.a)(o,2),d=l[0],m=l[1],p=Object(s.useState)(null),v=Object(_.a)(p,2),f=v[0],y=v[1],g=Object(s.useState)({isOpen:!1,lat:0,lng:0}),h=Object(_.a)(g,2),O=h[0],E=h[1],j=Object(s.useState)(null),w=Object(_.a)(j,2),S=w[0],C=w[1],T=Object(s.useState)([]),I=Object(_.a)(T,2),A=I[0],D=I[1];return Object(s.useEffect)((function(){(function(){var e=Object(c.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.database.find({selector:{_id:t.id}});case 2:a=e.sent,m(a.docs[0].geometry),D(a.docs[0].photos),C(a.docs[0]);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[r,n.database,t]),S?u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(Ya,{classes:a,activity:S,mapId:S._id,photoState:{photos:A,setPhotos:D},showDrawControls:!1,geometryState:{geometry:d,setGeometry:m},extentState:{extent:f,setExtent:y},contextMenuState:{state:O,setContextMenuState:E}})):u.a.createElement(b.a,null)},Zr=a(1060),Xr=a(525),ei=Object(q.a)((function(e){return{activitiesContent:{},activityList:{},activitiyListItem:{display:"flex",flexDirection:"row",marginTop:"0.5rem",marginBottom:"0.5rem",border:"1px solid",borderColor:e.palette.grey[300],borderRadius:"6px"},activityListItem_Grid:Object(U.a)({flexWrap:"nowrap",flexDirection:"row"},e.breakpoints.down("sm"),{flexDirection:"column"}),activitiyListItem_Typography:Object(U.a)({},e.breakpoints.down("sm"),{display:"inline",marginRight:"1rem"}),formControl:{minWidth:180},map:{height:500,width:"100%",zIndex:0},metabaseAddButton:{marginLeft:10,marginRight:10}}})),ti=function(e){var t,a,n,r,i,c,o,l,s,u;return Object(G.a)(Object(G.a)(Object(G.a)(Object(G.a)({},e),null===e||void 0===e||null===(t=e.formData)||void 0===t?void 0:t.activity_data),null===e||void 0===e||null===(a=e.formData)||void 0===a?void 0:a.activity_subtype_data),{},{activity_id:e.activity_id,jurisdiction_code:null===e||void 0===e||null===(n=e.formData)||void 0===n||null===(r=n.activity_data)||void 0===r||null===(i=r.jurisdictions)||void 0===i?void 0:i.reduce((function(e,t){return[].concat(Object(y.a)(e),[t.jurisdiction_code,"(",t.percent_covered+"%",")"])}),[]),created_timestamp:null===e||void 0===e||null===(c=e.created_timestamp)||void 0===c?void 0:c.substring(0,10),latitude:parseFloat(null===e||void 0===e||null===(o=e.formData)||void 0===o||null===(l=o.activity_data)||void 0===l?void 0:l.latitude).toFixed(6),longitude:parseFloat(null===e||void 0===e||null===(s=e.formData)||void 0===s||null===(u=s.activity_data)||void 0===u?void 0:u.longitude).toFixed(6)})},ai={Observation:"#0BD2F0",Treatment:"#F99F04",Monitoring:"#BCA0DC",reference_point_of_interest:"#0BD2F0",selected_record:"#9E1A1A"},ni=function(e){var t=Object(ke.f)(),a=e.selected,n=e.setSelected,r=e.rows;return Object(s.useMemo)((function(){return u.a.createElement(er,{tableName:"Observations",tableSchemaType:["Activity","Observation","Observation_PlantTerrestrial","Observation_PlantAquatic","ObservationPlantTerrestrialData","Jurisdictions"],startingOrderBy:"activity_id",startingOrder:"desc",enableSelection:!0,selected:a,setSelected:n,headers:["activity_id",{id:"activity_subtype",valueMap:{Activity_Observation_PlantTerrestrial:"Terrestrial Plant",Activity_Observation_PlantTerrestial:"Terrestrial Plant",Activity_Observation_PlantAquatic:"Aquatic Plant"}},{id:"created_timestamp",title:"Created Date"},"biogeoclimatic_zones",{id:"elevation",type:"number"},{id:"flnro_districts",title:"FLNRO Districs"},"ownership","regional_districts","invasive_species_agency_code","jurisdiction_code",{id:"latitude",title:"Latitude",type:"number"},{id:"longitude",title:"Longitude",type:"number"},{id:"reported_area",title:"Area (m\xb2)",type:"number"},"access_description","general_comment"],rows:r,actions:{delete:{enabled:!1},create_treatment:{key:"create_treatment",enabled:!0,action:function(e){var a=e.map((function(e){return e.activity_id}));t.push({pathname:"/home/activity/treatment",search:"?observations="+a.join(","),state:{observations:a}})},label:"Create Treatment",bulkAction:!0,rowAction:!1,displayInvalid:"error",invalidError:"All selected activities must be of the same SubType to create a Treatment",bulkCondition:function(e){return e.every((function(e,t,a){var n=Object(_.a)(a,1)[0];return e.subtype===n.subtype}))}}}})}),[null===r||void 0===r?void 0:r.length,null===a||void 0===a?void 0:a.length])},ri=function(e){var t=Object(ke.f)(),a=e.selected,n=e.setSelected,r=e.rows,o=e.databaseContext;return Object(s.useMemo)((function(){return u.a.createElement(er,{tableName:"Treatments",tableSchemaType:["Activity","Treatment","Treatment_ChemicalPlant","Treatment_MechanicalPlant","Treatment_BiologicalPlant"],startingOrderBy:"activity_id",startingOrder:"desc",enableSelection:!0,selected:a,setSelected:n,headers:["activity_id",{id:"activity_subtype",valueMap:{Activity_Treatment_ChemicalPlant:"Chemical Plant",Activity_Treatment_MechanicalPlant:"Mechanical Plant",Activity_Treatment_BiologicalPlant:"Biological Plant"}},{id:"created_timestamp",title:"Created Date"},"invasive_plant_code","invasive_species_agency_code","chemical_method_code",{id:"reported_area",title:"Area (m\xb2)"},{id:"latitude",title:"Latitude",type:"number"},{id:"longitude",title:"Longitude",type:"number"},"elevation"],rows:r,dropdown:function(e){return u.a.createElement(er,{key:e._id,startingOrderBy:"activity_id",startingOrder:"desc",tableSchemaType:["Activity","Treatment","Treatment_ChemicalPlant","Treatment_MechanicalPlant","Treatment_BiologicalPlant","Jurisdictions"],headers:["jurisdiction_code","biogeoclimatic_zones",{id:"flnro_districts",title:"FLNRO Districts"},"ownership","regional_districts","access_description","general_comment"],rows:[e],pagination:!1})},actions:{delete:{enabled:!1},create_monitoring:{key:"create_monitoring",enabled:!0,label:"Create Monitoring",bulkAction:!1,rowAction:!0,displayInvalid:"hidden",rowCondition:function(e){return"Treatment"===e.activityType},action:function(){var e=Object(c.a)(i.a.mark((function e(a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===a.length){e.next=2;break}return e.abrupt("return");case 2:return n=a[0],e.next=5,ze(o,R.Monitoring,(i=n.activitySubtype).includes("ChemicalPlant")?L.Monitoring_ChemicalTerrestrialAquaticPlant:i.includes("MechanicalPlant")?L.Monitoring_MechanicalTerrestrialAquaticPlant:i.includes("BiologicalPlant")?L.Monitoring_BiologicalTerrestrialPlant:L["Monitoring_".concat(i.split("_")[2])],n);case 5:return r=e.sent,e.next=8,o.database.upsert(ye.APPSTATE,(function(e){return Object(G.a)(Object(G.a)({},e),{},{activeActivity:r._id})}));case 8:t.push("/home/activity");case 9:case"end":return e.stop()}var i}),e)})));return function(t){return e.apply(this,arguments)}}()}}})}),[null===r||void 0===r?void 0:r.length,null===a||void 0===a?void 0:a.length])},ii=function(e){var t=e.selected,a=e.setSelected,n=e.rows;return Object(s.useMemo)((function(){return u.a.createElement(er,{tableName:"Monitoring",tableSchemaType:["Activity","Monitoring","Monitoring_ChemicalTerrestrialAquaticPlant","Monitoring_MechanicalTerrestrialAquaticPlant","Monitoring_BiologicalTerrestrialPlant"],startingOrderBy:"monitoring_id",startingOrder:"desc",enableSelection:!0,selected:t,setSelected:a,headers:["activity_id",{id:"activity_subtype",valueMap:{Activity_Monitoring_ChemicalPlant:"Chemical Plant",Activity_Monitoring_MechanicalPlant:"Mechanical Plant",Activity_Monitoring_BiologicalPlant:"Biological Plant"}},{id:"created_timestamp",title:"Created Date"},"invasive_plant_code","invasive_species_agency_code",{id:"reported_area",title:"Area (m\xb2)"},{id:"latitude",title:"Latitude",type:"number"},{id:"longitude",title:"Longitude",type:"number"},"elevation"],rows:n,actions:{delete:{enabled:!1}}})}),[null===n||void 0===n?void 0:n.length,null===t||void 0===t?void 0:t.length])},ci=function(e){var t=e.selected,a=e.setSelected,n=e.rows;return Object(s.useMemo)((function(){return u.a.createElement(er,{tableName:"Points of Interest",tableSchemaType:["Point_Of_Interest","IAPP_Site","Jurisdictions"],startingOrderBy:"site_id",startingOrder:"desc",enableSelection:!0,selected:t,setSelected:a,headers:[{id:"site_id",type:"number"},{id:"created_date_on_device",title:"Created Date"},"jurisdiction_code","elevation","slope_code","aspect_code","soil_texture_code",{id:"latitude",title:"Latitude",type:"number"},{id:"longitude",title:"Longitude",type:"number"},"access_description","general_comment"],rows:n,actions:{delete:{enabled:!1},edit:{enabled:!1}}})}),[null===n||void 0===n?void 0:n.length,null===t||void 0===t?void 0:t.length])},oi=function(e){var t=ei(),a=Object(s.useContext)(x),n=Ce(),r=Object(s.useState)([]),o=Object(_.a)(r,2),l=o[0],d=o[1],m=Object(s.useState)([]),p=Object(_.a)(m,2),f=p[0],b=p[1],g=Object(s.useState)(null),h=Object(_.a)(g,2),O=h[0],E=h[1],j=Object(s.useState)([]),w=Object(_.a)(j,2),S=w[0],C=w[1],k=Object(s.useMemo)((function(){return S}),[null===S||void 0===S?void 0:S.length]),T=Object(s.useState)(!0),I=Object(_.a)(T,2),A=I[0],D=I[1],P=Object(s.useState)(!1),N=Object(_.a)(P,2),F=N[0],M=N[1],R=Object(s.useState)({isOpen:!1,lat:0,lng:0}),L=Object(_.a)(R,2),B=L[0],z=L[1],U=Object(s.useCallback)((function(e){var t=function(e){return function(t){var a=-1!==t.indexOf(e),n=a?t.filter((function(t){return t!==e})):[].concat(Object(y.a)(t),[e]);return b((function(t){return t.map((function(t){return t._id===e&&(t.color=a?ai[t.recordType]:ai.selected_record),t}))})),n}};switch("reference_point_of_interest"===e.docType&&ve(t(e._id)),e.activityType){case"Observation":Z(t(e._id));break;case"Treatment":ne(t(e._id));break;case"Monitoring":se(t(e._id))}}),[]),q=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var t,n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(!0),e.next=3,a.database.allDocs({include_docs:!0});case 3:n=e.sent,r=null===n||void 0===n||null===(t=n.rows)||void 0===t?void 0:t.map((function(e){return e.doc})).filter((function(e){return(e.point_of_interest_id||e.activity_id)&&!e.deleted_timestamp})),C(Object(y.a)(r)),c=[],r.forEach((function(e){var t="reference_point_of_interest"===e.docType?"IAPP Point of Interest: ".concat(e.point_of_interest_id):"".concat(e.activityType,": ").concat(e._id,"}");c.push({_id:e._id,recordDocID:e._id,recordType:e.activityType||e.docType,recordSubtype:e.activitySubtype,geometry:e.geometry,color:ai[e.activityType||e.docType],description:t,popUpComponent:function(e){return"<div>"+e+"</div>"},zIndex:Fa(e),onClickCallback:function(){U(e)}})})),b([].concat(c)),D(!1);case 10:case"end":return e.stop()}}),e)}))),[U]);Object(s.useEffect)((function(){var e=[];if(null===l||void 0===l?void 0:l.length){f.forEach((function(t){Object(Xr.a)(t.geometry[0],l[0])&&e.push(t.recordDocID)}));var t=k.filter((function(t){return e.some((function(e){return e===t._id}))}));C(t)}else q()}),[null===l||void 0===l?void 0:l.length]);var Y=Object(s.useMemo)((function(){return k.filter((function(e){return"Observation"===e.activityType})).map(ti)}),[k]),V=Object(s.useState)([]),J=Object(_.a)(V,2),$=J[0],Z=J[1],X=Object(s.useMemo)((function(){return k.filter((function(e){return"Treatment"===e.activityType})).map(ti)}),[k]),ee=Object(s.useState)([]),te=Object(_.a)(ee,2),ae=te[0],ne=te[1],re=Object(s.useMemo)((function(){return k.filter((function(e){return"Monitoring"===e.activityType})).map(ti)}),[k]),ie=Object(s.useState)([]),oe=Object(_.a)(ie,2),le=oe[0],se=oe[1],ue=Object(s.useMemo)((function(){return k.filter((function(e){return"reference_point_of_interest"===e.docType})).map((function(e){var t,a,n,r,i,c,o,l,s,u,d,m;return Object(G.a)(Object(G.a)(Object(G.a)(Object(G.a)({},e),null===e||void 0===e||null===(t=e.formData)||void 0===t?void 0:t.point_of_interest_data),null===e||void 0===e||null===(a=e.formData)||void 0===a?void 0:a.point_of_interest_type_data),{},{jurisdiction_code:null===e||void 0===e||null===(n=e.formData)||void 0===n||null===(r=n.surveys)||void 0===r||null===(i=r[0])||void 0===i||null===(c=i.jurisdictions)||void 0===c?void 0:c.reduce((function(e,t){return[].concat(Object(y.a)(e),[t.jurisdiction_code,"(",(t.percent_covered?t.percent_covered:100)+"%",")"])}),[]),latitude:parseFloat(null===e||void 0===e||null===(o=e.point_of_interest_payload)||void 0===o||null===(l=o.geometry[0])||void 0===l||null===(s=l.geometry)||void 0===s?void 0:s.coordinates[1]).toFixed(6),longitude:parseFloat(null===e||void 0===e||null===(u=e.point_of_interest_payload)||void 0===u||null===(d=u.geometry[0])||void 0===d||null===(m=d.geometry)||void 0===m?void 0:m.coordinates[0]).toFixed(6)})}))}),[k]),de=Object(s.useState)([]),me=Object(_.a)(de,2),pe=me[0],ve=me[1],fe=function(){var e=Object(c.a)(i.a.mark((function e(t,r,c){var o,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(!0);case 2:return o={activity_ids:r,point_of_interest_ids:c},e.prev=3,e.next=6,n.createMetabaseQuery(o);case 6:if(!(null===(l=e.sent)||void 0===l?void 0:l.activity_query_id)||!(null===l||void 0===l?void 0:l.activity_query_name)){e.next=11;break}Ae(a,'Created a new Metabase Query, with name "'.concat(l.activity_query_name,'" and ID ').concat(l.activity_query_id)),e.next=12;break;case 11:throw l;case 12:e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(3),Ie(a,"Unable to create new Metabase Query.  There may an issue with your connection to the Metabase API: "+e.t0),e.next=19,M(!1);case 19:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t,a,n){return e.apply(this,arguments)}}();Object(s.useEffect)((function(){M(!1)}),[$.length,ae.length,se.length,pe.length]);var be=$.length+ae.length+le.length+pe.length,ye=function(e){return function(t){e((function(e){return b((function(a){return a.map((function(a){if(e.indexOf(a._id)!==t.indexOf(a._id)){var n=-1!==t.indexOf(a._id);a.color=n?ai.selected_record:ai[a.recordType]}return a}))})),t}))}};return u.a.createElement(W.a,{className:t.activitiesContent},u.a.createElement(v.a,{mb:3,display:"flex",justifyContent:"space-between"},u.a.createElement(H.a,{variant:"h4"},"Cached Activities"),k.length>0&&!A&&u.a.createElement(v.a,{display:"flex",justifyContent:"space-between"},u.a.createElement(ce.a,{variant:"contained",color:"primary",className:t.metabaseAddButton,disabled:!be||F,startIcon:be&&F?u.a.createElement(Zr.a,null):void 0,onClick:function(e){return fe(e,[].concat(Object(y.a)($),Object(y.a)(ae),Object(y.a)(le)),pe)}},"Create Metabase Query"))),k.length>0&&!A&&u.a.createElement(K.a,null,u.a.createElement(Ra,{classes:t,mapId:"references_page_map_container",geometryState:{geometry:l,setGeometry:d},interactiveGeometryState:{interactiveGeometry:f,setInteractiveGeometry:b},extentState:{extent:O,setExtent:E},showDrawControls:!0,contextMenuState:{state:B,setContextMenuState:z}})),A&&u.a.createElement(H.a,null,"Loading..."),!A&&!(null===f||void 0===f?void 0:f.length)&&u.a.createElement(H.a,null,"No cached records to display. Widen your selected area or fetch more on the Plan My Trip page."),u.a.createElement("br",null),f.length>0&&!A&&u.a.createElement(Q.a,{className:t.activityList},u.a.createElement(ni,{rows:Y,selected:$,setSelected:ye(Z)}),u.a.createElement(ri,{rows:X,selected:ae,setSelected:ye(ne)}),u.a.createElement(ii,{rows:re,selected:le,setSelected:ye(se)}),u.a.createElement(ci,{rows:ue,selected:pe,setSelected:ye(ve),databaseContext:a})))},li=function(e){return u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(oi,null))},si=a(1061),ui=function(){var e=Object(ke.g)();return je.a.parse(e.search.replace("?",""))};function di(e,t){return mi.apply(this,arguments)}function mi(){return(mi=Object(c.a)(i.a.mark((function e(t,a){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getActivityById(a);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",{_id:n.activity_id,activityId:n.activity_id,dateCreated:n.created_timestamp,activityType:n.activity_type,activitySubtype:n.activity_subtype,geometry:n.activity_payload.geometry,formData:n.activity_payload.form_data,photos:n.media&&n.media.length&&n.media.map((function(e){return{filepath:e.file_name,dataUrl:e.encoded_file}}))||[]});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pi(e,t){return{activity_id:e.activityId,created_timestamp:e.dateCreated,activity_type:e.activityType,activity_subtype:e.activitySubtype,geometry:e.geometry,media:e.photos.map((function(e){return{file_name:e.filepath,encoded_file:e.dataUrl}})),form_data:t||e.formData}}var vi,fi=function(e){var t=Object(s.useState)(!0),a=Object(_.a)(t,2),n=a[0],r=a[1],o=Object(s.useState)(null),l=Object(_.a)(o,2),d=l[0],m=l[1],p=Ce(),f=Object(s.useContext)(x),y=ui(),g=Object(s.useState)(null),h=Object(_.a)(g,2),O=h[0],E=h[1],j=y.activities?y.activities.split(","):[];Object(s.useEffect)((function(){(function(){var e=Object(c.a)(i.a.mark((function e(){var t,a,n,c,o,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,di(p,j[0]);case 2:t=e.sent,a=t.activityType,n=t.activitySubtype,c="".concat(a,"_BulkEdit"),o="".concat(n,"_BulkEdit"),l=Me({},null,c,o),m(l),r(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var w=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(j.map(function(){var e=Object(c.a)(i.a.mark((function e(a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,di(p,a);case 3:return n=e.sent,r=Object(G.a)(Object(G.a)({},n.formData),{},{activity_data:Object(G.a)(Object(G.a)({},n.formData.activity_data),t.formData.activity_data),activity_type_data:Object(G.a)(Object(G.a)({},n.formData.activity_type_data),t.formData.activity_type_data),activity_subtype_data:Object(G.a)(Object(G.a)({},n.formData.activity_subtype_data),t.formData.activity_subtype_data)}),e.next=7,p.updateActivity(pi(n,r));case 7:Ae(f,"Successfully updated activity ".concat(a,".")),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),Ie(f,"Failed to update activity ".concat(a,"."));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=Object(s.useCallback)(Va(100,(function(e){var t=an(e.formData.activity_subtype_data);return t=nn(t),m(Object(G.a)(Object(G.a)({},d),{},{formData:Object(G.a)(Object(G.a)({},e.formData),{},{activity_subtype_data:t}),status:ve.EDITED,dateUpdated:new Date,formStatus:be.NOT_VALIDATED}))})),[d]);return n?u.a.createElement(b.a,null):u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(v.a,{mb:3},u.a.createElement(ce.a,{variant:"contained",color:"primary",startIcon:u.a.createElement(si.a,null),onClick:function(){return null===O||void 0===O?void 0:O.submit()}},"Bulk Edit Activities")),u.a.createElement(at.a,null,u.a.createElement(rt.a,{className:e.classes.formContainer},u.a.createElement(Ia,{activity:d,onFormChange:S,onFormSubmitSuccess:w,customValidation:Ja([en(),function(e,t){if(!e||!e.activity_data||!e.activity_data.jurisdictions)return t;var a=e.activity_data.jurisdictions,n=0;return a.forEach((function(e){n+=e.percent_covered})),t.activity_data.jurisdictions.__errors=[],100!==n&&t.activity_data.jurisdictions.addError("Total percentage of area covered by jurisdictions must equal 100%"),t}]),setParentFormRef:E,onFormSubmitError:function(){Ie(f,"Failed to edit activities. Please make sure your form contains no errors and try again.")},hideCheckFormForErrors:!0}))),u.a.createElement(v.a,{mt:3},u.a.createElement(ce.a,{variant:"contained",color:"primary",startIcon:u.a.createElement(si.a,null),onClick:function(){return null===O||void 0===O?void 0:O.submit()}},"Bulk Edit Activities")))},bi=a(142),yi=a.n(bi),_i=a(1082),gi=a(1062),hi=a(1075),Oi=function(e){var t=e.activeStep,a=e.steps,n=e.stepContent;return u.a.createElement(v.a,null,u.a.createElement(_i.a,{activeStep:t,orientation:"horizontal",style:{backgroundColor:"transparent"}},a.map((function(e){return u.a.createElement(gi.a,{key:e},u.a.createElement(hi.a,null,u.a.createElement(H.a,{variant:"h4"},e)))}))),u.a.createElement(v.a,{mt:3},u.a.createElement(H.a,{style:{textAlign:"center"}},n)))},Ei=Object(q.a)((function(e){return{heading:{fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular},mapContainer:{height:600},map:{height:"100%",width:"100%",zIndex:0},buttonMarginRight:{marginRight:20}}})),ji=function(e){switch(e){case 0:return"Which treatment activity type would you like to create?";case 1:return"Is this the first treatment of the year on the targeted invasive species?";case 2:return"Does the selected observation accurately represent the current size and shape\n              of the treatment area? If the area has expanded then please select No.";case 3:return"Please create an overarching observation.";case 4:return"Thank you for specifying information regarding your treatment activity.\n              You may proceed to creating your treatment now."}},xi=function(e){var t=ui(),a=Ei(),n=Object(ke.f)(),r=Ce(),o=Object(s.useContext)(x),l=Object(s.useState)(L.Treatment_ChemicalPlant),d=Object(_.a)(l,2),m=d[0],p=d[1],f=Object(s.useState)(0),b=Object(_.a)(f,2),y=b[0],g=b[1],h=Object(s.useState)(null),O=Object(_.a)(h,2),E=O[0],j=O[1],w=Object(s.useState)(null),S=Object(_.a)(w,2),k=S[0],T=S[1],I=Object(s.useState)([]),A=Object(_.a)(I,2),D=A[0],P=A[1],N=Object(s.useState)(null),F=Object(_.a)(N,2),M=F[0],B=F[1],z=Object(s.useState)(null),U=Object(_.a)(z,2),q=U[0],Y=U[1],V=Object(s.useState)(!0),H=Object(_.a)(V,2),J=H[0],Q=H[1],K=t.observations?t.observations.split(","):[];Object(s.useEffect)((function(){(function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(K.map(function(){var e=Object(c.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,di(r,t);case 2:a=e.sent,1===K.length&&T(a),B(a.activitySubtype),P((function(e){return e.concat(a.geometry[a.geometry.length-1])}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(s.useEffect)((function(){3!==y||k||function(){var e=Object(c.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={activity_data:{activity_date_time:C()(new Date).format()}},a=Me(t,D,R.Observation,M),e.next=4,Be(o,a);case 4:n=e.sent,T(n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),E===y&&j(y-1)}),[y]);var $=function(){var e=Object(c.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.stopPropagation(),a=0===t.target.value?L.Treatment_ChemicalPlant:t.target.value,p(a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Z=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.database.upsert(ye.APPSTATE,(function(e){return Object(G.a)(Object(G.a)({},e),{},{activeActivity:t._id})}));case 2:n.push("/home/activity");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=Object(c.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.database.get(t._id);case 2:return a=e.sent,e.next=5,o.database.remove(a);case 5:T(null);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(Oi,{activeStep:y,steps:["Specify Treatment Type","Specify Treatment Number","Confirm Treatment Area","Create Observation","Create Treatment"],stepContent:ji(y)}),u.a.createElement(v.a,null,0===y&&u.a.createElement(v.a,{justifyContent:"center",mt:5,display:"flex"},u.a.createElement(ae.a,{variant:"outlined",className:a.buttonMarginRight},u.a.createElement(ne.a,null,"Create Treatment"),(null===M||void 0===M?void 0:M.includes("Plant"))&&u.a.createElement(re.a,{value:m,onClick:function(e){return e.stopPropagation()},onChange:$,label:"Create Treatment"},u.a.createElement(ie.a,{value:L.Treatment_ChemicalPlant,onClick:$},"Chemical Plant"),u.a.createElement(ie.a,{value:L.Treatment_MechanicalPlant},"Mechanical Plant"),u.a.createElement(ie.a,{value:L.Treatment_BiologicalPlant},"Biological Plant"))),u.a.createElement(ce.a,{size:"large",variant:"contained",color:"primary",onClick:function(){j(y),g(y+1)}},"Continue")),1===y&&u.a.createElement(v.a,{mt:5,display:"flex",justifyContent:"center"},u.a.createElement(ce.a,{size:"large",variant:"contained",startIcon:u.a.createElement(yi.a,null),className:a.buttonMarginRight,onClick:function(){return g(E)}},"Back"),u.a.createElement(ce.a,{className:a.buttonMarginRight,size:"large",variant:"contained",onClick:function(){j(y),1===K.length?g(y+1):g(y+2)}},"No"),u.a.createElement(ce.a,{size:"large",variant:"contained",color:"primary",onClick:function(){j(y),g(y+2)}},"Yes")),2===y&&u.a.createElement(v.a,{mt:5,display:"flex",justifyContent:"center"},u.a.createElement(ce.a,{size:"large",variant:"contained",startIcon:u.a.createElement(yi.a,null),className:a.buttonMarginRight,onClick:function(){return g(E)}},"Back"),u.a.createElement(ce.a,{className:a.buttonMarginRight,size:"large",variant:"contained",onClick:function(){j(y),g(y+1)}},"No"),u.a.createElement(ce.a,{size:"large",variant:"contained",color:"primary",onClick:function(){j(y),g(y+2)}},"Yes")),3===y&&k&&u.a.createElement(u.a.Fragment,null,u.a.createElement(sn,{classes:a,activityId:k._id,setObservation:T,setFormHasErrors:Q,setParentFormRef:Y}),u.a.createElement(v.a,{mt:5,display:"flex",justifyContent:"center"},u.a.createElement(ce.a,{size:"large",variant:"contained",startIcon:u.a.createElement(yi.a,null),className:a.buttonMarginRight,onClick:function(){X(k),g(E)}},"Back"),u.a.createElement(ce.a,{size:"large",variant:"contained",color:"primary",onClick:function(){J?null===q||void 0===q||q.submit():(j(y),g(y+1))}},"Continue"))),4===y&&u.a.createElement(v.a,{mt:5,display:"flex",justifyContent:"center"},u.a.createElement(ce.a,{size:"large",variant:"contained",startIcon:u.a.createElement(yi.a,null),className:a.buttonMarginRight,onClick:function(){return g(E)}},"Back"),u.a.createElement(ce.a,{size:"large",variant:"contained",color:"primary",onClick:Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(o,R.Treatment,m,k);case 2:t=e.sent,Z(t);case 4:case"end":return e.stop()}}),e)})))},"Create Treatment"))))},wi=Object(q.a)((function(e){return{heading:{fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular},mapContainer:{height:"600px"},map:{height:"100%",width:"100%",zIndex:0}}})),Si=function(e){switch(e){case 0:return"Please create your observation.";case 1:return"Thank you for specifying information regarding your observation activity.\n              If you wish to you may create a treatment activity associated to this observation."}},Ci=function(e){var t=wi(),a=ui(),n=Object(ke.f)(),r=Object(s.useContext)(x),o=Object(s.useState)(L.Treatment_ChemicalPlant),l=Object(_.a)(o,2),d=l[0],m=l[1],p=Object(s.useState)(0),f=Object(_.a)(p,2),b=f[0],y=f[1],g=Object(s.useState)(null),h=Object(_.a)(g,2),O=h[0],E=h[1],j=Object(s.useState)(null),w=Object(_.a)(j,2),S=w[0],C=w[1],k=Object(s.useState)(null),T=Object(_.a)(k,2),I=T[0],A=T[1],D=Object(s.useState)(!0),P=Object(_.a)(D,2),N=P[0],F=P[1],M=a.observation;Object(s.useEffect)((function(){O||function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.database.get(M);case 2:t=e.sent,C(t.activitySubtype),E(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]),Object(s.useEffect)((function(){N||y(b+1)}),[N]);var B=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.database.upsert(ye.APPSTATE,(function(e){return Object(G.a)(Object(G.a)({},e),{},{activeActivity:t._id})}));case 2:n.push("/home/activity");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=Object(c.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.stopPropagation(),a=0===t.target.value?L.Treatment_ChemicalPlant:t.target.value,m(a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(Oi,{activeStep:b,steps:["Create Observation","Create Optional Treatment"],stepContent:Si(b)}),u.a.createElement(v.a,null,0===b&&O&&u.a.createElement(u.a.Fragment,null,u.a.createElement(sn,{classes:t,activityId:O._id,setObservation:E,setFormHasErrors:F,setParentFormRef:A}),u.a.createElement(v.a,{mt:5,display:"flex",justifyContent:"center"},u.a.createElement(ce.a,{size:"large",variant:"contained",color:"primary",onClick:function(){N?null===I||void 0===I||I.submit():y(b+1)}},"Continue"))),1===b&&u.a.createElement(u.a.Fragment,null,u.a.createElement(v.a,{mt:5,display:"flex",justifyContent:"center"},u.a.createElement(ae.a,{variant:"outlined",style:{marginRight:20}},u.a.createElement(ne.a,null,"Create Treatment"),(null===S||void 0===S?void 0:S.includes("Plant"))&&u.a.createElement(re.a,{value:d,onClick:function(e){return e.stopPropagation()},onChange:z,label:"Create Treatment"},u.a.createElement(ie.a,{value:L.Treatment_ChemicalPlant,onClick:z},"Chemical Plant"),u.a.createElement(ie.a,{value:L.Treatment_MechanicalPlant},"Mechanical Plant"),u.a.createElement(ie.a,{value:L.Treatment_BiologicalPlant},"Biological Plant")))),u.a.createElement(v.a,{mt:5,display:"flex",justifyContent:"center"},u.a.createElement(ce.a,{size:"large",variant:"contained",startIcon:u.a.createElement(yi.a,null),style:{marginRight:20},onClick:function(){return y(b-1)}},"Back"),u.a.createElement(ce.a,{size:"large",variant:"contained",style:{marginRight:20},onClick:function(){return n.push("/home/activities")}},"Skip"),u.a.createElement(ce.a,{size:"large",variant:"contained",color:"primary",onClick:Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(r,R.Treatment,d,O);case 2:t=e.sent,B(t);case 4:case"end":return e.stop()}}),e)})))},"Create Associated Treatment")))))},ki=Object(q.a)((function(e){return{heading:{fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular},mapContainer:{height:"600px"},map:{height:"100%",width:"100%",zIndex:0},formContainer:{},photoContainer:{}}})),Ti=function(e){var t=Object(ke.h)(),a=ki(),n=Ce(),r=Object(s.useContext)(x),o=Object(s.useState)(!0),l=Object(_.a)(o,2),d=l[0],m=l[1],p=Object(s.useState)([]),f=Object(_.a)(p,2),y=f[0],g=f[1],h=Object(s.useState)(null),O=Object(_.a)(h,2),E=O[0],j=O[1],w=Object(s.useState)({isOpen:!1,lat:0,lng:0}),S=Object(_.a)(w,2),C=S[0],k=S[1],T=Object(s.useState)(null),I=Object(_.a)(T,2),A=I[0],D=I[1],P=Object(s.useState)([]),N=Object(_.a)(P,2),F=N[0],M=N[1],R=Object(s.useState)(null),L=Object(_.a)(R,2),B=L[0],z=L[1],U=Object(s.useCallback)((function(e){D((function(t){var a=on(e)||{},n=a.latitude,r=a.longitude,i=t.formData,c=cn(e),o=Object(G.a)(Object(G.a)({},i),{},{activity_data:Object(G.a)(Object(G.a)({},i.activity_data),{},{latitude:n,longitude:r,reported_area:c})});return Object(G.a)(Object(G.a)({},t),{},{geometry:e,status:ve.EDITED,dateUpdated:new Date,formData:o})}))}),[]),q=Object(s.useCallback)((function(e){D((function(t){return Object(G.a)(Object(G.a)({},t),{},{photos:e,dateUpdated:new Date})}))}),[]),Y=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.updateActivity(pi(Object(G.a)(Object(G.a)({},A),{},{formData:t.formData})));case 3:Ae(r,"Successfully updated activity."),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Ie(r,"Failed to update activity.");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),V=Object(s.useCallback)(Va(100,(function(e){var t=an(e.formData.activity_subtype_data);return t=nn(t),D(Object(G.a)(Object(G.a)({},A),{},{formData:Object(G.a)(Object(G.a)({},e.formData),{},{activity_subtype_data:t}),status:ve.EDITED,dateUpdated:new Date,formStatus:be.NOT_VALIDATED}))})),[A]);return Object(s.useEffect)((function(){(function(){var e=Object(c.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,di(n,t.id);case 2:a=e.sent,g(a.geometry),M(a.photos),D(a),m(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(s.useEffect)((function(){d||U(y)}),[y,d,U]),Object(s.useEffect)((function(){d||q(F)}),[F,d,q]),d?u.a.createElement(b.a,null):u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(v.a,{mb:3},u.a.createElement(ce.a,{variant:"contained",color:"primary",startIcon:u.a.createElement(si.a,null),onClick:function(){return null===B||void 0===B?void 0:B.submit()}},"Update Activity")),u.a.createElement(Ya,{customValidation:Ja([Qa(A.activitySubtype),Za(A.activitySubtype),$a(A.activitySubtype),Ka(A.activitySubtype),en(),tn(),function(e,t){if(!e||!e.activity_data||!e.activity_data.jurisdictions)return t;var a=e.activity_data.jurisdictions,n=0;return a.forEach((function(e){n+=e.percent_covered})),t.activity_data.jurisdictions.__errors=[],100!==n&&t.activity_data.jurisdictions.addError("Total percentage of area covered by jurisdictions must equal 100%"),t}]),classes:a,activity:A,onFormChange:V,onFormSubmitSuccess:Y,onFormSubmitError:function(){Ie(r,"Failed to update activity. Please make sure your form contains no errors and try again.")},photoState:{photos:F,setPhotos:M},mapId:A._id,showDrawControls:!1,geometryState:{geometry:y,setGeometry:g},extentState:{extent:E,setExtent:j},contextMenuState:{state:C,setContextMenuState:k},setParentFormRef:z,hideCheckFormForErrors:!0}),u.a.createElement(v.a,{mt:3},u.a.createElement(ce.a,{variant:"contained",color:"primary",startIcon:u.a.createElement(si.a,null),onClick:function(){return null===B||void 0===B?void 0:B.submit()}},"Update Activity")))},Ii=a(1063),Ai=a(520),Di=a.n(Ai),Pi=Object(q.a)((function(e){return{userInfoItemGrid:Object(U.a)({display:"flex",flexDirection:"row"},e.breakpoints.down("sm"),{flexDirection:"column"}),cardListItemGrid:Object(U.a)({display:"flex",justifyContent:"space-between",flexDirection:"row"},e.breakpoints.down("sm"),{flexDirection:"column"}),cardWidth:{"@media (min-device-width: 600px)":{width:600},marginBottom:"2em"}}})),Ni=function(e){var t=Sn(),a=Pi(),n=Object(ke.f)(),r=Object(s.useState)(null),o=Object(_.a)(r,2),l=o[0],d=o[1];Object(s.useEffect)((function(){var e=function(){var e=Object(c.a)(i.a.mark((function e(){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(a=t.obj)||void 0===a?void 0:a.loadUserInfo();case 2:n=e.sent,d(n);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();window.cordova||e()}),[t.obj]);var m=function(e,t,r,i,c){return u.a.createElement(Ba.a,{className:a.cardWidth},u.a.createElement(Ii.a,null,u.a.createElement(H.a,{variant:"h5",component:"h2",gutterBottom:!0},e),u.a.createElement(H.a,{color:"textSecondary",gutterBottom:!0},t),u.a.createElement(H.a,{variant:"body2",component:"p"},r,u.a.createElement(at.a,null,u.a.createElement(nt.a,null,"Expand for Demo"),u.a.createElement(rt.a,null,u.a.createElement("img",{src:Di.a,alt:"loading..."}))))),u.a.createElement(za.a,null,u.a.createElement(ce.a,{onClick:function(){return n.push(c)},size:"small"},i)))};return u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(v.a,{display:"flex",justifyContent:"space-between"},u.a.createElement(H.a,{variant:"h4"},"Welcome to the InvasivesBC Application"),l&&u.a.createElement(ce.a,{variant:"contained",color:"primary",size:"large",onClick:function(){t.obj.logout()}},"Logout")),l&&u.a.createElement(v.a,{mt:2},u.a.createElement(H.a,{variant:"h5"},"User Information"),u.a.createElement("br",null),u.a.createElement(Y.a,{className:a.userInfoItemGrid,container:!0,spacing:2},u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis"},u.a.createElement(H.a,null,"Name"),l.name)),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis"},u.a.createElement(H.a,null,"Email"),l.email)),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis"},u.a.createElement(H.a,null,"Username"),l.preferred_username)))),u.a.createElement(v.a,{mt:4},u.a.createElement(H.a,{variant:"h5"},"What Would You Like To Do?"),u.a.createElement("br",null)),u.a.createElement(Y.a,{className:a.cardListItemGrid},m("Plan a Trip/Fetch Cached Records","Points of Interest, Past Activity Records, Layers","Heading out into the field and wish to gather information regarding your\n           trip before going offline?","Plan your trip now","/home/plan"),m("Create a Local Activity","Observations, Transects, Biological Dispersals","In the field and wish to record an observation record or create a transect?","Create a local activity now","/home/activities")),u.a.createElement(Y.a,{className:a.cardListItemGrid},m("Search","Cached Observations, Treatments and Monitorings","Need to view previously created and cached activity records?","Search cached activities now","/home/search"),m("Create Treatments and Monitorings","Treatments and Monitorings from Cached Activities","Need to create a treatment based off existing observation records,\n           or create a monitoring for an existing treatment?","Create a treatment or monitoring now","/home/references")),u.a.createElement(Y.a,{className:a.cardListItemGrid},m("View Fetched Records on Map","IAPP Sites, Activities on Main Map","Want to see all the data you have fetched on a single map?","View the main map now","/home/map"),m("Continue Creating an Activity","Pause and Resume Activity Creation","Had to take a break and come back to creating an activity?","Resume current activity creation now","/home/activity")))},Fi=a(896),Mi=a(1020),Ri=a(1019),Li=function(e){var t=function(t,a,n){var r=e.searchFilterCriteriaState.searchFilterCriteria.activityType.indexOf(a),i=Object(G.a)({},e.searchFilterCriteriaState.searchFilterCriteria);n&&-1===r?i[t].push(a):!n&&r>=0&&i[t].splice(r,1),e.searchFilterCriteriaState.setSearchFilterCriteria(i)},a=function(t,a){var n=Object(G.a)(Object(G.a)({},e.searchFilterCriteriaState.searchFilterCriteria),{},Object(U.a)({},t,a));e.searchFilterCriteriaState.setSearchFilterCriteria(n)};return e.searchFilterCriteriaState.searchFilterCriteria?u.a.createElement(u.a.Fragment,null,u.a.createElement("fieldset",{className:e.classes.fieldset},u.a.createElement(Y.a,{container:!0,spacing:4},u.a.createElement(Y.a,{item:!0},u.a.createElement(ae.a,null,u.a.createElement(Fi.a,{component:"legend"},"Date Range"),u.a.createElement(Mi.a,{row:!0},u.a.createElement(v.a,{mr:3},u.a.createElement(ya.a,{id:"datepicker_start",name:"datepicker_start",label:"Start",type:"date",value:e.searchFilterCriteriaState.searchFilterCriteria.startDate,margin:"normal",InputLabelProps:{shrink:!0},disabled:e.isDisabled,onChange:function(e){return a("startDate",e.target.value)}})),u.a.createElement(v.a,null,u.a.createElement(ya.a,{id:"datepicker_end",name:"datepicker_end",label:"End",type:"date",value:e.searchFilterCriteriaState.searchFilterCriteria.endDate,margin:"normal",InputLabelProps:{shrink:!0},disabled:e.isDisabled,onChange:function(e){return a("endDate",e.target.value)}}))))))),u.a.createElement("fieldset",{className:e.classes.fieldset},u.a.createElement(Y.a,{container:!0,spacing:4},u.a.createElement(Y.a,{item:!0},u.a.createElement(ae.a,{component:"fieldset",disabled:e.isDisabled},u.a.createElement(Fi.a,{component:"legend"},"Activity Type"),u.a.createElement(Mi.a,null,u.a.createElement(Ri.a,{control:u.a.createElement(J.a,{name:"checkbox_observation",checked:e.searchFilterCriteriaState.searchFilterCriteria.activityType.includes("Observation"),onChange:function(e){return t("activityType","Observation",e.target.checked)}}),label:"Observation"}),u.a.createElement(Ri.a,{control:u.a.createElement(J.a,{name:"checkbox_treatment",checked:e.searchFilterCriteriaState.searchFilterCriteria.activityType.includes("Treatment"),onChange:function(e){return t("activityType","Treatment",e.target.checked)}}),label:"Treatment"}),u.a.createElement(Ri.a,{control:u.a.createElement(J.a,{name:"checkbox_monitoring",checked:e.searchFilterCriteriaState.searchFilterCriteria.activityType.includes("Monitoring"),onChange:function(e){return t("activityType","Monitoring",e.target.checked)}}),label:"Monitoring"})),u.a.createElement(kt.a,null,"Selecting none searches all")))))):u.a.createElement(u.a.Fragment,null)},Bi=a(1085),Wi=a(1064),zi=a(1070),Gi=function(e,t){return Math.max(Math.ceil(e/t),1)},Ui=function(e){return e.currentPageState.currentPage&&e.itemsPerPageState.itemsPerPage?u.a.createElement("fieldset",{className:e.classes.fieldset},u.a.createElement(Y.a,{container:!0,spacing:4,justify:"space-between"},u.a.createElement(Y.a,{item:!0},u.a.createElement(ae.a,{component:"fieldset",className:e.classes.formControl,disabled:e.isDisabled},u.a.createElement(Fi.a,{component:"legend",className:e.classes.formLabel},"# of results to display"),u.a.createElement(Bi.a,{exclusive:!0,value:e.itemsPerPageState.itemsPerPage,onChange:function(t,a){return function(t){t&&e.itemsPerPageState.setItemsPerPage(t)}(a)},"aria-label":"# of results to display"},u.a.createElement(Wi.a,{value:10,disabled:e.isDisabled},"10"),u.a.createElement(Wi.a,{value:25,disabled:e.isDisabled},"25"),u.a.createElement(Wi.a,{value:50,disabled:e.isDisabled},"50"),u.a.createElement(Wi.a,{value:100,disabled:e.isDisabled},"100")))),u.a.createElement(Y.a,{item:!0},u.a.createElement(ae.a,{className:e.classes.formControl,disabled:e.isDisabled},u.a.createElement(Fi.a,{component:"legend",className:e.classes.formLabel},"Sort By"),u.a.createElement(re.a,{native:!0,value:e.sortByState.sortBy,onChange:function(t){var a;(a=t.target.value)&&e.sortByState.setSortBy(a)},inputProps:{name:"sortBy",id:"sortBy"}},Object.entries(e.sortByValues).map((function(e){return u.a.createElement("option",{value:e[0],key:e[0]},e[1])}))))),u.a.createElement(Y.a,{item:!0},u.a.createElement(ae.a,{component:"fieldset",className:e.classes.formControl,disabled:e.isDisabled},u.a.createElement(Fi.a,{component:"legend",className:e.classes.formLabel},function(e,t,a){if(!e||!t||!a)return"";var n=Math.max((e-1)*t+1,1),r=Math.min(a,e*t);return"Displaying ".concat(n," - ").concat(r," of ").concat(a," results")}(e.currentPageState.currentPage,e.itemsPerPageState.itemsPerPage,e.totalItems)),u.a.createElement(zi.a,{count:e.totalPages,defaultPage:1,page:e.currentPageState.currentPage,showFirstButton:!0,showLastButton:!0,disabled:e.isDisabled,onChange:function(t,a){return function(t){t&&e.currentPageState.setCurrentPage(t)}(a)}}))))):u.a.createElement(u.a.Fragment,null)},qi=function(e){var t=e.activity,a=e.classes,n=Ce(),r=Object(s.useState)(null),o=Object(_.a)(r,2),l=o[0],d=o[1];Object(s.useEffect)((function(){m()}),[]);var m=function(){var e=Object(c.a)(i.a.mark((function e(){var a,r,c,o,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Activity_Observation_PlantTerrestrial"===t.activitySubtype){e.next=2;break}return e.abrupt("return");case 2:if(!(c=null===(a=t.formData)||void 0===a||null===(r=a.activity_subtype_data)||void 0===r?void 0:r.invasive_plant_code)){e.next=8;break}return e.next=6,n.getSpeciesDetails([c]);case 6:l=e.sent,d(null===l||void 0===l||null===(o=l[0])||void 0===o?void 0:o.code_description);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return u.a.createElement(u.a.Fragment,null,u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis",title:t.activityType},u.a.createElement(H.a,{className:a.activitiyListItem_Typography},"Type"),t.activityType)),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:2},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis",title:t.activitySubtype.split("_")[2]},u.a.createElement(H.a,{className:a.activitiyListItem_Typography},"Subtype"),t.activitySubtype.split("_")[2])),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:3},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis",title:l},l&&u.a.createElement(u.a.Fragment,null,u.a.createElement(H.a,{className:a.activitiyListItem_Typography},"Species"),l))))},Yi=Object(q.a)((function(e){return{activitiyListItem:{display:"flex",flexDirection:"row",marginTop:"0.5rem",marginBottom:"0.5rem",border:"1px solid",borderColor:e.palette.grey[300],borderRadius:"6px"},activityListItem_Grid:Object(U.a)({flexDirection:"row"},e.breakpoints.down("sm"),{flexDirection:"column"}),activitiyListItem_Typography:Object(U.a)({},e.breakpoints.down("sm"),{display:"inline",marginRight:"1rem"}),multiSelect:{flexBasis:0}}})),Vi=function(e){var t=Yi();return u.a.createElement(Y.a,{className:t.activityListItem_Grid,container:!0,spacing:2},u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:1},u.a.createElement(v.a,{overflow:"hidden",textOverflow:"ellipsis",title:e.activity._id},u.a.createElement(H.a,{className:t.activitiyListItem_Typography},"ID"),e.activity._id)),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(qi,{activity:e.activity,classes:t}),u.a.createElement(V.a,{flexItem:!0,orientation:"vertical"}),u.a.createElement(Y.a,{item:!0,md:3},u.a.createElement(H.a,{className:t.activitiyListItem_Typography},"Date"),C()(e.activity.dateReceived).format("MMMM D, YYYY")))},Hi=function(e){var t=Yi(),a=Object(ke.f)(),n=e.edits,r=e.setEdits,o=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.push("/home/search/activity/".concat(t._id));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return u.a.createElement(Q.a,null,e.activities.map((function(e){var a=n.filter((function(t){return t.id===e._id})).length>0,i=![L.Observation_PlantTerrestrial,L.Treatment_ChemicalPlant,L.Treatment_MechanicalPlant,L.Treatment_BiologicalPlant].includes(e.activitySubtype);return u.a.createElement(K.a,{key:e._id},u.a.createElement($.a,{button:!0,className:t.activitiyListItem,onClick:function(){return o(e)}},u.a.createElement(Y.a,{className:t.multiSelect},u.a.createElement(J.a,{checked:a,disabled:i,style:i?{visibility:"hidden"}:{},onChange:function(){return r(a?n.filter((function(t){return t.id!==e._id})):[{id:e._id,subtype:e.activitySubtype}].concat(Object(y.a)(n)))},onClick:function(e){return e.stopPropagation()}})),u.a.createElement(Z.a,null,u.a.createElement(X.a,{fontSize:"large",component:_e[e.activityType]})),u.a.createElement(Vi,{activity:e})))})))},Ji=Object(q.a)((function(e){return{resultsBar:{justifyContent:"space-between",display:"flex",alignItems:"center"},bulkButton:{marginLeft:10}}})),Qi=function(e){var t=Object(s.useState)([]),a=Object(_.a)(t,2),n=a[0],r=a[1],i=Object(ke.f)(),c=Ji(),o=Ce(),l=Object(s.useContext)(x);return u.a.createElement(v.a,null,u.a.createElement(v.a,{className:c.resultsBar},u.a.createElement(H.a,{variant:"h5"},"".concat(e.totalItems," Matching Results Found")),u.a.createElement(v.a,{className:c.resultsBar},u.a.createElement(H.a,{variant:"h5"},n.length?n.length+" Selected":""),u.a.createElement(ce.a,{className:c.bulkButton,disabled:0===n.length,variant:"contained",color:"primary",onClick:function(){!function(e){if(new Set(e.map((function(e){return e.subtype}))).size>1)Ie(l,"Sorry, all activites must be the same Subtype in order to Bulk Edit.");else{var t=e.map((function(e){return e.id}));t.length>1?i.push({pathname:"/home/search/bulkedit",search:"?activities="+t.join(","),state:{activityIdsToEdit:t}}):i.push("/home/search/activity/".concat(t[0]))}}(n)}},"Edit"),u.a.createElement(ce.a,{className:c.bulkButton,disabled:0===n.length,variant:"contained",color:"primary",onClick:function(){o.deleteActivities(n.map((function(e){return e.id}))),r([]),i.go(0)}},"Delete"))),u.a.createElement(Hi,{activities:e.results,edits:n,setEdits:r}))};!function(e){e.ASC="ASC",e.DESC="DESC"}(vi||(vi={}));var Ki=Object(q.a)((function(e){return{fieldset:{border:"none",marginBottom:"1rem"}}})),$i=function(e){var t=Ki(),a=Object(ke.f)(),n=ui(),r=Ce(),o=Object(s.useState)({startDate:n.startDate||"",endDate:n.endDate||"",activityType:n.activityType||[],speciesType:n.speciesType||[],habitatType:n.habitatType||[]}),l=Object(_.a)(o,2),d=l[0],m=l[1],p=Object(s.useState)(Number(n.currentPage)||1),f=Object(_.a)(p,2),b=f[0],y=f[1],g=Object(s.useState)(Number(n.itemsPerPage)||25),h=Object(_.a)(g,2),O=h[0],E=h[1],j=Object(s.useState)(0),x=Object(_.a)(j,2),w=x[0],S=x[1],k=Object(s.useState)(1),T=Object(_.a)(k,2),I=T[0],A=T[1],D=Object(s.useState)(n.sortBy||"-received_timestamp"),P=Object(_.a)(D,2),N=P[0],F=P[1],M=Object(s.useState)([]),R=Object(_.a)(M,2),L=R[0],B=R[1],z=Object(s.useState)(!1),U=Object(_.a)(z,2),q=U[0],Y=U[1],V=function(){var e=Object(c.a)(i.a.mark((function e(){var t,c,o,l,s,u,m,p,v,f,y;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Y(!0),a.push({search:je.a.stringify(Object(G.a)(Object(G.a)({},n),d))}),t=C()(d.startDate,"YYYY-MM-DD"),c=t&&t.isValid()&&{date_range_start:t.startOf("day").toISOString()}||{},o=C()(d.endDate,"YYYY-MM-DD"),l=o&&o.isValid()&&{date_range_end:o.endOf("day").toISOString()}||{},s=d.activityType&&d.activityType.length&&{activity_type:d.activityType}||{},u=N.substring(1),m=N.substring(0,1),p=Object(G.a)(Object(G.a)(Object(G.a)({page:b-1,limit:O,sort_by:u,sort_direction:"-"===m&&vi.DESC||vi.ASC,column_names:["activity_id","activity_type","activity_subtype","created_timestamp","received_timestamp","activity_payload"]},c),l),s),e.prev=10,e.next=13,r.getActivities(p);case 13:!(v=e.sent)||v.rows,f=v.rows.map((function(e){return{_id:e.activity_id,activityId:e.activity_id,activityType:e.activity_type,activitySubtype:e.activity_subtype,dateCreated:e.created_timestamp,dateReceived:e.received_timestamp,formData:e.activity_payload.form_data}})),y=Number(v.count),B(f),S(y),A(Gi(y,O)),e.next=24;break;case 22:e.prev=22,e.t0=e.catch(10);case 24:Y(!1);case 25:case"end":return e.stop()}}),e,null,[[10,22]])})));return function(){return e.apply(this,arguments)}}();return Object(s.useEffect)((function(){a.push({search:je.a.stringify(Object(G.a)(Object(G.a)({},n),{},{itemsPerPage:O}))}),1===b?V():y(1)}),[O]),Object(s.useEffect)((function(){a.push({search:je.a.stringify(Object(G.a)(Object(G.a)({},n),{},{currentPage:b}))}),V()}),[b]),Object(s.useEffect)((function(){a.push({search:je.a.stringify(Object(G.a)(Object(G.a)({},n),{},{sortBy:N}))}),V()}),[N]),u.a.createElement(W.a,{className:e.classes.container},u.a.createElement(v.a,{mb:3},u.a.createElement(H.a,{variant:"h4"},"Search InvasivesBC Records")),u.a.createElement(v.a,{mb:2},u.a.createElement("form",{className:e.classes.form},u.a.createElement(at.a,{defaultExpanded:!0},u.a.createElement(nt.a,{expandIcon:u.a.createElement(it.a,null),"aria-controls":"search-filter-controls",id:"search-filter-controls"},u.a.createElement(H.a,{variant:"h5"},"Filters")),u.a.createElement(rt.a,null,u.a.createElement(v.a,{flexDirection:"column"},u.a.createElement(v.a,null,u.a.createElement(Li,{classes:t,searchFilterCriteriaState:{searchFilterCriteria:d,setSearchFilterCriteria:m},isDisabled:q})),u.a.createElement(v.a,{p:2},u.a.createElement(ce.a,{variant:"contained",color:"primary",onClick:V,disabled:q},"Search"))))))),u.a.createElement(K.a,null,u.a.createElement(v.a,{p:2},u.a.createElement(v.a,null,u.a.createElement(Ui,{classes:t,currentPageState:{currentPage:b,setCurrentPage:y},itemsPerPageState:{itemsPerPage:O,setItemsPerPage:E},totalItems:w,totalPages:I,sortByValues:{"-received_timestamp":"Date (newest at top)","+activity_type":"Type (a-z)","+activity_subtype":"Subtype (a-z)"},sortByState:{sortBy:N,setSortBy:F},isDisabled:q})),u.a.createElement(v.a,null,u.a.createElement(Qi,{classes:t,totalItems:w,results:L})))))},Zi=function(e){var t=e.component,a=e.layout,n=e.title,r=e.keycloak,i=e.keycloakConfig,c=e.isMobileNoNetwork,o=Object(dt.a)(e,["component","layout","title","keycloak","keycloakConfig","isMobileNoNetwork"]),l=void 0===a?function(e){return u.a.createElement(u.a.Fragment,null,e.children)}:a;return document.title=n,u.a.createElement(ke.b,Object.assign({},o,{render:function(e){return u.a.createElement(l,{keycloak:r,keycloakConfig:i,isMobileNoNetwork:c},u.a.createElement(t,e))}}))},Xi=function(e){var t=Sn(),a=e.component,n=e.layout,r=Object(dt.a)(e,["component","layout"]);return document.title=e.title,u.a.createElement(ke.b,Object.assign({},r,{render:function(i){var c,o;return(null===(c=t.obj)||void 0===c?void 0:c.authenticated)&&r.roles&&t.hasRole(r.roles)||(null===(o=e.componentProps)||void 0===o?void 0:o.isMobileNoNetwork)?u.a.createElement(n,null,u.a.createElement(a,Object.assign({},i,r.componentProps))):u.a.createElement(ke.a,{to:{pathname:"/forbidden",state:{referer:i.location}}})}}))},ec=function(e){var t=function(e){return"InvasivesBC - ".concat(e)};return u.a.createElement(ke.d,null,u.a.createElement(ke.a,{exact:!0,from:"/home",to:"/home/landing"}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/search",title:t("Search"),roles:B,component:$i,componentProps:e}),u.a.createElement(Xi,{layout:In,path:"/home/search/activity/:id?",title:t("Edit"),roles:B,component:Ti,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/search/bulkedit",title:t("Bulk Edit"),roles:B,component:fi,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/activity/observation",title:t("Create Observation"),roles:B,component:Ci,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/activity/treatment",title:t("Create Treatment"),roles:B,component:xi,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/plan",title:t("Plan"),roles:B,component:Qr,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/references",title:t("Reference"),roles:B,component:li,componentProps:e}),u.a.createElement(Xi,{layout:In,path:"/home/references/activity/:id?",title:t("Activity"),roles:B,component:$r,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/activities",title:t("Activities"),roles:B,component:et,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/map",title:t("Map"),roles:B,component:Or,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/activity",title:t("Activity"),roles:B,component:sn,componentProps:e}),u.a.createElement(Xi,{exact:!0,layout:In,path:"/home/landing",title:t("Welcome"),roles:B,component:Ni,componentProps:e}),u.a.createElement(Zi,{title:"*",path:"/home/*",component:function(){return u.a.createElement(ke.a,{to:"/page-not-found"})}}))},tc=s.createContext({ready:!1}),ac=function(e){var t,a=Sn(),n=Ce(),r=s.useState(null),o=Object(_.a)(r,2),l=o[0],u=o[1];return s.useEffect((function(){(function(){var e=Object(c.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=a.obj)||void 0===t?void 0:t.loadUserInfo();case 2:n=e.sent,u(n);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[a.obj]),s.useEffect((function(){(function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getCachedApiSpec();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),s.createElement(tc.Provider,{value:{ready:(null===(t=a.obj)||void 0===t?void 0:t.authenticated)&&!!l}},e.children)},nc=a(1065),rc=Object(q.a)((function(e){return{mainContent:{flex:1,width:"inherit",height:"inherit",overflow:"auto"},container:{paddingTop:e.spacing(4),paddingBottom:e.spacing(4)}}})),ic=function(e){var t=rc(),a=e.isMobileNoNetwork;return u.a.createElement(v.a,{mb:2,height:"inherit",width:"inherit",display:"flex",flexDirection:"column"},u.a.createElement(nc.a,null),u.a.createElement("main",{className:t.mainContent},u.a.Children.map(e.children,(function(e){return u.a.cloneElement(e,{classes:t,isMobileNoNetwork:a})}))))},cc=function(e){return function(e,t){switch(e){case"onReady":console.log("keycloak onReady");break;case"onAuthSuccess":console.log("keycloak onAuthSuccess");break;case"onAuthError":console.log("keycloak onAuthError",t);break;case"onAuthLogout":console.log("keycloak onAuthLogout");break;case"onAuthRefreshError":console.log("keycloak onAuthRefreshError",t);break;case"onAuthRefreshSuccess":console.log("keycloak onAuthRefreshSuccess");break;case"onInitError":console.log("keycloak onInitError",t);break;case"onTokenExpired":console.log("keycloak onTokenExpired",t);break;default:console.debug("keycloak event: ".concat(e," error ").concat(t))}}},oc=function(e){return u.a.createElement(ge.a,{keycloak:e.keycloak,initConfig:e.keycloakConfig,LoadingComponent:u.a.createElement(b.a,null),onEvent:cc(e.keycloak)},u.a.createElement(ac,null,u.a.createElement(tc.Consumer,null,(function(t){return t.ready?u.a.createElement(ic,null,e.children):u.a.createElement(b.a,null)}))))},lc=a(1066),sc=a(1067),uc=Object(q.a)((function(e){return{warningIcon:{verticalAlign:"middle",fontSize:"3rem",marginRight:"1rem"},emailLink:{color:e.palette.primary.main,textDecoration:"none"}}})),dc=function(){var e=uc(),t=Object(ke.f)(),a=encodeURIComponent("InvasivesBC Access Request"),n=encodeURIComponent("I wish to be granted access to the InvasivesBC application, find\n    below my IDIR or BCeID username."),r="mailto:michael.shasko@gov.bc.ca?subject=".concat(a,"&body=").concat(n);return u.a.createElement(W.a,null,u.a.createElement(v.a,{my:6},u.a.createElement(v.a,{mb:3},u.a.createElement(H.a,{variant:"h1"},u.a.createElement(lc.a,{className:e.warningIcon}),"Email for access")),u.a.createElement(v.a,{mb:4},u.a.createElement(H.a,{variant:"h4"},"You must request access by email to view this application. Please provide your IDIR/BCeID username in the email body.")),u.a.createElement(v.a,{mb:4},u.a.createElement(H.a,{variant:"body1",component:"span"},u.a.createElement(v.a,null,"Send an email requesting access to:"),u.a.createElement(v.a,{mb:2,className:e.emailLink},"michael.shasko@gov.bc.ca"),u.a.createElement(v.a,{mb:2},"or"),u.a.createElement(v.a,null,u.a.createElement("a",{className:e.emailLink,href:r},"Click Here")))),u.a.createElement(v.a,{mb:3},u.a.createElement(H.a,{variant:"body1"},"Authorization is a one time process, after which your IDIR/BCeID will be enabled for future logins."),u.a.createElement(H.a,{variant:"body1"},"If this is your first time logging into the InvasivesBC application, you will need to send an email to the above address to complete your authorization and gain access to the site.")),u.a.createElement(v.a,null,u.a.createElement(ce.a,{variant:"text",color:"primary",startIcon:u.a.createElement(sc.a,null),onClick:function(){t.push("/home")}},u.a.createElement(H.a,{variant:"body1"},"Go back to the home page")))))},mc=Object(q.a)((function(e){return{warningIcon:{verticalAlign:"middle",fontSize:"3rem",marginRight:"1rem"}}})),pc=function(){var e=mc(),t=Object(ke.f)();return u.a.createElement(W.a,null,u.a.createElement(v.a,{my:6},u.a.createElement(v.a,{mb:3},u.a.createElement(H.a,{variant:"h1"},u.a.createElement(lc.a,{className:e.warningIcon}),"Page not found")),u.a.createElement(v.a,null,u.a.createElement(ce.a,{variant:"text",color:"primary",startIcon:u.a.createElement(sc.a,null),onClick:function(){t.push("/home")}},u.a.createElement(H.a,{variant:"body1"},"Go back to the home page")))))},vc=function(e){var t=Object(s.useContext)(I),a=Object(s.useState)(null),n=Object(_.a)(a,2),r=n[0],i=n[1],c=Object(s.useState)(!1),l=Object(_.a)(c,2),d=l[0],m=l[1],p=function(e){return"InvasivesBC - ".concat(e)};return Object(s.useEffect)((function(){"ios"!=o.c.getPlatform()||(null===t||void 0===t?void 0:t.connected)?i((function(){return oc})):(i((function(){return ic})),m(!0))}),[t]),r?u.a.createElement(ke.d,null,u.a.createElement(ke.a,{exact:!0,from:"/",to:"/home"}),u.a.createElement(Zi,{path:"/forbidden",title:p("Forbidden"),component:dc,layout:ic}),u.a.createElement(Zi,{path:"/page-not-found",title:p("Not Found"),component:pc,layout:ic}),u.a.createElement(Zi,{path:"/home",title:p("Home"),component:ec,layout:r,keycloak:e.keycloak,keycloakConfig:e.keycloakConfig,isMobileNoNetwork:d}),u.a.createElement(Zi,{title:"*",path:"*",component:function(){return u.a.createElement(ke.a,{to:"/page-not-found"})}})):u.a.createElement(b.a,null)},fc=function(e){var t=new P.a({realm:"dfmlcg7z",url:"https://dev.oidc.gov.bc.ca/auth/",clientId:"invasives-bc"}),a=null;a=window.cordova?{flow:"hybrid",redirectUri:"http://127.0.0.1",checkLoginIframe:!1,onLoad:"login-required"}:{onLoad:"login-required",checkLoginIframe:!1};var n={deviceInfo:e.deviceInfo,keycloak:t,keycloakConfig:a};return u.a.createElement(v.a,{height:"100vh",width:"100vw",display:"flex",overflow:"hidden"},u.a.createElement(f.a,{theme:F},u.a.createElement(p.a,null,u.a.createElement(A,null,u.a.createElement(w,null,u.a.createElement(x.Consumer,null,(function(e){return e.database?u.a.createElement(T,null,u.a.createElement(vc,n)):u.a.createElement(b.a,null)})))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var bc=o.e.Device;Object(l.a)(window);var yc=function(e){m.a.render(u.a.createElement(fc,{deviceInfo:e}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))};window.cordova?document.addEventListener("deviceready",Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bc.getInfo();case 2:t=e.sent,yc(t);case 4:case"end":return e.stop()}}),e)}))),!1):yc(null)}},[[558,3,6]]]);
//# sourceMappingURL=main.b3d4589a.chunk.js.map